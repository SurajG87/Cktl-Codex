<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Apple Touch Icon (the main one for home screen) -->
<link rel="apple-touch-icon" href="logo.png">

<!-- Optional: Prevents zooming when launching from home screen -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cocktail Codex</title>
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üç∏</text></svg>">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üç∏</text></svg>">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Cocktail Codex">
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a1a;
            color: #ffffff;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }
        
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        
        .page-title {
            font-size: 2rem;
            color: #FFB366;
            margin-bottom: 1rem;
        }
        
        .button {
            background: #FFB366;
            color: #1a1a1a;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s;
        }
        
        .button:hover {
            background: #ffa24d;
        }
        
        .button-secondary {
            background: #333;
            color: #fff;
        }
        
        .button-secondary:hover {
            background: #444;
        }
        
        .search-box {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #444;
            border-radius: 8px;
            background: #2a2a2a;
            color: #fff;
            margin-bottom: 1rem;
        }
        
        .recipes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .recipe-card {
            background: #2a2a2a;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .recipe-card:hover {
            transform: translateY(-4px);
        }
        
        .recipe-image {
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            background: #333;
        }
        
        .recipe-info {
            padding: 1rem;
        }
        
        .recipe-name {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .recipe-spirit {
            color: #FFB366;
            font-size: 0.9rem;
        }
        
        .recipe-abv {
            color: #888;
            font-size: 0.8rem;
        }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
        }
        
        .modal {
            background: #2a2a2a;
            border-radius: 12px;
            padding: 2rem;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-title {
            color: #FFB366;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: #FFB366;
        }
        
        .form-input, .form-textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #444;
            border-radius: 8px;
            background: #333;
            color: #fff;
        }
        
        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        /* Header Styles */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: #2a2a2a;
            border-bottom: 1px solid #444;
        }
        
        .menu-button {
            background: none;
            border: none;
            color: #fff;
            cursor: pointer;
            padding: 0.5rem;
        }
        
        .menu-line {
            display: block;
            width: 20px;
            height: 2px;
            background: #fff;
            margin: 4px 0;
        }
        
        /* Side Menu Styles */
        .side-menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 998;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        
        .side-menu-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .side-menu {
            position: fixed;
            top: 0;
            left: -280px;
            width: 280px;
            height: 100vh;
            background: #2a2a2a;
            z-index: 999;
            transition: left 0.3s;
            padding: 1rem;
        }
        
        .side-menu.active {
            left: 0;
        }
        
        .side-menu-header {
            display: flex;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #444;
        }
        
        .side-menu-logo {
            font-size: 2rem;
            margin-right: 0.5rem;
        }
        
        .side-menu-title {
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .side-menu-nav {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .side-menu-button {
            background: none;
            border: none;
            color: #fff;
            padding: 1rem;
            text-align: left;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .side-menu-button:hover {
            background: #333;
        }
        
        .side-menu-button.active {
            background: #FFB366;
            color: #1a1a1a;
        }
        
        .side-menu-button.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Recipe View Styles */
        .recipe-view {
            position: relative;
            margin-top: 1rem;
        }
        
        .recipe-background {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: -1;
        }
        
        .recipe-content {
            background: rgba(42, 42, 42, 0.9);
            border-radius: 12px;
            padding: 2rem;
            backdrop-filter: blur(10px);
        }
        
        .recipe-title {
            font-size: 2.5rem;
            color: #FFB366;
            margin-bottom: 1rem;
        }
        
        .recipe-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .meta-item {
            background: #333;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        .recipe-details {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 2rem;
        }
        
        .ingredients-list {
            list-style: none;
        }
        
        .ingredient-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid #444;
        }
        
        .instructions {
            white-space: pre-line;
            line-height: 1.8;
        }
        
        .action-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 2rem;
        }
        
        .action-button {
            background: #333;
            color: #fff;
            border: none;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .action-button:hover {
            background: #444;
        }
        
        .action-button.scale {
            background: #4CAF50;
        }
        
        .action-button.share {
            background: #2196F3;
        }
        
        .action-button.edit {
            background: #FF9800;
        }
        
        .action-button.delete {
            background: #f44336;
        }
        
        /* Scale Recipe Styles */
        .scale-step {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #444;
        }
        
        .step-title {
            color: #FFB366;
            margin-bottom: 0.5rem;
        }
        
        .step-description {
            color: #888;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }
        
        .scale-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .option-card {
            background: #333;
            padding: 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        
        .option-card:hover {
            background: #3a3a3a;
        }
        
        .option-card.selected {
            border-color: #FFB366;
            background: #3a3a3a;
        }
        
        .option-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .option-description {
            color: #888;
            font-size: 0.9rem;
        }
        
        .scale-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .scale-input-group {
            display: flex;
            flex-direction: column;
        }
        
        .scale-input {
            padding: 0.75rem;
            border: 1px solid #444;
            border-radius: 8px;
            background: #333;
            color: #fff;
        }
        
        .dilution-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .dilution-option {
            background: #333;
            padding: 1rem;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        
        .dilution-option:hover {
            background: #3a3a3a;
        }
        
        .dilution-option.selected {
            border-color: #FFB366;
            background: #3a3a3a;
        }
        
        .dilution-percentage {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .dilution-description {
            color: #888;
            font-size: 0.8rem;
        }
        
        .custom-dilution {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .custom-dilution-input {
            padding: 0.5rem;
            border: 1px solid #444;
            border-radius: 4px;
            background: #333;
            color: #fff;
            width: 80px;
        }
        
        .scaled-ingredients {
            background: #333;
            padding: 1.5rem;
            border-radius: 8px;
            margin-top: 1rem;
        }
        
        .scaled-ingredient {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid #444;
        }
        
        .ingredient-change {
            color: #888;
            font-size: 0.8rem;
            margin-left: 0.5rem;
        }
        
        /* Settings Styles */
        .settings-section {
            background: #2a2a2a;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .settings-title {
            color: #FFB366;
            margin-bottom: 1rem;
        }
        
        .settings-list {
            list-style: none;
        }
        
        .settings-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            background: #333;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            transition: background 0.2s;
        }
        
        .settings-item:hover {
            background: #3a3a3a;
        }
        
        .settings-item.dragging {
            background: #3a3a3a;
            border: 2px dashed #FFB366;
        }
        
        .drag-handle {
            cursor: grab;
            margin-right: 1rem;
            color: #888;
        }
        
        .settings-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .icon-button {
            background: none;
            border: none;
            color: #fff;
            cursor: pointer;
            padding: 0.25rem;
            font-size: 1.2rem;
        }
        
        .icon-button.delete {
            color: #f44336;
        }
        
        .buttons-row {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }
        
        /* Image Upload Styles */
        .image-upload {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .image-preview {
            max-width: 200px;
            max-height: 200px;
            border-radius: 8px;
        }
        
        /* Search and Filter Styles */
        .search-section {
            margin-bottom: 2rem;
        }
        
        .filters {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .filter-select {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid #444;
            border-radius: 8px;
            background: #2a2a2a;
            color: #fff;
        }
        
        .sync-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #888;
            font-size: 0.9rem;
        }
        
        .sync-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
        
        .sync-indicator.synced {
            background: #4CAF50;
        }
        
        .sync-indicator.syncing {
            background: #FF9800;
            animation: pulse 1s infinite;
        }
        
        .sync-indicator.error {
            background: #f44336;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .sync-btn {
            background: #333;
            color: #fff;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .sync-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .sync-btn.syncing {
            animation: pulse 1s infinite;
        }
        
        .nav-user {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .logout-btn {
            background: #333;
            color: #fff;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .logout-btn:hover {
            background: #444;
        }
        
        /* Alphabet Navigation - RIGHT SIDE */
        .alphabet-nav {
            position: fixed;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            padding: 1rem 0.5rem;
            background: rgba(42, 42, 42, 0.9);
            border-radius: 12px 0 0 12px;
            backdrop-filter: blur(10px);
            z-index: 100;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .alphabet-letter {
            color: #FFB366;
            text-decoration: none;
            font-weight: 600;
            padding: 0.5rem;
            min-width: 30px;
            text-align: center;
            border-radius: 4px;
            transition: background 0.2s;
            font-size: 0.9rem;
        }
        
        .alphabet-letter:hover {
            background: #333;
        }
        
        .alphabet-section {
            margin-bottom: 3rem;
        }
        
        .letter-header {
            color: #FFB366;
            font-size: 1.5rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #FFB366;
        }
        
        /* Main content with right-side alphabet */
        .main-content {
            display: flex;
            gap: 2rem;
            position: relative;
        }
        
        .recipes-container {
            flex: 1;
            margin-right: 60px; /* Space for the alphabet nav */
        }
        
        /* Loading and Empty States */
        .loading {
            text-align: center;
            padding: 3rem;
            color: #888;
            font-style: italic;
        }
        
        /* Footer */
        .footer {
            text-align: center;
            padding: 2rem 1rem;
            color: #888;
            border-top: 1px solid #444;
            margin-top: 3rem;
        }
        
        .footer a {
            color: #FFB366;
            text-decoration: none;
        }
        
        .footer a:hover {
            text-decoration: underline;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .recipe-details {
                grid-template-columns: 1fr;
            }
            
            .scale-options {
                grid-template-columns: 1fr;
            }
            
            .scale-controls {
                grid-template-columns: 1fr;
            }
            
            .dilution-options {
                grid-template-columns: 1fr;
            }
            
            .filters {
                flex-direction: column;
            }
            
            .alphabet-nav {
                position: static;
                transform: none;
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
                background: #2a2a2a;
                border-radius: 8px;
                padding: 1rem;
                margin-bottom: 2rem;
                max-height: none;
            }
            
            .recipes-container {
                margin-right: 0;
            }
            
            .main-content {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAjpIE5MO0hxtNPP6CgthUJTXCUdpBBOrU",
            authDomain: "cocktail-manual-app.firebaseapp.com",
            projectId: "cocktail-manual-app",
            storageBucket: "cocktail-manual-app.firebasestorage.app",
            messagingSenderId: "678623153357",
            appId: "1:678623153357:web:3596c04dc4e5374ea4ed84"
        };
        
        // Initialize Firebase
        let app;
        let db;
        let auth;
        
        try {
            if (typeof firebase === 'undefined') {
                throw new Error('Firebase SDK not loaded');
            }
            
            app = firebase.initializeApp(firebaseConfig);
            db = firebase.firestore(app);
            auth = firebase.auth(app);
            console.log('Firebase initialized successfully');
        } catch (error) {
            console.error('Firebase initialization error:', error);
            // Fallback: Create mock Firebase functions for offline use
            db = {
                collection: () => ({
                    doc: () => ({
                        set: () => Promise.resolve(),
                        get: () => Promise.resolve({ exists: false, data: () => null }),
                        onSnapshot: () => () => {}
                    })
                })
            };
            auth = {
                signInAnonymously: () => Promise.resolve(),
                signOut: () => Promise.resolve(),
                onAuthStateChanged: (callback) => {
                    callback({ uid: 'offline-user' });
                    return () => {};
                }
            };
        }
        
        // Authentication configuration
        const ADMIN_CREDENTIALS = {
            username: 'suraj',
            password: 'cocktail123'
        };
        
        // Load data from localStorage or use defaults
        const loadFromStorage = (key, defaultValue) => {
            try {
                const item = localStorage.getItem(key);
                return item ? JSON.parse(item) : defaultValue;
            } catch {
                return defaultValue;
            }
        };
        
        const saveToStorage = (key, value) => {
            try {
                localStorage.setItem(key, JSON.stringify(value));
                return true;
            } catch (error) {
                console.error('Error saving to localStorage:', error);
                return false;
            }
        };
        
        // Data management functions - CLEAR ALL RECIPES
        const getRecipes = () => {
            // Clear all existing recipes and return empty array
            const emptyRecipes = [];
            saveToStorage('cocktailRecipes', emptyRecipes);
            return emptyRecipes;
        };
        
        const saveRecipes = (recipes) => {
            return saveToStorage('cocktailRecipes', recipes);
        };
        
        const getSyrups = () => {
            return loadFromStorage('cocktailSyrups', []);
        };
        
        const saveSyrups = (syrups) => {
            return saveToStorage('cocktailSyrups', syrups);
        };
        
        const getSettings = () => {
            return loadFromStorage('cocktailSettings', {
                spirit_types: ['Gin', 'Vodka', 'Rum', 'Tequila', 'Whiskey', 'Brandy'],
                glass_types: ['Coupe', 'Martini', 'Highball', 'Old Fashioned', 'Collins', 'Margarita'],
                venues: ['Main Bar', 'Pool Bar', 'Restaurant', 'Private Event']
            });
        };
        
        const saveSettings = (settings) => {
            return saveToStorage('cocktailSettings', settings);
        };

        // Utility function to convert image to base64
        const convertImageToBase64 = (file) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        };

        // Enhanced Firebase Data Management for Auto Sync
        const syncRecipesWithFirebase = async (recipes) => {
            try {
                console.log('Syncing recipes to Firebase:', recipes.length, 'recipes');
                await db.collection('sharedData').doc('recipes').set({
                    data: recipes,
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedBy: auth.currentUser ? auth.currentUser.uid : 'anonymous',
                    version: Date.now()
                });
                console.log('Recipes synced successfully');
                return true;
            } catch (error) {
                console.error('Error syncing recipes with Firebase:', error);
                return false;
            }
        };

        const syncSyrupsWithFirebase = async (syrups) => {
            try {
                console.log('Syncing syrups to Firebase:', syrups.length, 'syrups');
                await db.collection('sharedData').doc('syrups').set({
                    data: syrups,
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedBy: auth.currentUser ? auth.currentUser.uid : 'anonymous',
                    version: Date.now()
                });
                console.log('Syrups synced successfully');
                return true;
            } catch (error) {
                console.error('Error syncing syrups with Firebase:', error);
                return false;
            }
        };

        const syncSettingsWithFirebase = async (settings) => {
            try {
                console.log('Syncing settings to Firebase');
                await db.collection('sharedData').doc('settings').set({
                    data: settings,
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedBy: auth.currentUser ? auth.currentUser.uid : 'anonymous',
                    version: Date.now()
                });
                console.log('Settings synced successfully');
                return true;
            } catch (error) {
                console.error('Error syncing settings with Firebase:', error);
                return false;
            }
        };

        const loadRecipesFromFirebase = async () => {
            try {
                console.log('Loading recipes from Firebase...');
                const doc = await db.collection('sharedData').doc('recipes').get();
                if (doc.exists) {
                    const data = doc.data();
                    console.log('Recipes loaded from Firebase:', data.data.length, 'recipes');
                    return data.data || [];
                }
                console.log('No recipes found in Firebase');
                return [];
            } catch (error) {
                console.error('Error loading recipes from Firebase:', error);
                return null;
            }
        };

        const loadSyrupsFromFirebase = async () => {
            try {
                console.log('Loading syrups from Firebase...');
                const doc = await db.collection('sharedData').doc('syrups').get();
                if (doc.exists) {
                    const data = doc.data();
                    console.log('Syrups loaded from Firebase:', data.data.length, 'syrups');
                    return data.data || [];
                }
                console.log('No syrups found in Firebase');
                return [];
            } catch (error) {
                console.error('Error loading syrups from Firebase:', error);
                return null;
            }
        };

        const loadSettingsFromFirebase = async () => {
            try {
                console.log('Loading settings from Firebase...');
                const doc = await db.collection('sharedData').doc('settings').get();
                if (doc.exists) {
                    const data = doc.data();
                    console.log('Settings loaded from Firebase');
                    return data.data || getSettings();
                }
                console.log('No settings found in Firebase');
                return getSettings();
            } catch (error) {
                console.error('Error loading settings from Firebase:', error);
                return null;
            }
        };

        // Set up real-time listeners for data changes
        const setupFirebaseListeners = (onRecipesUpdate, onSyrupsUpdate, onSettingsUpdate) => {
            console.log('Setting up Firebase real-time listeners...');
            
            try {
                const recipesUnsubscribe = db.collection('sharedData').doc('recipes')
                    .onSnapshot((doc) => {
                        if (doc.exists) {
                            const data = doc.data();
                            console.log('Real-time update: Recipes updated from cloud', data.data.length, 'recipes');
                            onRecipesUpdate(data.data || []);
                        }
                    }, (error) => {
                        console.error('Error listening to recipes:', error);
                    });
                
                const syrupsUnsubscribe = db.collection('sharedData').doc('syrups')
                    .onSnapshot((doc) => {
                        if (doc.exists) {
                            const data = doc.data();
                            console.log('Real-time update: Syrups updated from cloud', data.data.length, 'syrups');
                            onSyrupsUpdate(data.data || []);
                        }
                    }, (error) => {
                        console.error('Error listening to syrups:', error);
                    });
                
                const settingsUnsubscribe = db.collection('sharedData').doc('settings')
                    .onSnapshot((doc) => {
                        if (doc.exists) {
                            const data = doc.data();
                            console.log('Real-time update: Settings updated from cloud');
                            onSettingsUpdate(data.data || getSettings());
                        }
                    }, (error) => {
                        console.error('Error listening to settings:', error);
                    });
                
                console.log('Firebase listeners setup complete');
                
                return () => {
                    recipesUnsubscribe();
                    syrupsUnsubscribe();
                    settingsUnsubscribe();
                    console.log('Firebase listeners cleaned up');
                };
            } catch (error) {
                console.error('Error setting up Firebase listeners:', error);
                return () => {}; // Return empty cleanup function
            }
        };

        // Drag and Drop functionality
        const reorder = (list, startIndex, endIndex) => {
            const result = Array.from(list);
            const [removed] = result.splice(startIndex, 1);
            result.splice(endIndex, 0, removed);
            return result;
        };

        // Share functionality
        const shareContent = async (content, title = 'Cocktail Codex') => {
            const text = `${title}\n\n${content}`;
            
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: title,
                        text: text
                    });
                } catch (error) {
                    if (error.name !== 'AbortError') {
                        fallbackShare(text, title);
                    }
                }
            } else {
                fallbackShare(text, title);
            }
        };

        const fallbackShare = (text, title) => {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(() => {
                    alert('Copied to clipboard!');
                }).catch(() => {
                    prompt('Copy this text:', text);
                });
            } else {
                prompt('Copy this text:', text);
            }
        };

        const generateRecipeShareText = (recipe) => {
            let text = `üç∏ ${recipe.name}\n`;
            text += `Spirit: ${recipe.spirit_type}\n`;
            text += `Glass: ${recipe.glass_type}\n`;
            text += `ABV: ${recipe.abv}% | Cost: $${recipe.pour_cost}\n\n`;
            
            text += `INGREDIENTS:\n`;
            recipe.ingredients.forEach(ingredient => {
                text += `‚Ä¢ ${ingredient.name}: ${ingredient.amount} ${ingredient.unit}\n`;
            });
            
            text += `\nINSTRUCTIONS:\n${recipe.instructions}\n`;
            
            if (recipe.notes) {
                text += `\nNOTES:\n${recipe.notes}\n`;
            }
            
            text += `\n---\nShared from Cocktail Codex`;
            return text;
        };

        const generateSyrupShareText = (syrup) => {
            let text = `üß™ ${syrup.name} (${syrup.type})\n\n`;
            
            if (syrup.ingredients && syrup.ingredients.length > 0) {
                text += `INGREDIENTS:\n`;
                syrup.ingredients.forEach(ingredient => {
                    text += `‚Ä¢ ${ingredient.name}: ${ingredient.amount} ${ingredient.unit}\n`;
                });
                text += `\n`;
            }
            
            if (syrup.instructions) {
                text += `INSTRUCTIONS:\n${syrup.instructions}\n\n`;
            }
            
            if (syrup.shelf_life) {
                text += `Shelf Life: ${syrup.shelf_life}\n`;
            }
            
            if (syrup.storage) {
                text += `Storage: ${syrup.storage}\n`;
            }
            
            text += `\n---\nShared from Cocktail Codex`;
            return text;
        };

        // Scale functionality
        const calculateTotalVolume = (ingredients) => {
            return ingredients.reduce((total, ingredient) => {
                if (['ml', 'oz'].includes(ingredient.unit)) {
                    return total + parseFloat(ingredient.amount);
                }
                return total;
            }, 0);
        };

        const scaleIngredients = (ingredients, scaleFactor, dilutionPercentage = 0) => {
            const scaledIngredients = ingredients.map(ingredient => ({
                ...ingredient,
                scaledAmount: Math.round(ingredient.amount * scaleFactor * 10) / 10
            }));

            // Add dilution if specified
            if (dilutionPercentage > 0) {
                const totalVolume = calculateTotalVolume(scaledIngredients);
                const dilutionAmount = (totalVolume * dilutionPercentage) / (100 - dilutionPercentage);
                
                if (dilutionAmount > 0) {
                    scaledIngredients.push({
                        name: 'Water (dilution)',
                        amount: Math.round(dilutionAmount * 10) / 10,
                        unit: 'ml',
                        scaledAmount: Math.round(dilutionAmount * 10) / 10,
                        isDilution: true
                    });
                }
            }

            return scaledIngredients;
        };

        // Scale Recipe Modal Component
        function ScaleRecipeModal({ recipe, onClose }) {
            const [scaleType, setScaleType] = useState('servings'); // 'servings' or 'volume'
            const [servings, setServings] = useState(1);
            const [totalVolume, setTotalVolume] = useState('');
            const [volumeUnit, setVolumeUnit] = useState('ml');
            const [dilutionPercentage, setDilutionPercentage] = useState(0);
            const [customDilution, setCustomDilution] = useState('');
            const [scaledIngredients, setScaledIngredients] = useState([]);
            
            // Calculate scale factor based on current settings
            const calculateScaleFactor = () => {
                if (scaleType === 'servings') {
                    return servings;
                } else {
                    // Calculate based on total volume
                    const originalVolume = calculateTotalVolume(recipe.ingredients);
                    if (originalVolume === 0) return 1;
                    
                    let targetVolume = parseFloat(totalVolume);
                    if (volumeUnit === 'oz') {
                        targetVolume = targetVolume * 29.5735; // Convert oz to ml
                    }
                    
                    return targetVolume / originalVolume;
                }
            };

            // Update scaled ingredients when settings change
            useEffect(() => {
                const scaleFactor = calculateScaleFactor();
                const dilution = customDilution ? parseFloat(customDilution) : dilutionPercentage;
                setScaledIngredients(scaleIngredients(recipe.ingredients, scaleFactor, dilution));
            }, [scaleType, servings, totalVolume, volumeUnit, dilutionPercentage, customDilution, recipe.ingredients]);

            const handleServingsChange = (e) => {
                const value = parseFloat(e.target.value) || 1;
                setServings(Math.max(0.1, value));
            };

            const handleTotalVolumeChange = (e) => {
                setTotalVolume(e.target.value);
            };

            const handleDilutionSelect = (percentage) => {
                setDilutionPercentage(percentage);
                setCustomDilution('');
            };

            const handleCustomDilutionChange = (e) => {
                const value = e.target.value;
                setCustomDilution(value);
                if (value) {
                    setDilutionPercentage(0);
                }
            };

            const shareScaledRecipe = () => {
                const scaleFactor = calculateScaleFactor();
                const dilution = customDilution ? parseFloat(customDilution) : dilutionPercentage;
                
                const scaledRecipe = {
                    ...recipe,
                    ingredients: scaledIngredients
                };
                
                let shareText = generateRecipeShareText(scaledRecipe);
                
                // Add scaling information
                let scalingInfo = '';
                if (scaleType === 'servings') {
                    scalingInfo = `Scaled to ${servings} serving${servings !== 1 ? 's' : ''}`;
                } else {
                    scalingInfo = `Scaled to ${totalVolume} ${volumeUnit} total volume`;
                }
                
                if (dilution > 0) {
                    scalingInfo += ` with ${dilution}% dilution`;
                }
                
                shareText = shareText.replace('Shared from Cocktail Codex', `${scalingInfo} | Shared from Cocktail Codex`);
                
                shareContent(shareText, `Scaled ${recipe.name} Recipe`);
            };

            const scaleFactor = calculateScaleFactor();
            const currentDilution = customDilution ? parseFloat(customDilution) : dilutionPercentage;

            return (
                <div className="modal-overlay">
                    <div className="modal">
                        <h2 className="modal-title">Scale Recipe: {recipe.name}</h2>
                        
                        {/* Step 1: Scale Type Selection */}
                        <div className="scale-step">
                            <h3 className="step-title">Select Scaling Method</h3>
                            <p className="step-description">
                                Choose whether you'd like to scale by the number of servings or by total volume.
                            </p>
                            <div className="scale-options">
                                <div className="scale-option">
                                    <div 
                                        className={`option-card ${scaleType === 'servings' ? 'selected' : ''}`}
                                        onClick={() => setScaleType('servings')}
                                    >
                                        <div className="option-title">Scale by Servings</div>
                                        <div className="option-description">
                                            Choose this option if you know how many servings you need.
                                        </div>
                                    </div>
                                </div>
                                <div className="scale-option">
                                    <div 
                                        className={`option-card ${scaleType === 'volume' ? 'selected' : ''}`}
                                        onClick={() => setScaleType('volume')}
                                    >
                                        <div className="option-title">Scale by Volume</div>
                                        <div className="option-description">
                                            Ideal for filling a specific container or batch size.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Step 2: Quantity Input */}
                        <div className="scale-step">
                            <h3 className="step-title">Enter Quantity</h3>
                            {scaleType === 'servings' ? (
                                <div className="scale-controls">
                                    <div className="scale-input-group">
                                        <label className="form-label">Number of Servings (with decimal points)</label>
                                        <input
                                            type="number"
                                            className="scale-input"
                                            value={servings}
                                            onChange={handleServingsChange}
                                            min="0.1"
                                            max="100"
                                            step="0.1"
                                        />
                                    </div>
                                </div>
                            ) : (
                                <div className="scale-controls">
                                    <div className="scale-input-group">
                                        <label className="form-label">Total Volume</label>
                                        <input
                                            type="number"
                                            className="scale-input"
                                            value={totalVolume}
                                            onChange={handleTotalVolumeChange}
                                            min="1"
                                            step="1"
                                            placeholder="Enter volume"
                                        />
                                    </div>
                                    <div className="scale-input-group">
                                        <label className="form-label">Unit</label>
                                        <select
                                            className="scale-input"
                                            value={volumeUnit}
                                            onChange={(e) => setVolumeUnit(e.target.value)}
                                        >
                                            <option value="ml">ml</option>
                                            <option value="oz">oz</option>
                                        </select>
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* Step 3: Dilution Options */}
                        <div className="scale-step">
                            <h3 className="step-title">Add Dilution (Optional)</h3>
                            <p className="step-description">
                                Choose a dilution percentage that suits your cocktail. If none of the presets fit, you can enter a custom dilution percentage.
                            </p>
                            
                            <div className="dilution-options">
                                <div 
                                    className={`dilution-option ${dilutionPercentage === 0 && !customDilution ? 'selected' : ''}`}
                                    onClick={() => handleDilutionSelect(0)}
                                >
                                    <div className="dilution-percentage">0%</div>
                                    <div className="dilution-description">No Dilution</div>
                                </div>
                                <div 
                                    className={`dilution-option ${dilutionPercentage === 18 ? 'selected' : ''}`}
                                    onClick={() => handleDilutionSelect(18)}
                                >
                                    <div className="dilution-percentage">18%</div>
                                    <div className="dilution-description">Spirit-Driven</div>
                                </div>
                                <div 
                                    className={`dilution-option ${dilutionPercentage === 25 ? 'selected' : ''}`}
                                    onClick={() => handleDilutionSelect(25)}
                                >
                                    <div className="dilution-percentage">25%</div>
                                    <div className="dilution-description">Shaken Cocktails</div>
                                </div>
                            </div>
                            
                            <div className="custom-dilution">
                                <span style={{color: '#FFB366'}}>Custom:</span>
                                <input
                                    type="number"
                                    className="custom-dilution-input"
                                    value={customDilution}
                                    onChange={handleCustomDilutionChange}
                                    placeholder="Enter %"
                                    min="0"
                                    max="50"
                                />
                                <span>%</span>
                            </div>
                        </div>

                        {/* Scaled Ingredients Preview */}
                        <div className="scaled-ingredients">
                            <h3 style={{color: '#FFB366', marginBottom: '1rem'}}>
                                Scaled Ingredients {scaleFactor !== 1 && `(${scaleFactor.toFixed(1)}x)`}
                            </h3>
                            {scaledIngredients.map((ingredient, index) => (
                                <div key={index} className="scaled-ingredient">
                                    <span>
                                        {ingredient.name}
                                        {ingredient.isDilution && <span style={{color: '#888', fontSize: '0.8rem'}}> (dilution)</span>}
                                    </span>
                                    <span>
                                        <strong>{ingredient.scaledAmount}</strong> {ingredient.unit}
                                        {scaleFactor !== 1 && !ingredient.isDilution && (
                                            <span className="ingredient-change">
                                                (was {ingredient.amount})
                                            </span>
                                        )}
                                    </span>
                                </div>
                            ))}
                        </div>
                        
                        <div className="action-buttons" style={{marginTop: '1.5rem'}}>
                            <button className="action-button share" onClick={shareScaledRecipe}>
                                üì§ Share Scaled Recipe
                            </button>
                            <button className="action-button" onClick={onClose}>
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // Authentication Hook
        function useAuth() {
            const [user, setUser] = useState(null);
            const [firebaseUser, setFirebaseUser] = useState(null);
            
            useEffect(() => {
                const savedUser = localStorage.getItem('cocktailAppUser');
                if (savedUser) {
                    setUser(JSON.parse(savedUser));
                }
                
                const unsubscribe = auth.onAuthStateChanged((firebaseUser) => {
                    setFirebaseUser(firebaseUser);
                    console.log('Firebase auth state changed:', firebaseUser ? 'Logged in' : 'Logged out');
                });
                
                return () => unsubscribe();
            }, []);
            
            const login = async (username, password) => {
                if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
                    const userData = { username, isAdmin: true };
                    setUser(userData);
                    localStorage.setItem('cocktailAppUser', JSON.stringify(userData));
                    
                    try {
                        await auth.signInAnonymously();
                        console.log('Admin logged in and authenticated with Firebase');
                    } catch (error) {
                        console.error('Firebase auth error:', error);
                    }
                    
                    return true;
                }
                return false;
            };
            
            const loginAsGuest = async () => {
                const guestUser = { username: 'Guest', isAdmin: false };
                setUser(guestUser);
                localStorage.setItem('cocktailAppUser', JSON.stringify(guestUser));
                
                try {
                    await auth.signInAnonymously();
                    console.log('Guest logged in and authenticated with Firebase');
                } catch (error) {
                    console.error('Firebase auth error:', error);
                }
                
                return true;
            };
            
            const logout = () => {
                setUser(null);
                localStorage.removeItem('cocktailAppUser');
                auth.signOut();
                console.log('User logged out');
            };
            
            return { user, firebaseUser, login, loginAsGuest, logout };
        }

        // Hamburger Menu Component
        function HamburgerMenu({ isOpen, onToggle, currentPage, onNavigate, isAdmin }) {
            const menuRef = useRef(null);
            
            useEffect(() => {
                const handleClickOutside = (event) => {
                    if (menuRef.current && !menuRef.current.contains(event.target) && 
                        !event.target.closest('.menu-button')) {
                        onToggle(false);
                    }
                };
                
                if (isOpen) {
                    document.addEventListener('mousedown', handleClickOutside);
                    document.addEventListener('touchstart', handleClickOutside);
                }
                
                return () => {
                    document.removeEventListener('mousedown', handleClickOutside);
                    document.removeEventListener('touchstart', handleClickOutside);
                };
            }, [isOpen, onToggle]);
            
            const handleNavigation = (page) => {
                onNavigate(page);
                onToggle(false);
            };
            
            return (
                <>
                    <div className={`side-menu-overlay ${isOpen ? 'active' : ''}`} />
                    <div ref={menuRef} className={`side-menu ${isOpen ? 'active' : ''}`}>
                        <div className="side-menu-header">
                            <div className="side-menu-logo">üç∏</div>
                            <div className="side-menu-title">Cocktail Codex</div>
                        </div>
                        
                        <nav className="side-menu-nav">
                            <button 
                                className={`side-menu-button ${currentPage === 'home' ? 'active' : ''}`}
                                onClick={() => handleNavigation('home')}
                            >
                                üìñ Cocktail Codex
                            </button>
                            
                            <button 
                                className={`side-menu-button ${currentPage === 'create-recipe' ? 'active' : ''} ${
                                    !isAdmin ? 'disabled' : ''
                                }`}
                                onClick={() => isAdmin && handleNavigation('create-recipe')}
                                title={!isAdmin ? 'Admin access required' : ''}
                            >
                                ‚ûï Add Recipe
                            </button>
                            
                            <button 
                                className={`side-menu-button ${currentPage === 'syrups' ? 'active' : ''} ${
                                    !isAdmin ? 'disabled' : ''
                                }`}
                                onClick={() => isAdmin && handleNavigation('syrups')}
                                title={!isAdmin ? 'Admin access required' : ''}
                            >
                                üß™ Syrups & Infusions
                            </button>
                            
                            <button 
                                className={`side-menu-button ${currentPage === 'settings' ? 'active' : ''} ${
                                    !isAdmin ? 'disabled' : ''
                                }`}
                                onClick={() => isAdmin && handleNavigation('settings')}
                                title={!isAdmin ? 'Admin access required' : ''}
                            >
                                ‚öôÔ∏è Settings
                            </button>
                        </nav>
                    </div>
                </>
            );
        }

        // Recipe Card Component
        function RecipeCard({ recipe, onClick, isAdmin }) {
            const imageStyle = {
                backgroundImage: recipe.image_url ? `url(${recipe.image_url})` : 'none',
                backgroundSize: 'cover',
                backgroundPosition: 'center'
            };
            
            return (
                <div className="recipe-card" onClick={() => onClick(recipe)}>
                    <div className="recipe-image" style={imageStyle}>
                        {!recipe.image_url && 'üç∏'}
                    </div>
                    <div className="recipe-info">
                        <div className="recipe-name">{recipe.name}</div>
                        <div className="recipe-spirit">{recipe.spirit_type}</div>
                        <div className="recipe-abv">{recipe.abv}% ABV</div>
                    </div>
                </div>
            );
        }

        // Alphabet Navigation Component - RIGHT SIDE
        function AlphabetNav({ letters, onLetterClick }) {
            return (
                <div className="alphabet-nav">
                    {letters.map(letter => (
                        <a
                            key={letter}
                            className="alphabet-letter"
                            href={`#letter-${letter}`}
                            onClick={(e) => {
                                e.preventDefault();
                                onLetterClick(letter);
                            }}
                        >
                            {letter}
                        </a>
                    ))}
                </div>
            );
        }

        // Home Page Component with Right-Side Alphabet Navigation
        function HomePage({ onRecipeClick, onDeleteRecipe, isAdmin, onCreateRecipe, recipes, syncStatus, onManualSync }) {
            const [searchTerm, setSearchTerm] = useState('');
            const [filterSpirit, setFilterSpirit] = useState('All');
            const [filterVenue, setFilterVenue] = useState('All');
            const settings = getSettings();
            
            // Filter recipes based on search and filters
            const filteredRecipes = recipes.filter(recipe => {
                const matchesSearch = recipe.name.toLowerCase().includes(searchTerm.toLowerCase());
                const matchesSpirit = filterSpirit === 'All' || recipe.spirit_type === filterSpirit;
                const matchesVenue = filterVenue === 'All' || recipe.venue === filterVenue;
                
                return matchesSearch && matchesSpirit && matchesVenue;
            });
            
            // Group recipes by first letter
            const groupedRecipes = filteredRecipes.reduce((groups, recipe) => {
                const firstLetter = recipe.name.charAt(0).toUpperCase();
                if (!groups[firstLetter]) {
                    groups[firstLetter] = [];
                }
                groups[firstLetter].push(recipe);
                return groups;
            }, {});
            
            // Sort the groups alphabetically
            const sortedLetters = Object.keys(groupedRecipes).sort();
            
            // Scroll to letter function
            const scrollToLetter = (letter) => {
                const element = document.getElementById(`letter-${letter}`);
                if (element) {
                    element.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            };
            
            return (
                <div className="container">
                    <div className="page-header">
                        <h1 className="page-title">Cocktail Codex</h1>
                        {isAdmin && (
                            <button className="button" onClick={onCreateRecipe}>
                                + Add Recipe
                            </button>
                        )}
                    </div>
                    
                    <div className="search-section">
                        <input 
                            type="text"
                            className="search-box"
                            placeholder="Search cocktails..."
                            value={searchTerm}
                            onChange={(e) => setSearchTerm(e.target.value)}
                        />
                        
                        <div className="filters">
                            <select 
                                className="filter-select"
                                value={filterSpirit}
                                onChange={(e) => setFilterSpirit(e.target.value)}
                            >
                                <option value="All">All Spirits</option>
                                {settings.spirit_types.map(spirit => (
                                    <option key={spirit} value={spirit}>{spirit}</option>
                                ))}
                            </select>
                            
                            <select 
                                className="filter-select"
                                value={filterVenue}
                                onChange={(e) => setFilterVenue(e.target.value)}
                            >
                                <option value="All">All Venues</option>
                                {settings.venues.map(venue => (
                                    <option key={venue} value={venue}>{venue}</option>
                                ))}
                            </select>
                        </div>
                        
                        {/* REMOVED the second sync button from here */}
                    </div>
                    
                    <div className="main-content">
                        <div className="recipes-container">
                            {filteredRecipes.length === 0 ? (
                                <div className="loading">
                                    {recipes.length === 0 ? (
                                        'No cocktails available. Login as admin to add recipes.'
                                    ) : (
                                        'No cocktails found matching your criteria.'
                                    )}
                                </div>
                            ) : (
                                <>
                                    <div style={{marginBottom: '1rem', color: '#888', fontSize: '0.9rem'}}>
                                        Showing {filteredRecipes.length} of {recipes.length} cocktails
                                    </div>
                                    {sortedLetters.map(letter => (
                                        <div key={letter} id={`letter-${letter}`} className="alphabet-section">
                                            <h2 className="letter-header">{letter}</h2>
                                            <div className="recipes-grid">
                                                {groupedRecipes[letter].map(recipe => (
                                                    <RecipeCard 
                                                        key={recipe.id}
                                                        recipe={recipe}
                                                        onClick={onRecipeClick}
                                                        isAdmin={isAdmin}
                                                    />
                                                ))}
                                            </div>
                                        </div>
                                    ))}
                                </>
                            )}
                        </div>
                        
                        {/* Right-side Alphabet Navigation */}
                        {sortedLetters.length > 0 && (
                            <AlphabetNav letters={sortedLetters} onLetterClick={scrollToLetter} />
                        )}
                    </div>
                </div>
            );
        }

        // View Recipe Component with Scale and Share
        function ViewRecipePage({ recipe, onBack, isAdmin, onDeleteRecipe, onEditRecipe }) {
            const [showScaleModal, setShowScaleModal] = useState(false);
            const backgroundStyle = {
                backgroundImage: recipe.image_url ? `url(${recipe.image_url})` : 'none',
                backgroundSize: 'cover',
                backgroundPosition: 'center',
                filter: 'brightness(0.3) blur(2px)'
            };
            
            const handleShareRecipe = () => {
                const shareText = generateRecipeShareText(recipe);
                shareContent(shareText, `${recipe.name} Recipe`);
            };
            
            return (
                <div className="container">
                    <button className="button button-secondary" onClick={onBack}>
                        ‚Üê Back to Cocktails
                    </button>
                    
                    <div className="recipe-view">
                        {recipe.image_url && (
                            <div className="recipe-background" style={backgroundStyle}></div>
                        )}
                        
                        <div className="recipe-content">
                            <div className="recipe-header">
                                <div>
                                    <h1 className="recipe-title">{recipe.name}</h1>
                                    <div className="recipe-meta">
                                        <div className="meta-item">{recipe.spirit_type}</div>
                                        <div className="meta-item">{recipe.glass_type} Glass</div>
                                        <div className="meta-item">{recipe.abv}% ABV</div>
                                        <div className="meta-item">${recipe.pour_cost} Cost</div>
                                        <div className="meta-item">{recipe.venue}</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div className="recipe-details">
                                <div>
                                    <h3 style={{color: '#FFB366', marginBottom: '1rem'}}>Ingredients</h3>
                                    <ul className="ingredients-list">
                                        {recipe.ingredients.map((ingredient, index) => (
                                            <li key={index} className="ingredient-item">
                                                <span>{ingredient.name}</span>
                                                <span>{ingredient.amount} {ingredient.unit}</span>
                                            </li>
                                        ))}
                                    </ul>
                                </div>
                                
                                <div>
                                    <h3 style={{color: '#FFB366', marginBottom: '1rem'}}>Instructions</h3>
                                    <div className="instructions">{recipe.instructions}</div>
                                    
                                    {recipe.notes && (
                                        <>
                                            <h3 style={{color: '#FFB366', marginBottom: '1rem', marginTop: '1.5rem'}}>Notes</h3>
                                            <div className="instructions">{recipe.notes}</div>
                                        </>
                                    )}
                                    
                                    <div className="action-buttons">
                                        <button className="action-button scale" onClick={() => setShowScaleModal(true)}>
                                            ‚öñÔ∏è Scale Recipe
                                        </button>
                                        <button className="action-button share" onClick={handleShareRecipe}>
                                            üì§ Share Recipe
                                        </button>
                                        {isAdmin && (
                                            <>
                                                <button 
                                                    className="action-button edit"
                                                    onClick={() => {
                                                        if (onEditRecipe) {
                                                            onEditRecipe(recipe);
                                                        }
                                                    }}
                                                >
                                                    ‚úèÔ∏è Edit
                                                </button>
                                                <button 
                                                    className="action-button delete"
                                                    onClick={() => onDeleteRecipe(recipe.id)}
                                                >
                                                    üóëÔ∏è Delete
                                                </button>
                                            </>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    {showScaleModal && (
                        <ScaleRecipeModal 
                            recipe={recipe} 
                            onClose={() => setShowScaleModal(false)} 
                        />
                    )}
                </div>
            );
        }

        // Create/Edit Recipe Component
        function CreateEditRecipePage({ recipe, onBack, onSave, isEdit = false }) {
            const [formData, setFormData] = useState(
                recipe || {
                    name: '',
                    spirit_type: '',
                    venue: '',
                    glass_type: '',
                    abv: '',
                    pour_cost: '',
                    image_url: '',
                    ingredients: [{ name: '', amount: '', unit: 'ml' }],
                    instructions: '',
                    notes: ''
                }
            );
            
            const [imagePreview, setImagePreview] = useState(recipe?.image_url || '');
            const settings = getSettings();
            
            const handleInputChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({
                    ...prev,
                    [name]: value
                }));
            };
            
            const handleIngredientChange = (index, field, value) => {
                const updatedIngredients = [...formData.ingredients];
                updatedIngredients[index][field] = value;
                setFormData(prev => ({
                    ...prev,
                    ingredients: updatedIngredients
                }));
            };
            
            const addIngredient = () => {
                setFormData(prev => ({
                    ...prev,
                    ingredients: [...prev.ingredients, { name: '', amount: '', unit: 'ml' }]
                }));
            };
            
            const removeIngredient = (index) => {
                if (formData.ingredients.length > 1) {
                    const updatedIngredients = [...formData.ingredients];
                    updatedIngredients.splice(index, 1);
                    setFormData(prev => ({
                        ...prev,
                        ingredients: updatedIngredients
                    }));
                }
            };
            
            const handleImageUpload = async (e) => {
                const file = e.target.files[0];
                if (file) {
                    try {
                        const base64 = await convertImageToBase64(file);
                        setFormData(prev => ({
                            ...prev,
                            image_url: base64
                        }));
                        setImagePreview(base64);
                    } catch (error) {
                        console.error('Error uploading image:', error);
                        alert('Error uploading image. Please try again.');
                    }
                }
            };
            
            const handleSubmit = (e) => {
                e.preventDefault();
                
                if (!formData.name) {
                    alert('Please at least enter a cocktail name');
                    return;
                }
                
                const recipeData = {
                    ...formData,
                    id: isEdit ? formData.id : Date.now().toString(),
                    abv: parseFloat(formData.abv) || 0,
                    pour_cost: parseFloat(formData.pour_cost) || 0,
                    createdBy: isEdit ? formData.createdBy : 'user',
                    createdAt: isEdit ? formData.createdAt : new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                onSave(recipeData);
            };
            
            return (
                <div className="container">
                    <button className="button button-secondary" onClick={onBack}>
                        ‚Üê Back to Cocktails
                    </button>
                    
                    <h1 className="page-title">{isEdit ? 'Edit Cocktail' : 'Add New Cocktail'}</h1>
                    
                    <form className="form" onSubmit={handleSubmit}>
                        <div className="form-group">
                            <label className="form-label">Cocktail Name *</label>
                            <input
                                type="text"
                                className="form-input"
                                name="name"
                                value={formData.name}
                                onChange={handleInputChange}
                                required
                            />
                        </div>
                        
                        <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem'}}>
                            <div className="form-group">
                                <label className="form-label">Spirit Type</label>
                                <select
                                    className="form-input"
                                    name="spirit_type"
                                    value={formData.spirit_type}
                                    onChange={handleInputChange}
                                >
                                    <option value="">Select Spirit</option>
                                    {settings.spirit_types.map(spirit => (
                                        <option key={spirit} value={spirit}>{spirit}</option>
                                    ))}
                                </select>
                            </div>
                            
                            <div className="form-group">
                                <label className="form-label">Venue</label>
                                <select
                                    className="form-input"
                                    name="venue"
                                    value={formData.venue}
                                    onChange={handleInputChange}
                                >
                                    <option value="">Select Venue</option>
                                    {settings.venues.map(venue => (
                                        <option key={venue} value={venue}>{venue}</option>
                                    ))}
                                </select>
                            </div>
                        </div>
                        
                        <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem'}}>
                            <div className="form-group">
                                <label className="form-label">Glass Type</label>
                                <select
                                    className="form-input"
                                    name="glass_type"
                                    value={formData.glass_type}
                                    onChange={handleInputChange}
                                >
                                    <option value="">Select Glass</option>
                                    {settings.glass_types.map(glass => (
                                        <option key={glass} value={glass}>{glass}</option>
                                    ))}
                                </select>
                            </div>
                            
                            <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem'}}>
                                <div className="form-group">
                                    <label className="form-label">ABV (%)</label>
                                    <input
                                        type="number"
                                        step="0.1"
                                        className="form-input"
                                        name="abv"
                                        value={formData.abv}
                                        onChange={handleInputChange}
                                    />
                                </div>
                                
                                <div className="form-group">
                                    <label className="form-label">Pour Cost ($)</label>
                                    <input
                                        type="number"
                                        step="0.01"
                                        className="form-input"
                                        name="pour_cost"
                                        value={formData.pour_cost}
                                        onChange={handleInputChange}
                                    />
                                </div>
                            </div>
                        </div>
                        
                        <div className="form-group">
                            <label className="form-label">Cocktail Image</label>
                            <div className="image-upload">
                                <input
                                    type="file"
                                    accept="image/*"
                                    onChange={handleImageUpload}
                                    style={{display: 'none'}}
                                    id="image-upload"
                                />
                                <label htmlFor="image-upload" className="button button-secondary" style={{display: 'inline-block', marginBottom: '1rem'}}>
                                    {imagePreview ? 'Change Image' : 'Upload Image'}
                                </label>
                                {imagePreview && (
                                    <img src={imagePreview} alt="Preview" className="image-preview" />
                                )}
                            </div>
                        </div>
                        
                        <div className="form-group">
                            <label className="form-label">Ingredients</label>
                            {formData.ingredients.map((ingredient, index) => (
                                <div key={index} style={{display: 'flex', gap: '0.5rem', marginBottom: '0.5rem', alignItems: 'center'}}>
                                    <input
                                        type="text"
                                        className="form-input"
                                        placeholder="Ingredient name"
                                        value={ingredient.name}
                                        onChange={(e) => handleIngredientChange(index, 'name', e.target.value)}
                                        style={{flex: 2}}
                                    />
                                    <input
                                        type="number"
                                        step="0.1"
                                        className="form-input"
                                        placeholder="Amount"
                                        value={ingredient.amount}
                                        onChange={(e) => handleIngredientChange(index, 'amount', e.target.value)}
                                        style={{flex: 1}}
                                    />
                                    <select
                                        className="form-input"
                                        value={ingredient.unit}
                                        onChange={(e) => handleIngredientChange(index, 'unit', e.target.value)}
                                        style={{flex: 1}}
                                    >
                                        <option value="ml">ml</option>
                                        <option value="oz">oz</option>
                                        <option value="dash">dash</option>
                                        <option value="drops">drops</option>
                                        <option value="pcs">pcs</option>
                                    </select>
                                    {formData.ingredients.length > 1 && (
                                        <button
                                            type="button"
                                            className="icon-button delete"
                                            onClick={() => removeIngredient(index)}
                                        >
                                            √ó
                                        </button>
                                    )}
                                </div>
                            ))}
                            <button type="button" className="button button-secondary" onClick={addIngredient}>
                                + Add Ingredient
                            </button>
                        </div>
                        
                        <div className="form-group">
                            <label className="form-label">Instructions</label>
                            <textarea
                                className="form-textarea"
                                name="instructions"
                                value={formData.instructions}
                                onChange={handleInputChange}
                            />
                        </div>
                        
                        <div className="form-group">
                            <label className="form-label">Notes</label>
                            <textarea
                                className="form-textarea"
                                name="notes"
                                value={formData.notes}
                                onChange={handleInputChange}
                            />
                        </div>
                        
                        <div className="buttons-row">
                            <button type="submit" className="button">
                                {isEdit ? 'Update Cocktail' : 'Save Cocktail'}
                            </button>
                            <button type="button" className="button button-secondary" onClick={onBack}>
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>
            );
        }

        // Syrups Page Component with Enhanced Ingredients
        function SyrupsPage({ onBack, isAdmin, syrups, onSaveSyrup, onDeleteSyrup }) {
            const [editingSyrup, setEditingSyrup] = useState(null);
            const [isEditing, setIsEditing] = useState(false);
            const [formData, setFormData] = useState({
                name: '',
                type: 'syrup',
                ingredients: [{ name: '', amount: '', unit: 'ml' }],
                instructions: '',
                shelf_life: '',
                storage: ''
            });
            
            const handleInputChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({
                    ...prev,
                    [name]: value
                }));
            };
            
            const handleIngredientChange = (index, field, value) => {
                const updatedIngredients = [...formData.ingredients];
                updatedIngredients[index][field] = value;
                setFormData(prev => ({
                    ...prev,
                    ingredients: updatedIngredients
                }));
            };
            
            const addIngredient = () => {
                setFormData(prev => ({
                    ...prev,
                    ingredients: [...prev.ingredients, { name: '', amount: '', unit: 'ml' }]
                }));
            };
            
            const removeIngredient = (index) => {
                if (formData.ingredients.length > 1) {
                    const updatedIngredients = [...formData.ingredients];
                    updatedIngredients.splice(index, 1);
                    setFormData(prev => ({
                        ...prev,
                        ingredients: updatedIngredients
                    }));
                }
            };
            
            const handleSubmit = (e) => {
                e.preventDefault();
                
                if (!formData.name) {
                    alert('Please enter a name');
                    return;
                }
                
                const syrupData = {
                    ...formData,
                    id: isEditing ? editingSyrup.id : Date.now().toString(),
                    createdAt: isEditing ? editingSyrup.createdAt : new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                onSaveSyrup(syrupData);
                setFormData({
                    name: '',
                    type: 'syrup',
                    ingredients: [{ name: '', amount: '', unit: 'ml' }],
                    instructions: '',
                    shelf_life: '',
                    storage: ''
                });
                setIsEditing(false);
                setEditingSyrup(null);
            };
            
            const handleEdit = (syrup) => {
                setEditingSyrup(syrup);
                setIsEditing(true);
                setFormData({
                    name: syrup.name,
                    type: syrup.type,
                    ingredients: syrup.ingredients || [{ name: '', amount: '', unit: 'ml' }],
                    instructions: syrup.instructions,
                    shelf_life: syrup.shelf_life,
                    storage: syrup.storage
                });
            };
            
            const handleCancel = () => {
                setFormData({
                    name: '',
                    type: 'syrup',
                    ingredients: [{ name: '', amount: '', unit: 'ml' }],
                    instructions: '',
                    shelf_life: '',
                    storage: ''
                });
                setIsEditing(false);
                setEditingSyrup(null);
            };
            
            const handleShareSyrup = (syrup) => {
                const shareText = generateSyrupShareText(syrup);
                shareContent(shareText, `${syrup.name} ${syrup.type}`);
            };
            
            return (
                <div className="container">
                    <button className="button button-secondary" onClick={onBack}>
                        ‚Üê Back to Cocktails
                    </button>
                    
                    <h1 className="page-title">Syrups & Infusions</h1>
                    
                    {!isAdmin ? (
                        <div className="settings-section">
                            <p>Admin access required to manage syrups.</p>
                        </div>
                    ) : (
                        <>
                            <div className="form">
                                <h3 style={{color: '#FFB366', marginBottom: '1rem'}}>
                                    {isEditing ? 'Edit Syrup/Infusion' : 'Add New Syrup/Infusion'}
                                </h3>
                                <form onSubmit={handleSubmit}>
                                    <div className="form-group">
                                        <label className="form-label">Name *</label>
                                        <input
                                            type="text"
                                            className="form-input"
                                            name="name"
                                            value={formData.name}
                                            onChange={handleInputChange}
                                            required
                                        />
                                    </div>
                                    
                                    <div className="form-group">
                                        <label className="form-label">Type</label>
                                        <select
                                            className="form-input"
                                            name="type"
                                            value={formData.type}
                                            onChange={handleInputChange}
                                        >
                                            <option value="syrup">Syrup</option>
                                            <option value="infusion">Infusion</option>
                                            <option value="tincture">Tincture</option>
                                            <option value="bitters">Bitters</option>
                                        </select>
                                    </div>
                                    
                                    <div className="form-group">
                                        <label className="form-label">Ingredients</label>
                                        {formData.ingredients.map((ingredient, index) => (
                                            <div key={index} style={{display: 'flex', gap: '0.5rem', marginBottom: '0.5rem', alignItems: 'center'}}>
                                                <input
                                                    type="text"
                                                    className="form-input"
                                                    placeholder="Ingredient name"
                                                    value={ingredient.name}
                                                    onChange={(e) => handleIngredientChange(index, 'name', e.target.value)}
                                                    style={{flex: 2}}
                                                />
                                                <input
                                                    type="number"
                                                    step="0.1"
                                                    className="form-input"
                                                    placeholder="Amount"
                                                    value={ingredient.amount}
                                                    onChange={(e) => handleIngredientChange(index, 'amount', e.target.value)}
                                                    style={{flex: 1}}
                                                />
                                                <select
                                                    className="form-input"
                                                    value={ingredient.unit}
                                                    onChange={(e) => handleIngredientChange(index, 'unit', e.target.value)}
                                                    style={{flex: 1}}
                                                >
                                                    <option value="ml">ml</option>
                                                    <option value="oz">oz</option>
                                                    <option value="dash">dash</option>
                                                    <option value="drops">drops</option>
                                                    <option value="pcs">pcs</option>
                                                </select>
                                                {formData.ingredients.length > 1 && (
                                                    <button
                                                        type="button"
                                                        className="icon-button delete"
                                                        onClick={() => removeIngredient(index)}
                                                    >
                                                        √ó
                                                    </button>
                                                )}
                                            </div>
                                        ))}
                                        <button type="button" className="button button-secondary" onClick={addIngredient}>
                                            + Add Ingredient
                                        </button>
                                    </div>
                                    
                                    <div className="form-group">
                                        <label className="form-label">Instructions</label>
                                        <textarea
                                            className="form-textarea"
                                            name="instructions"
                                            value={formData.instructions}
                                            onChange={handleInputChange}
                                            placeholder="Step-by-step preparation instructions"
                                        />
                                    </div>
                                    
                                    <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem'}}>
                                        <div className="form-group">
                                            <label className="form-label">Shelf Life</label>
                                            <input
                                                type="text"
                                                className="form-input"
                                                name="shelf_life"
                                                value={formData.shelf_life}
                                                onChange={handleInputChange}
                                                placeholder="e.g., 2 weeks refrigerated"
                                            />
                                        </div>
                                        
                                        <div className="form-group">
                                            <label className="form-label">Storage</label>
                                            <input
                                                type="text"
                                                className="form-input"
                                                name="storage"
                                                value={formData.storage}
                                                onChange={handleInputChange}
                                                placeholder="e.g., Refrigerate in airtight container"
                                            />
                                        </div>
                                    </div>
                                    
                                    <div className="buttons-row">
                                        <button type="submit" className="button">
                                            {isEditing ? 'Update' : 'Save'}
                                        </button>
                                        {isEditing && (
                                            <button type="button" className="button button-secondary" onClick={handleCancel}>
                                                Cancel
                                            </button>
                                        )}
                                    </div>
                                </form>
                            </div>
                            
                            <div className="settings-section">
                                <h3 className="settings-title">Existing Syrups & Infusions</h3>
                                {syrups.length === 0 ? (
                                    <p style={{color: '#888', textAlign: 'center', padding: '2rem'}}>
                                        No syrups or infusions added yet.
                                    </p>
                                ) : (
                                    <ul className="settings-list">
                                        {syrups.map((syrup, index) => (
                                            <li key={syrup.id} className="settings-item">
                                                <div style={{flex: 1}}>
                                                    <div style={{fontWeight: 'bold', marginBottom: '0.25rem'}}>
                                                        {syrup.name} 
                                                        <span style={{color: '#FFB366', fontSize: '0.8rem', marginLeft: '0.5rem'}}>
                                                            ({syrup.type})
                                                        </span>
                                                    </div>
                                                    {syrup.shelf_life && (
                                                        <div style={{color: '#888', fontSize: '0.8rem'}}>
                                                            Shelf life: {syrup.shelf_life}
                                                        </div>
                                                    )}
                                                </div>
                                                <div className="settings-actions">
                                                    <button 
                                                        className="icon-button"
                                                        onClick={() => handleShareSyrup(syrup)}
                                                        title="Share"
                                                    >
                                                        üì§
                                                    </button>
                                                    <button 
                                                        className="icon-button"
                                                        onClick={() => handleEdit(syrup)}
                                                    >
                                                        ‚úèÔ∏è
                                                    </button>
                                                    <button 
                                                        className="icon-button delete"
                                                        onClick={() => onDeleteSyrup(syrup.id)}
                                                    >
                                                        üóëÔ∏è
                                                    </button>
                                                </div>
                                            </li>
                                        ))}
                                    </ul>
                                )}
                            </div>
                        </>
                    )}
                </div>
            );
        }

        // Draggable Settings Item Component
        function DraggableSettingsItem({ item, index, onRemove, onDragStart, onDragOver, onDrop, isDragging }) {
            return (
                <li 
                    className={`settings-item ${isDragging ? 'dragging' : ''}`}
                    draggable
                    onDragStart={(e) => onDragStart(e, index)}
                    onDragOver={(e) => onDragOver(e, index)}
                    onDrop={(e) => onDrop(e, index)}
                >
                    <span className="drag-handle">‚ãÆ‚ãÆ</span>
                    <span style={{flex: 1}}>{item}</span>
                    <div className="settings-actions">
                        <button 
                            className="icon-button delete"
                            onClick={() => onRemove(index)}
                        >
                            √ó
                        </button>
                    </div>
                </li>
            );
        }

        // Settings Page Component with Drag & Drop
        function SettingsPage({ onBack, isAdmin, settings, onUpdateSettings }) {
            const [newItems, setNewItems] = useState({
                spirit_types: '',
                glass_types: '',
                venues: ''
            });
            
            const [dragIndex, setDragIndex] = useState(null);
            
            const handleKeyPress = (e, type) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    handleAddItem(type);
                }
            };
            
            const handleAddItem = (type) => {
                const value = newItems[type].trim();
                if (!value) {
                    alert('Please enter a value');
                    return;
                }
                
                const updatedSettings = {
                    ...settings,
                    [type]: [...settings[type], value]
                };
                
                onUpdateSettings(updatedSettings);
                setNewItems(prev => ({
                    ...prev,
                    [type]: ''
                }));
            };
            
            const handleRemoveItem = (type, index) => {
                const updatedSettings = {
                    ...settings,
                    [type]: settings[type].filter((_, i) => i !== index)
                };
                onUpdateSettings(updatedSettings);
            };
            
            const handleInputChange = (type, value) => {
                setNewItems(prev => ({
                    ...prev,
                    [type]: value
                }));
            };
            
            // Drag and Drop handlers
            const handleDragStart = (e, index) => {
                setDragIndex(index);
                e.dataTransfer.effectAllowed = 'move';
            };
            
            const handleDragOver = (e, index) => {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
            };
            
            const handleDrop = (e, dropIndex, type) => {
                e.preventDefault();
                if (dragIndex === null || dragIndex === dropIndex) return;
                
                const reorderedItems = reorder(settings[type], dragIndex, dropIndex);
                const updatedSettings = {
                    ...settings,
                    [type]: reorderedItems
                };
                
                onUpdateSettings(updatedSettings);
                setDragIndex(null);
            };
            
            return (
                <div className="container">
                    <button className="button button-secondary" onClick={onBack}>
                        ‚Üê Back to Cocktails
                    </button>
                    
                    <h1 className="page-title">Settings</h1>
                    
                    {!isAdmin ? (
                        <div className="settings-section">
                            <p>Admin access required to modify settings.</p>
                        </div>
                    ) : (
                        <>
                            <div className="settings-section">
                                <h3 className="settings-title">Spirit Types</h3>
                                <div style={{display: 'flex', gap: '0.5rem', marginBottom: '1rem'}}>
                                    <input
                                        type="text"
                                        className="form-input"
                                        placeholder="Add new spirit type"
                                        value={newItems.spirit_types}
                                        onChange={(e) => handleInputChange('spirit_types', e.target.value)}
                                        onKeyPress={(e) => handleKeyPress(e, 'spirit_types')}
                                        style={{flex: 1}}
                                    />
                                    <button 
                                        className="button" 
                                        onClick={() => handleAddItem('spirit_types')}
                                    >
                                        Add
                                    </button>
                                </div>
                                <ul className="settings-list">
                                    {settings.spirit_types.map((item, index) => (
                                        <DraggableSettingsItem
                                            key={index}
                                            item={item}
                                            index={index}
                                            onRemove={(idx) => handleRemoveItem('spirit_types', idx)}
                                            onDragStart={handleDragStart}
                                            onDragOver={handleDragOver}
                                            onDrop={(e, idx) => handleDrop(e, idx, 'spirit_types')}
                                            isDragging={dragIndex === index}
                                        />
                                    ))}
                                </ul>
                            </div>
                            
                            <div className="settings-section">
                                <h3 className="settings-title">Glass Types</h3>
                                <div style={{display: 'flex', gap: '0.5rem', marginBottom: '1rem'}}>
                                    <input
                                        type="text"
                                        className="form-input"
                                        placeholder="Add new glass type"
                                        value={newItems.glass_types}
                                        onChange={(e) => handleInputChange('glass_types', e.target.value)}
                                        onKeyPress={(e) => handleKeyPress(e, 'glass_types')}
                                        style={{flex: 1}}
                                    />
                                    <button 
                                        className="button" 
                                        onClick={() => handleAddItem('glass_types')}
                                    >
                                        Add
                                    </button>
                                </div>
                                <ul className="settings-list">
                                    {settings.glass_types.map((item, index) => (
                                        <DraggableSettingsItem
                                            key={index}
                                            item={item}
                                            index={index}
                                            onRemove={(idx) => handleRemoveItem('glass_types', idx)}
                                            onDragStart={handleDragStart}
                                            onDragOver={handleDragOver}
                                            onDrop={(e, idx) => handleDrop(e, idx, 'glass_types')}
                                            isDragging={dragIndex === index}
                                        />
                                    ))}
                                </ul>
                            </div>
                            
                            <div className="settings-section">
                                <h3 className="settings-title">Venues</h3>
                                <div style={{display: 'flex', gap: '0.5rem', marginBottom: '1rem'}}>
                                    <input
                                        type="text"
                                        className="form-input"
                                        placeholder="Add new venue"
                                        value={newItems.venues}
                                        onChange={(e) => handleInputChange('venues', e.target.value)}
                                        onKeyPress={(e) => handleKeyPress(e, 'venues')}
                                        style={{flex: 1}}
                                    />
                                    <button 
                                        className="button" 
                                        onClick={() => handleAddItem('venues')}
                                    >
                                        Add
                                    </button>
                                </div>
                                <ul className="settings-list">
                                    {settings.venues.map((item, index) => (
                                        <DraggableSettingsItem
                                            key={index}
                                            item={item}
                                            index={index}
                                            onRemove={(idx) => handleRemoveItem('venues', idx)}
                                            onDragStart={handleDragStart}
                                            onDragOver={handleDragOver}
                                            onDrop={(e, idx) => handleDrop(e, idx, 'venues')}
                                            isDragging={dragIndex === index}
                                        />
                                    ))}
                                </ul>
                            </div>
                        </>
                    )}
                </div>
            );
        }

        // Login Page Component
        function LoginPage({ onLogin, onGuestLogin }) {
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            
            const handleSubmit = (e) => {
                e.preventDefault();
                if (onLogin(username, password)) {
                    setError('');
                } else {
                    setError('Invalid credentials');
                }
            };
            
            return (
                <div className="container">
                    <div className="form" style={{maxWidth: '400px', marginTop: '4rem'}}>
                        <h1 className="page-title" style={{textAlign: 'center'}}>Cocktail Codex</h1>
                        
                        <form onSubmit={handleSubmit}>
                            <div className="form-group">
                                <label className="form-label">Username</label>
                                <input 
                                    type="text"
                                    className="form-input"
                                    value={username}
                                    onChange={(e) => setUsername(e.target.value)}
                                    required
                                />
                            </div>
                            
                            <div className="form-group">
                                <label className="form-label">Password</label>
                                <input 
                                    type="password"
                                    className="form-input"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    required
                                />
                            </div>
                            
                            {error && (
                                <div style={{color: '#ff6b6b', marginBottom: '1rem', textAlign: 'center'}}>
                                    {error}
                                </div>
                            )}
                            
                            <div className="buttons-row">
                                <button type="submit" className="button">
                                    Login
                                </button>
                                <button 
                                    type="button" 
                                    className="button button-secondary"
                                    onClick={onGuestLogin}
                                >
                                    Continue as Guest
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

        // Main App Component with Improved Sync
        function App() {
            const { user, firebaseUser, login, loginAsGuest, logout } = useAuth();
            const [currentPage, setCurrentPage] = useState('home');
            const [selectedRecipe, setSelectedRecipe] = useState(null);
            const [menuOpen, setMenuOpen] = useState(false);
            const [editingItem, setEditingItem] = useState(null);
            const [isEditing, setIsEditing] = useState(false);
            const [recipes, setRecipes] = useState(getRecipes());
            const [syrups, setSyrups] = useState(getSyrups());
            const [settings, setSettings] = useState(getSettings());
            const [syncStatus, setSyncStatus] = useState('offline');
            const [isManualSyncing, setIsManualSyncing] = useState(false);
            const [firebaseInitialized, setFirebaseInitialized] = useState(false);
            
            // Initialize Firebase and set up listeners
            useEffect(() => {
                const initializeFirebase = async () => {
                    try {
                        // Test Firebase connection
                        await db.collection('sharedData').doc('test').get();
                        setFirebaseInitialized(true);
                        setSyncStatus('synced');
                        console.log('Firebase connection successful');
                    } catch (error) {
                        console.error('Firebase connection failed:', error);
                        setFirebaseInitialized(false);
                        setSyncStatus('error');
                    }
                };

                initializeFirebase();
            }, []);

            // Set up Firebase real-time listeners when user logs in and Firebase is initialized
            useEffect(() => {
                if (firebaseUser && firebaseInitialized) {
                    console.log('Setting up Firebase listeners for auto sync');
                    
                    // Load initial data from Firebase
                    const loadInitialData = async () => {
                        try {
                            const [firebaseRecipes, firebaseSyrups, firebaseSettings] = await Promise.all([
                                loadRecipesFromFirebase(),
                                loadSyrupsFromFirebase(),
                                loadSettingsFromFirebase()
                            ]);
                            
                            if (firebaseRecipes !== null) {
                                setRecipes(firebaseRecipes);
                                saveRecipes(firebaseRecipes);
                            }
                            
                            if (firebaseSyrups !== null) {
                                setSyrups(firebaseSyrups);
                                saveSyrups(firebaseSyrups);
                            }
                            
                            if (firebaseSettings !== null) {
                                setSettings(firebaseSettings);
                                saveSettings(firebaseSettings);
                            }
                            
                            setSyncStatus('synced');
                        } catch (error) {
                            console.error('Error loading initial data:', error);
                            setSyncStatus('error');
                        }
                    };
                    
                    loadInitialData();
                    
                    // Set up real-time listeners for automatic sync
                    const cleanup = setupFirebaseListeners(
                        // Recipes update handler
                        (updatedRecipes) => {
                            console.log('Real-time update: Recipes updated from cloud', updatedRecipes.length, 'recipes');
                            setRecipes(updatedRecipes);
                            saveRecipes(updatedRecipes);
                            setSyncStatus('synced');
                        },
                        // Syrups update handler
                        (updatedSyrups) => {
                            console.log('Real-time update: Syrups updated from cloud', updatedSyrups.length, 'syrups');
                            setSyrups(updatedSyrups);
                            saveSyrups(updatedSyrups);
                        },
                        // Settings update handler
                        (updatedSettings) => {
                            console.log('Real-time update: Settings updated from cloud');
                            setSettings(updatedSettings);
                            saveSettings(updatedSettings);
                        }
                    );
                    
                    return cleanup;
                }
            }, [firebaseUser, firebaseInitialized]);
            
            // Manual sync function
            const handleManualSync = async () => {
                if (!user || !firebaseInitialized) {
                    alert('Sync not available. Please check your Firebase configuration.');
                    return;
                }
                
                setIsManualSyncing(true);
                setSyncStatus('syncing');
                
                try {
                    // Load fresh data from Firebase
                    const [firebaseRecipes, firebaseSyrups, firebaseSettings] = await Promise.all([
                        loadRecipesFromFirebase(),
                        loadSyrupsFromFirebase(),
                        loadSettingsFromFirebase()
                    ]);
                    
                    let hasChanges = false;
                    
                    // Update recipes if new data is available
                    if (firebaseRecipes !== null) {
                        setRecipes(firebaseRecipes);
                        saveRecipes(firebaseRecipes);
                        hasChanges = true;
                    }
                    
                    // Update syrups if new data is available
                    if (firebaseSyrups !== null) {
                        setSyrups(firebaseSyrups);
                        saveSyrups(firebaseSyrups);
                        hasChanges = true;
                    }
                    
                    // Update settings if new data is available
                    if (firebaseSettings !== null) {
                        setSettings(firebaseSettings);
                        saveSettings(firebaseSettings);
                        hasChanges = true;
                    }
                    
                    setSyncStatus('synced');
                    
                    if (hasChanges) {
                        alert('Data successfully synced from cloud!');
                    } else {
                        alert('Already up to date with cloud data.');
                    }
                    
                } catch (error) {
                    console.error('Manual sync error:', error);
                    setSyncStatus('error');
                    alert('Sync failed. Please check your connection and Firebase configuration.');
                } finally {
                    setIsManualSyncing(false);
                }
            };
            
            const navigateTo = (page, item = null) => {
                if ((page === 'create-recipe' || page === 'settings' || page === 'syrups') && (!user || !user.isAdmin)) {
                    return;
                }
                setCurrentPage(page);
                if (page === 'view-recipe') setSelectedRecipe(item);
                setMenuOpen(false);
            };
            
            // Auto-sync functions - only sync if Firebase is initialized and user is admin
            const autoSyncRecipes = async (updatedRecipes) => {
                if (user && user.isAdmin && firebaseInitialized) {
                    setSyncStatus('syncing');
                    const success = await syncRecipesWithFirebase(updatedRecipes);
                    if (success) {
                        setSyncStatus('synced');
                        console.log('Recipes auto-synced to cloud');
                    } else {
                        setSyncStatus('error');
                        console.error('Failed to auto-sync recipes');
                    }
                }
            };
            
            const autoSyncSyrups = async (updatedSyrups) => {
                if (user && user.isAdmin && firebaseInitialized) {
                    const success = await syncSyrupsWithFirebase(updatedSyrups);
                    if (!success) {
                        console.error('Failed to sync syrups to cloud');
                    }
                }
            };
            
            const autoSyncSettings = async (updatedSettings) => {
                if (user && user.isAdmin && firebaseInitialized) {
                    const success = await syncSettingsWithFirebase(updatedSettings);
                    if (!success) {
                        console.error('Failed to sync settings to cloud');
                    }
                }
            };
            
            const handleDeleteRecipe = (recipeId) => {
                if (!user || !user.isAdmin) return;
                
                if (confirm('Are you sure you want to delete this cocktail?')) {
                    const updatedRecipes = recipes.filter(recipe => recipe.id !== recipeId);
                    setRecipes(updatedRecipes);
                    saveRecipes(updatedRecipes);
                    autoSyncRecipes(updatedRecipes);
                    alert('Recipe deleted successfully');
                }
            };
            
            const handleSaveRecipe = (recipeData) => {
                let updatedRecipes;
                
                if (isEditing && editingItem) {
                    const index = recipes.findIndex(r => r.id === editingItem.id);
                    if (index !== -1) {
                        updatedRecipes = [...recipes];
                        updatedRecipes[index] = recipeData;
                    }
                } else {
                    updatedRecipes = [...recipes, recipeData];
                }
                
                if (updatedRecipes) {
                    setRecipes(updatedRecipes);
                    saveRecipes(updatedRecipes);
                    autoSyncRecipes(updatedRecipes);
                    setIsEditing(false);
                    setEditingItem(null);
                    navigateTo('home');
                    alert(`Recipe ${isEditing ? 'updated' : 'added'} successfully${firebaseInitialized ? ' and synced to cloud' : ''}`);
                }
            };
            
            const handleEditRecipe = (recipe) => {
                setEditingItem(recipe);
                setIsEditing(true);
                setCurrentPage('create-recipe');
            };
            
            const handleSaveSyrup = (syrupData) => {
                let updatedSyrups;
                
                if (isEditing && editingItem) {
                    const index = syrups.findIndex(s => s.id === editingItem.id);
                    if (index !== -1) {
                        updatedSyrups = [...syrups];
                        updatedSyrups[index] = syrupData;
                    }
                } else {
                    updatedSyrups = [...syrups, syrupData];
                }
                
                if (updatedSyrups) {
                    setSyrups(updatedSyrups);
                    saveSyrups(updatedSyrups);
                    autoSyncSyrups(updatedSyrups);
                    alert(`Syrup ${isEditing ? 'updated' : 'added'} successfully${firebaseInitialized ? ' and synced to cloud' : ''}`);
                }
            };
            
            const handleDeleteSyrup = (syrupId) => {
                if (!user || !user.isAdmin) return;
                
                if (confirm('Are you sure you want to delete this syrup/infusion?')) {
                    const updatedSyrups = syrups.filter(syrup => syrup.id !== syrupId);
                    setSyrups(updatedSyrups);
                    saveSyrups(updatedSyrups);
                    autoSyncSyrups(updatedSyrups);
                    alert('Syrup deleted successfully');
                }
            };
            
            const handleUpdateSettings = (updatedSettings) => {
                setSettings(updatedSettings);
                saveSettings(updatedSettings);
                autoSyncSettings(updatedSettings);
            };
            
            const renderPage = () => {
                if (!user) {
                    return <LoginPage onLogin={login} onGuestLogin={loginAsGuest} />;
                }
                
                switch(currentPage) {
                    case 'home':
                        return <HomePage 
                            onRecipeClick={(recipe) => navigateTo('view-recipe', recipe)}
                            onDeleteRecipe={handleDeleteRecipe}
                            isAdmin={user.isAdmin}
                            onCreateRecipe={() => {
                                setIsEditing(false);
                                setEditingItem(null);
                                navigateTo('create-recipe');
                            }}
                            recipes={recipes}
                            syncStatus={syncStatus}
                            onManualSync={handleManualSync}
                        />;
                    case 'view-recipe':
                        return <ViewRecipePage 
                            recipe={selectedRecipe} 
                            onBack={() => navigateTo('home')}
                            isAdmin={user.isAdmin}
                            onDeleteRecipe={handleDeleteRecipe}
                            onEditRecipe={handleEditRecipe}
                        />;
                    case 'create-recipe':
                        return <CreateEditRecipePage 
                            recipe={editingItem}
                            onBack={() => navigateTo('home')} 
                            onSave={handleSaveRecipe}
                            isEdit={isEditing}
                        />;
                    case 'syrups':
                        return <SyrupsPage 
                            onBack={() => navigateTo('home')} 
                            isAdmin={user.isAdmin}
                            syrups={syrups}
                            onSaveSyrup={handleSaveSyrup}
                            onDeleteSyrup={handleDeleteSyrup}
                        />;
                    case 'settings':
                        return <SettingsPage 
                            onBack={() => navigateTo('home')} 
                            isAdmin={user.isAdmin}
                            settings={settings}
                            onUpdateSettings={handleUpdateSettings}
                        />;
                    default:
                        return <HomePage 
                            onRecipeClick={(recipe) => navigateTo('view-recipe', recipe)}
                            onDeleteRecipe={handleDeleteRecipe}
                            isAdmin={user.isAdmin}
                            onCreateRecipe={() => navigateTo('create-recipe')}
                            recipes={recipes}
                            syncStatus={syncStatus}
                            onManualSync={handleManualSync}
                        />;
                }
            };
            
            if (!user) {
                return <LoginPage onLogin={login} onGuestLogin={loginAsGuest} />;
            }
            
            return (
                <div className="app">
                    <header className="header">
                        <div className="header-left">
                            <button 
                                className={`menu-button ${menuOpen ? 'active' : ''}`}
                                onClick={() => setMenuOpen(!menuOpen)}
                                aria-label="Toggle menu"
                            >
                                <span className="menu-line"></span>
                                <span className="menu-line"></span>
                                <span className="menu-line"></span>
                            </button>
                        </div>
                        
                        <div className="nav-user">
                            üë§ {user.username}
                            {user.isAdmin && <span style={{color: '#FFB366', fontSize: '0.7rem'}}> (Admin)</span>}
                            {!user.isAdmin && <span style={{color: '#666', fontSize: '0.7rem'}}> (Guest)</span>}
                            <button 
                                className={`sync-btn ${isManualSyncing ? 'syncing' : ''}`}
                                onClick={handleManualSync}
                                disabled={isManualSyncing || !firebaseInitialized}
                                title={firebaseInitialized ? "Refresh and sync data" : "Firebase not configured"}
                            >
                                üîÑ {isManualSyncing ? 'Syncing...' : 'Sync'}
                            </button>
                            <button className="logout-btn" onClick={logout}>
                                Logout
                            </button>
                        </div>
                    </header>
                    
                    <HamburgerMenu 
                        isOpen={menuOpen}
                        onToggle={setMenuOpen}
                        currentPage={currentPage}
                        onNavigate={navigateTo}
                        isAdmin={user.isAdmin}
                    />
                    
                    <main>
                        {renderPage()}
                    </main>

                    <footer className="footer">
                        <p>
                             ¬© {new Date().getFullYear()} | {' '}
                            <a href="https://www.instagram.com/suraj.gg87/" target="_blank" rel="noopener noreferrer">
                                @suraj.gg87
                            </a>
                            {!firebaseInitialized && (
                                <span style={{color: '#ff6b6b', display: 'block', marginTop: '0.5rem'}}>
                                    ‚ö†Ô∏è Firebase not configured - Sync disabled
                                </span>
                            )}
                        </p>
                    </footer>
                </div>
            );
        }

        // Render the app
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
