<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cocktail Codex</title>
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üç∏</text></svg>">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üç∏</text></svg>">
    
    <!-- iOS Specific Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Cocktail Codex">
    <meta name="format-detection" content="telephone=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0A0A0A">
    
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #0A0A0A;
            color: white;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -webkit-text-size-adjust: 100%;
            font-size: 14px;
        }
        
        .app {
            min-height: 100vh;
            background: #0A0A0A;
            position: relative;
        }
        
        /* Header */
        .header {
            background: #1A1A1A;
            padding: 1rem;
            border-bottom: 1px solid #333;
            position: sticky;
            top: 0;
            z-index: 100;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .menu-button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 0.5rem;
            display: flex;
            flex-direction: column;
            gap: 4px;
            width: 30px;
            height: 30px;
            justify-content: center;
            align-items: center;
        }
        
        .menu-line {
            width: 20px;
            height: 2px;
            background: white;
            transition: all 0.3s ease;
        }
        
        .menu-button.active .menu-line:nth-child(1) {
            transform: rotate(45deg) translate(6px, 6px);
        }
        
        .menu-button.active .menu-line:nth-child(2) {
            opacity: 0;
        }
        
        .menu-button.active .menu-line:nth-child(3) {
            transform: rotate(-45deg) translate(6px, -6px);
        }
        
        .nav-user {
            color: #FFB366;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .logout-btn {
            background: transparent;
            border: 1px solid #FFB366;
            color: #FFB366;
            padding: 0.4rem 0.8rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            white-space: nowrap;
        }
        
        /* Side Menu */
        .side-menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .side-menu-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .side-menu {
            position: fixed;
            top: 0;
            left: -300px;
            width: 280px;
            height: 100vh;
            background: #1A1A1A;
            border-right: 1px solid #333;
            z-index: 1000;
            transition: left 0.3s ease;
            overflow-y: auto;
            padding: 2rem 1rem;
        }
        
        .side-menu.active {
            left: 0;
        }
        
        .side-menu-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #333;
        }
        
        .side-menu-logo {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #FFB366, #FF8C42);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        .side-menu-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #FFB366;
        }
        
        .side-menu-nav {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .side-menu-button {
            background: #333;
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 8px;
            cursor: pointer;
            text-align: left;
            font-size: 1rem;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .side-menu-button:hover {
            background: #444;
            transform: translateX(5px);
        }
        
        .side-menu-button.active {
            background: #FFB366;
            color: #0A0A0A;
        }
        
        /* Main Content */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
            position: relative;
        }
        
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .page-title {
            font-size: 1.5rem;
            color: #FFB366;
        }
        
        /* Search and Filters */
        .search-section {
            background: #1A1A1A;
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1.5rem;
            border: 1px solid #333;
        }
        
        .search-box {
            width: 100%;
            padding: 0.75rem;
            background: #333;
            border: 1px solid #555;
            border-radius: 6px;
            color: white;
            margin-bottom: 1rem;
            font-size: 16px;
        }
        
        .filters {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }
        
        .filter-select {
            padding: 0.75rem;
            background: #333;
            border: 1px solid #555;
            border-radius: 6px;
            color: white;
            flex: 1;
            min-width: 140px;
            font-size: 16px;
        }
        
        /* Recipe Grid */
        .recipes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }
        
        .recipe-card {
            background: #1A1A1A;
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid #333;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .recipe-card:hover {
            transform: translateY(-2px);
            border-color: #FFB366;
        }
        
        .recipe-image {
            width: 100%;
            height: 160px;
            background: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            background-size: cover;
            background-position: center;
        }
        
        .recipe-info {
            padding: 0.75rem;
        }
        
        .recipe-name {
            font-weight: bold;
            margin-bottom: 0.25rem;
            font-size: 0.9rem;
        }
        
        .recipe-spirit {
            color: #FFB366;
            font-size: 0.8rem;
        }
        
        /* Storage Status */
        .storage-status {
            font-size: 0.8rem;
            margin-bottom: 1rem;
            padding: 0.75rem;
            border-radius: 6px;
            text-align: center;
            background: rgba(76, 175, 80, 0.1);
            color: #4CAF50;
            border: 1px solid #4CAF50;
        }
        
        .storage-upgrade {
            background: rgba(255, 179, 102, 0.1);
            border: 1px solid #FFB366;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }
        
        /* Form Styles */
        .form {
            background: #1A1A1A;
            padding: 1.5rem;
            border-radius: 10px;
            border: 1px solid #333;
            max-width: 100%;
            margin: 0 auto;
        }
        
        .form-group {
            margin-bottom: 1.25rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: #FFB366;
        }
        
        .form-input {
            width: 100%;
            padding: 0.75rem;
            background: #333;
            border: 1px solid #555;
            border-radius: 6px;
            color: white;
            font-size: 16px;
        }
        
        .form-textarea {
            width: 100%;
            padding: 0.75rem;
            background: #333;
            border: 1px solid #555;
            border-radius: 6px;
            color: white;
            min-height: 100px;
            resize: vertical;
            font-size: 16px;
        }
        
        .button {
            background: #FFB366;
            color: #0A0A0A;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
        }
        
        .button:hover {
            background: #FF8C42;
        }
        
        .button-secondary {
            background: #333;
            color: white;
        }
        
        .button-secondary:hover {
            background: #444;
        }
        
        .buttons-row {
            display: flex;
            gap: 0.75rem;
            margin-top: 1.5rem;
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 2rem;
            color: #666;
        }
        
        /* Role Badges */
        .role-badge {
            display: inline-flex;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: bold;
            margin-left: 0.5rem;
        }
        
        .role-badge.admin {
            background: #FFB366;
            color: #0A0A0A;
        }
        
        .role-badge.user {
            background: #666;
            color: white;
        }

        /* Settings */
        .settings-section {
            background: #1A1A1A;
            padding: 1.5rem;
            border-radius: 10px;
            border: 1px solid #333;
            margin-bottom: 1.5rem;
        }
        
        .settings-title {
            font-size: 1.3rem;
            color: #FFB366;
            margin-bottom: 1rem;
        }
        
        .settings-list {
            list-style: none;
            min-height: 60px;
        }
        
        .settings-item {
            padding: 1rem;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move;
            background: #1A1A1A;
            transition: background 0.2s;
            user-select: none;
        }
        
        .settings-item:hover {
            background: #222;
        }
        
        .settings-item.dragging {
            opacity: 0.5;
            background: #333;
        }
        
        .settings-item:last-child {
            border-bottom: none;
        }
        
        .settings-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .icon-button {
            background: #333;
            color: white;
            border: none;
            padding: 0.5rem;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            font-size: 1rem;
        }
        
        .icon-button:hover {
            background: #444;
        }
        
        .icon-button.delete {
            background: #f44336;
        }
        
        .icon-button.delete:hover {
            background: #d32f2f;
        }

        /* Image Upload */
        .image-upload {
            border: 2px dashed #555;
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.2s;
        }
        
        .image-upload:hover {
            border-color: #FFB366;
        }
        
        .image-upload.dragover {
            border-color: #FFB366;
            background: rgba(255, 179, 102, 0.1);
        }
        
        .image-preview {
            max-width: 100%;
            max-height: 250px;
            border-radius: 8px;
            margin-top: 1rem;
        }

        /* Scale Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
        }
        
        .modal {
            background: #1A1A1A;
            border-radius: 10px;
            padding: 1.5rem;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid #333;
        }
        
        .scale-option {
            margin-bottom: 1.5rem;
            padding: 1rem;
            border: 1px solid #333;
            border-radius: 8px;
            background: #1A1A1A;
        }
        
        .scale-option-title {
            font-size: 1.1rem;
            color: #FFB366;
            margin-bottom: 0.5rem;
        }
        
        .scale-option-description {
            color: #888;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
        
        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }
        
        .dilution-options {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .dilution-option {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }
        
        .dilution-label {
            display: flex;
            flex-direction: column;
        }
        
        .dilution-percentage {
            font-weight: bold;
            color: #FFB366;
        }
        
        .dilution-description {
            font-size: 0.8rem;
            color: #888;
        }
        
        .servings-info {
            background: #333;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            text-align: center;
        }
        
        .servings-count {
            font-size: 1.2rem;
            color: #FFB366;
            font-weight: bold;
        }

        /* Recipe View */
        .recipe-view {
            background: #1A1A1A;
            border-radius: 10px;
            padding: 1.5rem;
            border: 1px solid #333;
            position: relative;
            overflow: hidden;
        }
        
        .recipe-background {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-size: cover;
            background-position: center;
            opacity: 0.1;
            z-index: 0;
        }
        
        .recipe-content {
            position: relative;
            z-index: 1;
        }
        
        .recipe-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .recipe-title {
            font-size: 1.5rem;
            color: #FFB366;
            margin-bottom: 0.5rem;
        }
        
        .recipe-meta {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }
        
        .meta-item {
            background: #333;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        .recipe-image-large {
            width: 100%;
            max-width: 300px;
            height: 300px;
            background: #333;
            border-radius: 10px;
            margin-bottom: 1.5rem;
            background-size: cover;
            background-position: center;
        }
        
        .recipe-details {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }
        
        @media (min-width: 768px) {
            .recipe-details {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        .ingredients-list {
            list-style: none;
        }
        
        .ingredient-item {
            padding: 0.75rem;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
        }
        
        .ingredient-item:last-child {
            border-bottom: none;
        }
        
        .instructions {
            white-space: pre-line;
            line-height: 1.6;
        }
        
        .action-buttons {
            display: flex;
            gap: 0.75rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }
        
        .action-button {
            background: #333;
            color: white;
            border: none;
            padding: 0.75rem;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            transition: background 0.2s;
        }
        
        .action-button:hover {
            background: #444;
        }
        
        .action-button.scale {
            background: #FFB366;
            color: #0A0A0A;
        }
        
        .action-button.scale:hover {
            background: #FF8C42;
        }
        
        .action-button.edit {
            background: #4CAF50;
        }
        
        .action-button.edit:hover {
            background: #45a049;
        }
        
        .action-button.delete {
            background: #f44336;
        }
        
        .action-button.delete:hover {
            background: #d32f2f;
        }

        /* Alphabetical Quick Search */
        .alphabet-scroll {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 0.25rem;
            margin-bottom: 1rem;
            padding: 0.75rem;
            background: #1A1A1A;
            border-radius: 8px;
            border: 1px solid #333;
        }
        
        .alphabet-letter {
            padding: 0.5rem 0.75rem;
            background: #333;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            text-align: center;
            flex: 1;
            min-width: 30px;
        }
        
        .alphabet-letter:hover {
            background: #444;
        }
        
        .alphabet-letter.active {
            background: #FFB366;
            color: #0A0A0A;
        }
        
        /* Mobile Optimizations */
        .mobile-actions {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            z-index: 90;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .mobile-fab {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: #FFB366;
            color: #0A0A0A;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transition: all 0.2s ease;
        }
        
        .mobile-fab:hover {
            transform: scale(1.1);
            background: #FF8C42;
        }
        
        .mobile-fab.secondary {
            background: #333;
            color: white;
        }
        
        .mobile-fab.secondary:hover {
            background: #444;
        }
        
        /* Section Headers */
        .section-header {
            font-size: 1.1rem;
            color: #FFB366;
            margin: 1.5rem 0 1rem 0;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #333;
        }

        @media (max-width: 768px) {
            .recipes-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .filters {
                flex-direction: column;
            }
            
            .buttons-row {
                flex-direction: column;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .alphabet-scroll {
                gap: 0.15rem;
                padding: 0.5rem;
            }
            
            .alphabet-letter {
                padding: 0.4rem 0.5rem;
                font-size: 0.8rem;
                min-width: 24px;
            }
            
            .container {
                padding: 0.75rem;
            }
            
            .header {
                padding: 0.75rem;
            }
            
            .search-section {
                padding: 0.75rem;
            }
            
            .form {
                padding: 1rem;
            }
        }

        @media (max-width: 480px) {
            .recipes-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.5rem;
            }
            
            .recipe-image {
                height: 120px;
            }
            
            .recipe-info {
                padding: 0.5rem;
            }
            
            .recipe-name {
                font-size: 0.8rem;
            }
            
            .recipe-spirit {
                font-size: 0.7rem;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // Authentication configuration
        const ADMIN_CREDENTIALS = {
            username: 'suraj',
            password: 'cocktail123'
        };

        // Enhanced Storage Manager with IndexedDB
        const StorageManager = {
            db: null,
            dbName: 'CocktailCodexDB',
            version: 1,
            
            async init() {
                return new Promise((resolve, reject) => {
                    if (this.db) {
                        resolve(this.db);
                        return;
                    }

                    const request = indexedDB.open(this.dbName, this.version);
                    
                    request.onerror = () => reject(request.error);
                    request.onsuccess = () => {
                        this.db = request.result;
                        resolve(this.db);
                    };
                    
                    request.onupgradeneeded = (event) => {
                        const db = event.target.result;
                        
                        if (!db.objectStoreNames.contains('recipes')) {
                            db.createObjectStore('recipes', { keyPath: 'id' });
                        }
                        
                        if (!db.objectStoreNames.contains('syrups')) {
                            db.createObjectStore('syrups', { keyPath: 'id' });
                        }
                        
                        if (!db.objectStoreNames.contains('settings')) {
                            db.createObjectStore('settings', { keyPath: 'id' });
                        }
                    };
                });
            },

            getAvailableStorage() {
                return {
                    estimated: 500,
                    type: 'IndexedDB'
                };
            },

            async getStorageUsage() {
                try {
                    const recipes = await this.getAll('recipes');
                    const syrups = await this.getAll('syrups');
                    const settings = await this.getAll('settings');
                    
                    const allData = { recipes, syrups, settings };
                    const sizeInMB = (JSON.stringify(allData).length) / 1024 / 1024;
                    return Math.round(sizeInMB * 100) / 100;
                } catch (error) {
                    return 0;
                }
            },

            async getAll(storeName) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction([storeName], 'readonly');
                    const store = transaction.objectStore(storeName);
                    const request = store.getAll();
                    
                    request.onsuccess = () => resolve(request.result || []);
                    request.onerror = () => reject(request.error);
                });
            },

            async get(storeName, id) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction([storeName], 'readonly');
                    const store = transaction.objectStore(storeName);
                    const request = store.get(id);
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            },

            async put(storeName, data) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction([storeName], 'readwrite');
                    const store = transaction.objectStore(storeName);
                    const request = store.put(data);
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            },

            async delete(storeName, id) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction([storeName], 'readwrite');
                    const store = transaction.objectStore(storeName);
                    const request = store.delete(id);
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            },

            async clear(storeName) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction([storeName], 'readwrite');
                    const store = transaction.objectStore(storeName);
                    const request = store.clear();
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            },

            // Image compression
            compressImage(base64String, maxWidth = 400, quality = 0.8) {
                return new Promise((resolve) => {
                    const img = new Image();
                    img.onload = function() {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        
                        let width = img.width;
                        let height = img.height;
                        
                        if (width > maxWidth) {
                            height = (height * maxWidth) / width;
                            width = maxWidth;
                        }
                        
                        canvas.width = width;
                        canvas.height = height;
                        
                        ctx.drawImage(img, 0, 0, width, height);
                        const compressedBase64 = canvas.toDataURL('image/jpeg', quality);
                        resolve(compressedBase64);
                    };
                    img.src = base64String;
                });
            }
        };

        // Data Manager
        const DataManager = {
            initialized: false,
            
            async init() {
                if (!this.initialized) {
                    await StorageManager.init();
                    this.initialized = true;
                }
            },

            async getAllData() {
                await this.init();
                const [recipes, syrups, settings] = await Promise.all([
                    StorageManager.getAll('recipes'),
                    StorageManager.getAll('syrups'),
                    StorageManager.getAll('settings')
                ]);
                
                const defaultSettings = {
                    id: 'app_settings',
                    spirit_types: ['Vodka', 'Gin', 'Rum', 'Tequila', 'Whiskey', 'Brandy'],
                    glass_types: ['Martini', 'Highball', 'Old Fashioned', 'Collins', 'Coupe', 'Margarita'],
                    venues: ['Bar', 'Restaurant', 'Event', 'Home'],
                    syrup_types: ['Simple Syrup', 'Honey Syrup', 'Grenadine', 'Orgeat', 'Demerara Syrup']
                };
                
                const appSettings = settings.find(s => s.id === 'app_settings') || defaultSettings;
                
                return {
                    recipes: recipes || [],
                    syrups: syrups || [],
                    settings: appSettings
                };
            },

            async saveRecipe(recipe) {
                await this.init();
                return await StorageManager.put('recipes', recipe);
            },

            async saveSyrup(syrup) {
                await this.init();
                return await StorageManager.put('syrups', syrup);
            },

            async saveSettings(settings) {
                await this.init();
                const settingsWithId = { ...settings, id: 'app_settings' };
                return await StorageManager.put('settings', settingsWithId);
            },

            async deleteRecipe(id) {
                await this.init();
                return await StorageManager.delete('recipes', id);
            },

            async deleteSyrup(id) {
                await this.init();
                return await StorageManager.delete('syrups', id);
            },

            async clearAllData() {
                await this.init();
                await Promise.all([
                    StorageManager.clear('recipes'),
                    StorageManager.clear('syrups'),
                    StorageManager.clear('settings')
                ]);
            }
        };

        // Authentication Hook
        function useAuth() {
            const [user, setUser] = useState(null);
            
            useEffect(() => {
                const savedUser = localStorage.getItem('cocktailAppUser');
                if (savedUser) {
                    setUser(JSON.parse(savedUser));
                }
            }, []);
            
            const login = (username, password) => {
                if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
                    const userData = { username, isAdmin: true };
                    setUser(userData);
                    localStorage.setItem('cocktailAppUser', JSON.stringify(userData));
                    return true;
                }
                return false;
            };
            
            const loginAsGuest = () => {
                const guestUser = { username: 'Guest', isAdmin: false };
                setUser(guestUser);
                localStorage.setItem('cocktailAppUser', JSON.stringify(guestUser));
                return true;
            };
            
            const logout = () => {
                setUser(null);
                localStorage.removeItem('cocktailAppUser');
            };
            
            return { user, login, loginAsGuest, logout };
        }

        // Storage Status Component
        function StorageStatus({ data, isAdmin }) {
            const [storageInfo, setStorageInfo] = useState({ usage: 0, limit: '500+ MB' });
            
            useEffect(() => {
                const loadStorageInfo = async () => {
                    const usage = await StorageManager.getStorageUsage();
                    setStorageInfo({ usage, limit: '500+ MB' });
                };
                loadStorageInfo();
            }, [data]);
            
            return (
                <div>
                    <div className="storage-upgrade">
                        <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem', marginBottom: '0.5rem'}}>
                            <span>üöÄ</span>
                            <strong>Enhanced Storage Active</strong>
                        </div>
                        <div style={{fontSize: '0.8rem', color: '#666'}}>
                            Using IndexedDB - Up to 500MB+ capacity
                        </div>
                    </div>
                    
                    <div className="storage-status">
                        <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '0.5rem'}}>
                            <span>üíæ IndexedDB</span>
                            {isAdmin && <span className="role-badge admin">ADMIN</span>}
                        </div>
                        <div style={{fontSize: '0.7rem'}}>
                            {data.recipes.length} cocktails ‚Ä¢ {data.syrups.length} syrups ‚Ä¢ 
                            {storageInfo.usage}MB / {storageInfo.limit} used
                        </div>
                    </div>
                </div>
            );
        }

        // Alphabetical Quick Search Component
        function AlphabetScroll({ onLetterClick, activeLetter }) {
            const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
            
            return (
                <div className="alphabet-scroll">
                    {alphabet.map(letter => (
                        <div
                            key={letter}
                            className={`alphabet-letter ${activeLetter === letter ? 'active' : ''}`}
                            onClick={() => onLetterClick(letter)}
                        >
                            {letter}
                        </div>
                    ))}
                </div>
            );
        }

        // Draggable Settings List Component
        function DraggableSettingsList({ items, onReorder, onRemove, placeholder, isAdmin }) {
            const [draggedItem, setDraggedItem] = useState(null);
            
            const handleDragStart = (e, index) => {
                if (!isAdmin) return;
                setDraggedItem(index);
                e.dataTransfer.effectAllowed = 'move';
            };
            
            const handleDragOver = (e) => {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
            };
            
            const handleDrop = (e, index) => {
                e.preventDefault();
                if (!isAdmin) return;
                if (draggedItem !== null && draggedItem !== index) {
                    const newItems = [...items];
                    const [removed] = newItems.splice(draggedItem, 1);
                    newItems.splice(index, 0, removed);
                    onReorder(newItems);
                }
                setDraggedItem(null);
            };
            
            if (items.length === 0) {
                return <div style={{padding: '2rem', textAlign: 'center', color: '#666'}}>{placeholder}</div>;
            }
            
            return (
                <ul className="settings-list">
                    {items.map((item, index) => (
                        <li 
                            key={index} 
                            className={`settings-item ${draggedItem === index ? 'dragging' : ''}`} 
                            draggable={isAdmin}
                            onDragStart={(e) => handleDragStart(e, index)} 
                            onDragOver={handleDragOver} 
                            onDrop={(e) => handleDrop(e, index)}
                        >
                            <span>{item}</span>
                            {isAdmin && (
                                <div className="settings-actions">
                                    <button className="icon-button delete" onClick={() => onRemove(index)}>√ó</button>
                                </div>
                            )}
                        </li>
                    ))}
                </ul>
            );
        }

        // Settings Page Component
        function SettingsPage({ onBack, isAdmin, data, onUpdateSettings }) {
            const [settings, setSettings] = useState(data.settings);
            const [newItems, setNewItems] = useState({ 
                spirit_types: '', 
                glass_types: '', 
                venues: '',
                syrup_types: ''
            });
            
            useEffect(() => {
                onUpdateSettings(settings);
            }, [settings, onUpdateSettings]);
            
            const handleAddItem = (type) => {
                if (!isAdmin) return;
                const value = newItems[type].trim();
                if (!value) {
                    alert('Please enter a value');
                    return;
                }
                setSettings(prev => ({ ...prev, [type]: [...prev[type], value] }));
                setNewItems(prev => ({ ...prev, [type]: '' }));
            };
            
            const handleKeyPress = (e, type) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    handleAddItem(type);
                }
            };
            
            const handleRemoveItem = (type, index) => {
                if (!isAdmin) return;
                setSettings(prev => ({ ...prev, [type]: prev[type].filter((_, i) => i !== index) }));
            };
            
            const handleReorderItems = (type, newItems) => {
                if (!isAdmin) return;
                setSettings(prev => ({ ...prev, [type]: newItems }));
            };
            
            const handleInputChange = (type, value) => {
                setNewItems(prev => ({ ...prev, [type]: value }));
            };
            
            return (
                <div className="container">
                    <button className="button button-secondary" onClick={onBack}>‚Üê Back to Cocktails</button>
                    <h1 className="page-title">
                        Settings
                        {isAdmin ? (
                            <span className="role-badge admin">ADMIN</span>
                        ) : (
                            <span className="role-badge user">VIEWER</span>
                        )}
                    </h1>
                    
                    {!isAdmin ? (
                        <div className="settings-section">
                            <h3 className="settings-title">View Only Mode</h3>
                            <p style={{color: '#666', lineHeight: '1.6'}}>
                                You are currently in <strong>Viewer Mode</strong>. To modify settings, 
                                please log in as an administrator.
                            </p>
                        </div>
                    ) : (
                        <>
                            <div className="settings-section">
                                <h3 className="settings-title">Spirit Types</h3>
                                <div style={{display: 'flex', gap: '0.5rem', marginBottom: '1rem'}}>
                                    <input 
                                        type="text" 
                                        className="form-input" 
                                        placeholder="Add new spirit type" 
                                        value={newItems.spirit_types} 
                                        onChange={(e) => handleInputChange('spirit_types', e.target.value)} 
                                        onKeyPress={(e) => handleKeyPress(e, 'spirit_types')} 
                                        style={{flex: 1}} 
                                    />
                                    <button className="button" onClick={() => handleAddItem('spirit_types')}>Add</button>
                                </div>
                                <DraggableSettingsList 
                                    items={settings.spirit_types} 
                                    onReorder={(newItems) => handleReorderItems('spirit_types', newItems)} 
                                    onRemove={(index) => handleRemoveItem('spirit_types', index)} 
                                    placeholder="No spirit types added yet" 
                                    isAdmin={isAdmin} 
                                />
                            </div>
                            
                            <div className="settings-section">
                                <h3 className="settings-title">Venues</h3>
                                <div style={{display: 'flex', gap: '0.5rem', marginBottom: '1rem'}}>
                                    <input 
                                        type="text" 
                                        className="form-input" 
                                        placeholder="Add new venue" 
                                        value={newItems.venues} 
                                        onChange={(e) => handleInputChange('venues', e.target.value)} 
                                        onKeyPress={(e) => handleKeyPress(e, 'venues')} 
                                        style={{flex: 1}} 
                                    />
                                    <button className="button" onClick={() => handleAddItem('venues')}>Add</button>
                                </div>
                                <DraggableSettingsList 
                                    items={settings.venues} 
                                    onReorder={(newItems) => handleReorderItems('venues', newItems)} 
                                    onRemove={(index) => handleRemoveItem('venues', index)} 
                                    placeholder="No venues added yet" 
                                    isAdmin={isAdmin} 
                                />
                            </div>

                            <div className="settings-section">
                                <h3 className="settings-title">Syrup Types</h3>
                                <div style={{display: 'flex', gap: '0.5rem', marginBottom: '1rem'}}>
                                    <input 
                                        type="text" 
                                        className="form-input" 
                                        placeholder="Add new syrup type" 
                                        value={newItems.syrup_types} 
                                        onChange={(e) => handleInputChange('syrup_types', e.target.value)} 
                                        onKeyPress={(e) => handleKeyPress(e, 'syrup_types')} 
                                        style={{flex: 1}} 
                                    />
                                    <button className="button" onClick={() => handleAddItem('syrup_types')}>Add</button>
                                </div>
                                <DraggableSettingsList 
                                    items={settings.syrup_types} 
                                    onReorder={(newItems) => handleReorderItems('syrup_types', newItems)} 
                                    onRemove={(index) => handleRemoveItem('syrup_types', index)} 
                                    placeholder="No syrup types added yet" 
                                    isAdmin={isAdmin} 
                                />
                            </div>
                        </>
                    )}
                </div>
            );
        }

        // Hamburger Menu Component
        function HamburgerMenu({ isOpen, onToggle, currentPage, onNavigate, isAdmin }) {
            const menuRef = useRef(null);
            
            useEffect(() => {
                const handleClickOutside = (event) => {
                    if (menuRef.current && !menuRef.current.contains(event.target) && 
                        !event.target.closest('.menu-button')) {
                        onToggle(false);
                    }
                };
                
                if (isOpen) {
                    document.addEventListener('mousedown', handleClickOutside);
                }
                
                return () => {
                    document.removeEventListener('mousedown', handleClickOutside);
                };
            }, [isOpen, onToggle]);
            
            const handleNavigation = (page) => {
                onNavigate(page);
                onToggle(false);
            };
            
            return (
                <>
                    <div className={`side-menu-overlay ${isOpen ? 'active' : ''}`} />
                    <div ref={menuRef} className={`side-menu ${isOpen ? 'active' : ''}`}>
                        <div className="side-menu-header">
                            <div className="side-menu-logo">üç∏</div>
                            <div className="side-menu-title">Cocktail Codex</div>
                        </div>
                        
                        <nav className="side-menu-nav">
                            <button 
                                className={`side-menu-button ${currentPage === 'home' ? 'active' : ''}`}
                                onClick={() => handleNavigation('home')}
                            >
                                üìñ Cocktail Codex
                            </button>
                            
                            {isAdmin && (
                                <>
                                    <button 
                                        className={`side-menu-button ${currentPage === 'create' ? 'active' : ''}`}
                                        onClick={() => handleNavigation('create')}
                                    >
                                        ‚ûï Add Recipe
                                    </button>
                                    <button 
                                        className={`side-menu-button ${currentPage === 'syrups' ? 'active' : ''}`}
                                        onClick={() => handleNavigation('syrups')}
                                    >
                                        üçØ Syrups
                                    </button>
                                    <button 
                                        className={`side-menu-button ${currentPage === 'settings' ? 'active' : ''}`}
                                        onClick={() => handleNavigation('settings')}
                                    >
                                        ‚öôÔ∏è Settings
                                    </button>
                                </>
                            )}
                        </nav>
                    </div>
                </>
            );
        }

        // Recipe Card Component
        function RecipeCard({ recipe, onClick }) {
            const imageStyle = {
                backgroundImage: recipe.image_url ? `url(${recipe.image_url})` : 'none'
            };
            
            return (
                <div className="recipe-card" onClick={() => onClick(recipe)}>
                    <div className="recipe-image" style={imageStyle}>
                        {!recipe.image_url && 'No Image'}
                    </div>
                    <div className="recipe-info">
                        <div className="recipe-name">{recipe.name}</div>
                        <div className="recipe-spirit">{recipe.spirit_type}</div>
                        {recipe.abv && <div style={{fontSize: '0.7rem', color: '#888'}}>{recipe.abv}% ABV</div>}
                        {recipe.cost && <div style={{fontSize: '0.7rem', color: '#888'}}>${recipe.cost}</div>}
                    </div>
                </div>
            );
        }

        // Syrup Card Component
        function SyrupCard({ syrup, onClick }) {
            const imageStyle = {
                backgroundImage: syrup.image_url ? `url(${syrup.image_url})` : 'none'
            };
            
            return (
                <div className="recipe-card" onClick={() => onClick(syrup)}>
                    <div className="recipe-image" style={imageStyle}>
                        {!syrup.image_url && 'No Image'}
                    </div>
                    <div className="recipe-info">
                        <div className="recipe-name">{syrup.name}</div>
                        <div className="recipe-spirit">{syrup.type}</div>
                        {syrup.cost && <div style={{fontSize: '0.7rem', color: '#888'}}>${syrup.cost}</div>}
                    </div>
                </div>
            );
        }

        // Scale Modal Component
        function ScaleModal({ recipe, onClose }) {
            const [scaleMethod, setScaleMethod] = useState('servings');
            const [quantity, setQuantity] = useState(1);
            const [volumeUnit, setVolumeUnit] = useState('ml');
            const [dilution, setDilution] = useState('0');
            const [customDilution, setCustomDilution] = useState('');
            
            const calculateOriginalVolume = () => {
                return recipe.ingredients.reduce((total, ingredient) => {
                    if (ingredient.unit === 'ml') return total + parseFloat(ingredient.amount);
                    if (ingredient.unit === 'oz') return total + (parseFloat(ingredient.amount) * 29.5735);
                    return total;
                }, 0);
            };
            
            const convertToMl = (amount, unit) => {
                switch(unit) {
                    case 'oz': return amount * 29.5735;
                    case 'l': return amount * 1000;
                    case 'gal': return amount * 3785.41;
                    default: return amount;
                }
            };
            
            const calculateScaledIngredients = () => {
                const originalVolume = calculateOriginalVolume();
                let scaleFactor, servings = 1;
                
                if (scaleMethod === 'servings') {
                    scaleFactor = quantity;
                    servings = quantity;
                } else {
                    const targetVolume = convertToMl(quantity, volumeUnit);
                    scaleFactor = targetVolume / originalVolume;
                    servings = Math.round((targetVolume / originalVolume) * 10) / 10;
                }
                
                const dilutionPercentage = dilution === 'custom' ? parseFloat(customDilution) : parseFloat(dilution);
                const totalScaledVolume = originalVolume * scaleFactor;
                const dilutionWater = (totalScaledVolume * dilutionPercentage) / 100;
                
                const scaledIngredients = recipe.ingredients.map(ingredient => ({
                    ...ingredient,
                    scaledAmount: Math.round(ingredient.amount * scaleFactor * 10) / 10
                }));
                
                if (dilutionWater > 0) {
                    scaledIngredients.push({
                        name: 'Water (for dilution)',
                        scaledAmount: Math.round(dilutionWater * 10) / 10,
                        unit: 'ml'
                    });
                }
                
                return { ingredients: scaledIngredients, servings, totalVolume: totalScaledVolume + dilutionWater };
            };
            
            const scaledResult = calculateScaledIngredients();
            
            return (
                <div className="modal-overlay">
                    <div className="modal">
                        <h2 style={{color: '#FFB366', marginBottom: '1rem'}}>Scale: {recipe.name}</h2>
                        
                        <div className="scale-option">
                            <h3 className="scale-option-title">Scale by Number of Servings</h3>
                            <p className="scale-option-description">Choose this option if you know how many servings you need.</p>
                            <div className="radio-group">
                                <label className="radio-option">
                                    <input 
                                        type="radio" 
                                        name="scaleMethod" 
                                        value="servings" 
                                        checked={scaleMethod === 'servings'} 
                                        onChange={(e) => setScaleMethod(e.target.value)} 
                                    />
                                    Scale by Servings
                                </label>
                                {scaleMethod === 'servings' && (
                                    <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
                                        <label>Enter Quantity:</label>
                                        <input 
                                            type="number" 
                                            min="1" 
                                            value={quantity} 
                                            onChange={(e) => setQuantity(parseInt(e.target.value))} 
                                            className="form-input" 
                                            style={{width: '100px'}} 
                                        />
                                        <span>servings</span>
                                    </div>
                                )}
                            </div>
                        </div>
                        
                        <div className="scale-option">
                            <h3 className="scale-option-title">Scale by Total Volume</h3>
                            <p className="scale-option-description">Ideal for filling a specific container or batch size.</p>
                            <div className="radio-group">
                                <label className="radio-option">
                                    <input 
                                        type="radio" 
                                        name="scaleMethod" 
                                        value="volume" 
                                        checked={scaleMethod === 'volume'} 
                                        onChange={(e) => setScaleMethod(e.target.value)} 
                                    />
                                    Scale by Volume
                                </label>
                                {scaleMethod === 'volume' && (
                                    <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem', flexWrap: 'wrap'}}>
                                        <label>Enter Quantity:</label>
                                        <input 
                                            type="number" 
                                            min="1" 
                                            step="0.1" 
                                            value={quantity} 
                                            onChange={(e) => setQuantity(parseFloat(e.target.value))} 
                                            className="form-input" 
                                            style={{width: '100px'}} 
                                        />
                                        <select 
                                            value={volumeUnit} 
                                            onChange={(e) => setVolumeUnit(e.target.value)} 
                                            className="form-input" 
                                            style={{width: '120px'}}
                                        >
                                            <option value="ml">Milliliters</option>
                                            <option value="oz">Ounces</option>
                                            <option value="l">Liters</option>
                                            <option value="gal">Gallons</option>
                                        </select>
                                    </div>
                                )}
                            </div>
                        </div>
                        
                        <div className="scale-option">
                            <h3 className="scale-option-title">Add Dilution (Optional)</h3>
                            <p className="scale-option-description">Choose a dilution percentage that suits your cocktail.</p>
                            <div className="dilution-options">
                                {['0', '18', '25', 'custom'].map(value => (
                                    <label key={value} className="dilution-option">
                                        <input 
                                            type="radio" 
                                            name="dilution" 
                                            value={value} 
                                            checked={dilution === value} 
                                            onChange={(e) => setDilution(e.target.value)} 
                                        />
                                        <div className="dilution-label">
                                            <span className="dilution-percentage">
                                                {value === '0' ? '0% (No Dilution)' : value === 'custom' ? 'Custom:' : `${value}%`}
                                            </span>
                                            <span className="dilution-description">
                                                {value === '0' ? 'Best if you plan to shake or stir your drinks to order.' :
                                                 value === '18' ? 'Best for strong drinks containing mainly spirits.' :
                                                 value === '25' ? 'Ideal for cocktails containing fruit juices, dairy, or eggs.' :
                                                 'Enter custom dilution percentage'}
                                            </span>
                                        </div>
                                    </label>
                                ))}
                                {dilution === 'custom' && (
                                    <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem', marginTop: '0.25rem'}}>
                                        <input 
                                            type="number" 
                                            min="0" 
                                            max="100" 
                                            value={customDilution} 
                                            onChange={(e) => setCustomDilution(e.target.value)} 
                                            className="form-input" 
                                            style={{width: '80px'}} 
                                            placeholder="0" 
                                        />
                                        <span>%</span>
                                    </div>
                                )}
                            </div>
                        </div>
                        
                        {scaleMethod === 'volume' && (
                            <div className="servings-info">
                                <div>This batch will make approximately</div>
                                <div className="servings-count">{scaledResult.servings} servings</div>
                            </div>
                        )}
                        
                        <h3 style={{color: '#FFB366', marginBottom: '1rem'}}>Scaled Ingredients</h3>
                        <ul className="ingredients-list">
                            {scaledResult.ingredients.map((ingredient, index) => (
                                <li key={index} className="ingredient-item">
                                    <span>{ingredient.name}</span>
                                    <span>{ingredient.scaledAmount} {ingredient.unit}</span>
                                </li>
                            ))}
                        </ul>
                        
                        <div className="buttons-row">
                            <button className="button" onClick={onClose}>Close</button>
                        </div>
                    </div>
                </div>
            );
        }

        // View Recipe Component
        function ViewRecipePage({ recipe, onBack, onScale, isAdmin, onDeleteRecipe, onEditRecipe }) {
            const backgroundStyle = {
                backgroundImage: recipe.image_url ? `url(${recipe.image_url})` : 'none'
            };
            
            const handleShare = async () => {
                const recipeText = `
üç∏ ${recipe.name}

${recipe.spirit_type} ‚Ä¢ ${recipe.glass_type} Glass
${recipe.abv}% ABV ‚Ä¢ $${recipe.cost} Cost ‚Ä¢ ${recipe.venue}

INGREDIENTS:
${recipe.ingredients.map(ing => `‚Ä¢ ${ing.amount} ${ing.unit} ${ing.name}`).join('\n')}

INSTRUCTIONS:
${recipe.instructions}

${recipe.notes ? `NOTES:\n${recipe.notes}` : ''}
                `.trim();

                if (navigator.share) {
                    try {
                        await navigator.share({
                            title: recipe.name,
                            text: recipeText
                        });
                    } catch (error) {
                        console.log('Share cancelled');
                    }
                } else {
                    navigator.clipboard.writeText(recipeText);
                    alert('Recipe copied to clipboard!');
                }
            };
            
            const handleDownloadImage = () => {
                if (recipe.image_url) {
                    const link = document.createElement('a');
                    link.href = recipe.image_url;
                    link.download = `${recipe.name.replace(/\s+/g, '_')}.jpg`;
                    link.click();
                } else {
                    alert('No image available for download');
                }
            };
            
            return (
                <div className="container">
                    <button className="button button-secondary" onClick={onBack}>
                        ‚Üê Back to Cocktails
                    </button>
                    
                    <div className="recipe-view">
                        {recipe.image_url && (
                            <div className="recipe-background" style={backgroundStyle}></div>
                        )}
                        
                        <div className="recipe-content">
                            <div className="recipe-header">
                                <div>
                                    <h1 className="recipe-title">{recipe.name}</h1>
                                    <div className="recipe-meta">
                                        <div className="meta-item">{recipe.spirit_type}</div>
                                        <div className="meta-item">{recipe.glass_type} Glass</div>
                                        <div className="meta-item">{recipe.abv}% ABV</div>
                                        <div className="meta-item">${recipe.cost} Cost</div>
                                        <div className="meta-item">{recipe.venue}</div>
                                    </div>
                                </div>
                            </div>
                            
                            {recipe.image_url && (
                                <div className="recipe-image-large" style={{backgroundImage: `url(${recipe.image_url})`}}></div>
                            )}
                            
                            <div className="recipe-details">
                                <div>
                                    <h3 style={{color: '#FFB366', marginBottom: '1rem'}}>Ingredients</h3>
                                    <ul className="ingredients-list">
                                        {recipe.ingredients.map((ingredient, index) => (
                                            <li key={index} className="ingredient-item">
                                                <span>{ingredient.name}</span>
                                                <span>{ingredient.amount} {ingredient.unit}</span>
                                            </li>
                                        ))}
                                    </ul>
                                </div>
                                
                                <div>
                                    <h3 style={{color: '#FFB366', marginBottom: '1rem'}}>Instructions</h3>
                                    <div className="instructions">{recipe.instructions}</div>
                                    
                                    {recipe.notes && (
                                        <>
                                            <h3 style={{color: '#FFB366', marginBottom: '1rem', marginTop: '1.5rem'}}>Notes</h3>
                                            <div className="instructions">{recipe.notes}</div>
                                        </>
                                    )}
                                    
                                    <div className="action-buttons">
                                        <button className="action-button scale" onClick={onScale}>
                                            ‚öñÔ∏è Scale Recipe
                                        </button>
                                        <button className="action-button" onClick={handleShare}>
                                            üì§ Share
                                        </button>
                                        {recipe.image_url && (
                                            <button className="action-button" onClick={handleDownloadImage}>
                                                üì∑ Download Image
                                            </button>
                                        )}
                                        {isAdmin && (
                                            <>
                                                <button 
                                                    className="action-button edit"
                                                    onClick={() => onEditRecipe(recipe)}
                                                >
                                                    ‚úèÔ∏è Edit
                                                </button>
                                                <button 
                                                    className="action-button delete"
                                                    onClick={() => onDeleteRecipe(recipe.id)}
                                                >
                                                    üóëÔ∏è Delete
                                                </button>
                                            </>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // View Syrup Component
        function ViewSyrupPage({ syrup, onBack, isAdmin, onDeleteSyrup, onEditSyrup }) {
            const backgroundStyle = {
                backgroundImage: syrup.image_url ? `url(${syrup.image_url})` : 'none'
            };
            
            const handleShare = async () => {
                const syrupText = `
üçØ ${syrup.name}

${syrup.type}
$${syrup.cost} Cost ‚Ä¢ ${syrup.venue}

INGREDIENTS:
${syrup.ingredients.map(ing => `‚Ä¢ ${ing.amount} ${ing.unit} ${ing.name}`).join('\n')}

INSTRUCTIONS:
${syrup.instructions}

${syrup.notes ? `NOTES:\n${syrup.notes}` : ''}
                `.trim();

                if (navigator.share) {
                    try {
                        await navigator.share({
                            title: syrup.name,
                            text: syrupText
                        });
                    } catch (error) {
                        console.log('Share cancelled');
                    }
                } else {
                    navigator.clipboard.writeText(syrupText);
                    alert('Syrup recipe copied to clipboard!');
                }
            };
            
            const handleDownloadImage = () => {
                if (syrup.image_url) {
                    const link = document.createElement('a');
                    link.href = syrup.image_url;
                    link.download = `${syrup.name.replace(/\s+/g, '_')}.jpg`;
                    link.click();
                } else {
                    alert('No image available for download');
                }
            };
            
            return (
                <div className="container">
                    <button className="button button-secondary" onClick={onBack}>
                        ‚Üê Back to Syrups
                    </button>
                    
                    <div className="recipe-view">
                        {syrup.image_url && (
                            <div className="recipe-background" style={backgroundStyle}></div>
                        )}
                        
                        <div className="recipe-content">
                            <div className="recipe-header">
                                <div>
                                    <h1 className="recipe-title">{syrup.name}</h1>
                                    <div className="recipe-meta">
                                        <div className="meta-item">{syrup.type}</div>
                                        <div className="meta-item">${syrup.cost} Cost</div>
                                        <div className="meta-item">{syrup.venue}</div>
                                    </div>
                                </div>
                            </div>
                            
                            {syrup.image_url && (
                                <div className="recipe-image-large" style={{backgroundImage: `url(${syrup.image_url})`}}></div>
                            )}
                            
                            <div className="recipe-details">
                                <div>
                                    <h3 style={{color: '#FFB366', marginBottom: '1rem'}}>Ingredients</h3>
                                    <ul className="ingredients-list">
                                        {syrup.ingredients.map((ingredient, index) => (
                                            <li key={index} className="ingredient-item">
                                                <span>{ingredient.name}</span>
                                                <span>{ingredient.amount} {ingredient.unit}</span>
                                            </li>
                                        ))}
                                    </ul>
                                </div>
                                
                                <div>
                                    <h3 style={{color: '#FFB366', marginBottom: '1rem'}}>Instructions</h3>
                                    <div className="instructions">{syrup.instructions}</div>
                                    
                                    {syrup.notes && (
                                        <>
                                            <h3 style={{color: '#FFB366', marginBottom: '1rem', marginTop: '1.5rem'}}>Notes</h3>
                                            <div className="instructions">{syrup.notes}</div>
                                        </>
                                    )}
                                    
                                    <div className="action-buttons">
                                        <button className="action-button" onClick={handleShare}>
                                            üì§ Share
                                        </button>
                                        {syrup.image_url && (
                                            <button className="action-button" onClick={handleDownloadImage}>
                                                üì∑ Download Image
                                            </button>
                                        )}
                                        {isAdmin && (
                                            <>
                                                <button 
                                                    className="action-button edit"
                                                    onClick={() => onEditSyrup(syrup)}
                                                >
                                                    ‚úèÔ∏è Edit
                                                </button>
                                                <button 
                                                    className="action-button delete"
                                                    onClick={() => onDeleteSyrup(syrup.id)}
                                                >
                                                    üóëÔ∏è Delete
                                                </button>
                                            </>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Home Page Component
        function HomePage({ recipes, onRecipeClick, isAdmin, onCreateRecipe, settings }) {
            const [searchTerm, setSearchTerm] = useState('');
            const [filterSpirit, setFilterSpirit] = useState('All');
            const [filterVenue, setFilterVenue] = useState('All');
            const [activeLetter, setActiveLetter] = useState('');
            
            // Sort recipes alphabetically
            const sortedRecipes = [...recipes].sort((a, b) => a.name.localeCompare(b.name));
            
            const filteredRecipes = sortedRecipes.filter(recipe => {
                const matchesSearch = recipe.name.toLowerCase().includes(searchTerm.toLowerCase());
                const matchesSpirit = filterSpirit === 'All' || recipe.spirit_type === filterSpirit;
                const matchesVenue = filterVenue === 'All' || recipe.venue === filterVenue;
                const matchesLetter = !activeLetter || recipe.name.toUpperCase().startsWith(activeLetter);
                return matchesSearch && matchesSpirit && matchesVenue && matchesLetter;
            });
            
            const handleLetterClick = (letter) => {
                setActiveLetter(activeLetter === letter ? '' : letter);
                setSearchTerm(''); // Clear search when using alphabetical navigation
            };
            
            return (
                <div className="container">
                    <div className="page-header">
                        <h1 className="page-title">
                            Cocktail Codex
                            {isAdmin ? (
                                <span className="role-badge admin">ADMIN</span>
                            ) : (
                                <span className="role-badge user">VIEWER</span>
                            )}
                        </h1>
                        {isAdmin && (
                            <button className="button" onClick={onCreateRecipe}>
                                + Add Recipe
                            </button>
                        )}
                    </div>
                    
                    <StorageStatus data={{ recipes, syrups: [], settings }} isAdmin={isAdmin} />
                    
                    <div className="search-section">
                        <input 
                            type="text"
                            className="search-box"
                            placeholder="Search cocktails..."
                            value={searchTerm}
                            onChange={(e) => setSearchTerm(e.target.value)}
                        />
                        
                        <AlphabetScroll 
                            onLetterClick={handleLetterClick}
                            activeLetter={activeLetter}
                        />
                        
                        <div className="filters">
                            <select 
                                className="filter-select"
                                value={filterSpirit}
                                onChange={(e) => setFilterSpirit(e.target.value)}
                            >
                                <option value="All">All Spirits</option>
                                {settings.spirit_types.map(spirit => (
                                    <option key={spirit} value={spirit}>{spirit}</option>
                                ))}
                            </select>
                            
                            <select 
                                className="filter-select"
                                value={filterVenue}
                                onChange={(e) => setFilterVenue(e.target.value)}
                            >
                                <option value="All">All Venues</option>
                                {settings.venues.map(venue => (
                                    <option key={venue} value={venue}>{venue}</option>
                                ))}
                            </select>
                        </div>
                    </div>
                    
                    {filteredRecipes.length === 0 ? (
                        <div className="loading">
                            {recipes.length === 0 ? (
                                <div>
                                    <p>No cocktails found.</p>
                                    {isAdmin && (
                                        <p style={{marginTop: '1rem', color: '#FFB366'}}>
                                            Click "Add Recipe" to create your first cocktail!
                                        </p>
                                    )}
                                </div>
                            ) : (
                                'No cocktails found matching your criteria.'
                            )}
                        </div>
                    ) : (
                        <div className="recipes-grid">
                            {filteredRecipes.map(recipe => (
                                <RecipeCard 
                                    key={recipe.id} 
                                    recipe={recipe} 
                                    onClick={onRecipeClick}
                                />
                            ))}
                        </div>
                    )}
                </div>
            );
        }

        // Syrups Page Component
        function SyrupsPage({ syrups, onSyrupClick, isAdmin, onCreateSyrup, settings }) {
            const [searchTerm, setSearchTerm] = useState('');
            const [filterType, setFilterType] = useState('All');
            const [filterVenue, setFilterVenue] = useState('All');
            const [activeLetter, setActiveLetter] = useState('');
            
            // Sort syrups alphabetically
            const sortedSyrups = [...syrups].sort((a, b) => a.name.localeCompare(b.name));
            
            const filteredSyrups = sortedSyrups.filter(syrup => {
                const matchesSearch = syrup.name.toLowerCase().includes(searchTerm.toLowerCase());
                const matchesType = filterType === 'All' || syrup.type === filterType;
                const matchesVenue = filterVenue === 'All' || syrup.venue === filterVenue;
                const matchesLetter = !activeLetter || syrup.name.toUpperCase().startsWith(activeLetter);
                return matchesSearch && matchesType && matchesVenue && matchesLetter;
            });
            
            const handleLetterClick = (letter) => {
                setActiveLetter(activeLetter === letter ? '' : letter);
                setSearchTerm(''); // Clear search when using alphabetical navigation
            };
            
            return (
                <div className="container">
                    <div className="page-header">
                        <h1 className="page-title">
                            Syrups
                            {isAdmin ? (
                                <span className="role-badge admin">ADMIN</span>
                            ) : (
                                <span className="role-badge user">VIEWER</span>
                            )}
                        </h1>
                        {isAdmin && (
                            <button className="button" onClick={onCreateSyrup}>
                                + Add Syrup
                            </button>
                        )}
                    </div>
                    
                    <div className="search-section">
                        <input 
                            type="text"
                            className="search-box"
                            placeholder="Search syrups..."
                            value={searchTerm}
                            onChange={(e) => setSearchTerm(e.target.value)}
                        />
                        
                        <AlphabetScroll 
                            onLetterClick={handleLetterClick}
                            activeLetter={activeLetter}
                        />
                        
                        <div className="filters">
                            <select 
                                className="filter-select"
                                value={filterType}
                                onChange={(e) => setFilterType(e.target.value)}
                            >
                                <option value="All">All Types</option>
                                {settings.syrup_types.map(type => (
                                    <option key={type} value={type}>{type}</option>
                                ))}
                            </select>
                            
                            <select 
                                className="filter-select"
                                value={filterVenue}
                                onChange={(e) => setFilterVenue(e.target.value)}
                            >
                                <option value="All">All Venues</option>
                                {settings.venues.map(venue => (
                                    <option key={venue} value={venue}>{venue}</option>
                                ))}
                            </select>
                        </div>
                    </div>
                    
                    {filteredSyrups.length === 0 ? (
                        <div className="loading">
                            {syrups.length === 0 ? (
                                <div>
                                    <p>No syrups found.</p>
                                    {isAdmin && (
                                        <p style={{marginTop: '1rem', color: '#FFB366'}}>
                                            Click "Add Syrup" to create your first syrup!
                                        </p>
                                    )}
                                </div>
                            ) : (
                                'No syrups found matching your criteria.'
                            )}
                        </div>
                    ) : (
                        <div className="recipes-grid">
                            {filteredSyrups.map(syrup => (
                                <SyrupCard 
                                    key={syrup.id} 
                                    syrup={syrup} 
                                    onClick={onSyrupClick}
                                />
                            ))}
                        </div>
                    )}
                </div>
            );
        }

        // Create Recipe Component with Image Drag & Drop
        function CreateRecipePage({ onBack, onSave, isAdmin, settings, editingRecipe, isSyrup = false }) {
            const [formData, setFormData] = useState({
                name: '', spirit_type: '', venue: '', glass_type: '', abv: '', cost: '', 
                image_url: '', ingredients: [{ name: '', amount: '', unit: 'ml' }], instructions: '', notes: ''
            });
            
            const [imagePreview, setImagePreview] = useState('');
            const [isDragging, setIsDragging] = useState(false);
            
            useEffect(() => {
                if (editingRecipe) {
                    setFormData(editingRecipe);
                    setImagePreview(editingRecipe.image_url || '');
                }
            }, [editingRecipe]);
            
            const handleInputChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({ ...prev, [name]: value }));
            };
            
            const handleIngredientChange = (index, field, value) => {
                const updatedIngredients = [...formData.ingredients];
                updatedIngredients[index][field] = value;
                setFormData(prev => ({ ...prev, ingredients: updatedIngredients }));
            };
            
            const addIngredient = () => {
                setFormData(prev => ({
                    ...prev,
                    ingredients: [...prev.ingredients, { name: '', amount: '', unit: 'ml' }]
                }));
            };
            
            const removeIngredient = (index) => {
                if (formData.ingredients.length > 1) {
                    const updatedIngredients = [...formData.ingredients];
                    updatedIngredients.splice(index, 1);
                    setFormData(prev => ({ ...prev, ingredients: updatedIngredients }));
                }
            };
            
            const handleImageUpload = async (file) => {
                if (!file.type.startsWith('image/')) {
                    alert('Please select an image file');
                    return;
                }
                
                try {
                    const reader = new FileReader();
                    reader.onload = async (e) => {
                        let base64 = e.target.result;
                        // Compress image if needed
                        if (file.size > 500000) { // 500KB
                            base64 = await StorageManager.compressImage(base64);
                        }
                        setFormData(prev => ({ ...prev, image_url: base64 }));
                        setImagePreview(base64);
                    };
                    reader.readAsDataURL(file);
                } catch (error) {
                    alert('Error uploading image. Please try again.');
                }
            };
            
            const handleFileInput = (e) => {
                const file = e.target.files[0];
                if (file) handleImageUpload(file);
            };
            
            const handleDragOver = (e) => {
                e.preventDefault();
                setIsDragging(true);
            };
            
            const handleDragLeave = (e) => {
                e.preventDefault();
                setIsDragging(false);
            };
            
            const handleDrop = (e) => {
                e.preventDefault();
                setIsDragging(false);
                const file = e.dataTransfer.files[0];
                if (file) handleImageUpload(file);
            };
            
            const handleSubmit = (e) => {
                e.preventDefault();
                if (!formData.name) {
                    alert('Please enter a name');
                    return;
                }
                const itemData = {
                    ...formData,
                    id: editingRecipe ? editingRecipe.id : Date.now().toString(),
                    abv: parseFloat(formData.abv) || 0,
                    cost: parseFloat(formData.cost) || 0
                };
                onSave(itemData);
            };
            
            if (!isAdmin) {
                return (
                    <div className="container">
                        <button className="button button-secondary" onClick={onBack}>‚Üê Back</button>
                        <div className="loading">
                            <h2>Admin Access Required</h2>
                            <p>Only administrators can create {isSyrup ? 'syrups' : 'recipes'}.</p>
                        </div>
                    </div>
                );
            }
            
            return (
                <div className="container">
                    <button className="button button-secondary" onClick={onBack}>
                        ‚Üê Back to {isSyrup ? 'Syrups' : 'Cocktails'}
                    </button>
                    <h1 className="page-title">
                        {editingRecipe ? `Edit ${isSyrup ? 'Syrup' : 'Cocktail'}` : `Add New ${isSyrup ? 'Syrup' : 'Cocktail'}`}
                    </h1>
                    
                    <form className="form" onSubmit={handleSubmit}>
                        <div className="form-group">
                            <label className="form-label">{isSyrup ? 'Syrup' : 'Cocktail'} Name *</label>
                            <input 
                                type="text" 
                                className="form-input" 
                                name="name" 
                                value={formData.name} 
                                onChange={handleInputChange} 
                                required 
                            />
                        </div>
                        
                        <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem'}}>
                            {!isSyrup ? (
                                <div className="form-group">
                                    <label className="form-label">Spirit Type</label>
                                    <select 
                                        className="form-input" 
                                        name="spirit_type" 
                                        value={formData.spirit_type} 
                                        onChange={handleInputChange}
                                    >
                                        <option value="">Select Spirit</option>
                                        {settings.spirit_types.map(spirit => (
                                            <option key={spirit} value={spirit}>{spirit}</option>
                                        ))}
                                    </select>
                                </div>
                            ) : (
                                <div className="form-group">
                                    <label className="form-label">Syrup Type</label>
                                    <select 
                                        className="form-input" 
                                        name="type" 
                                        value={formData.type} 
                                        onChange={handleInputChange}
                                    >
                                        <option value="">Select Type</option>
                                        {settings.syrup_types.map(type => (
                                            <option key={type} value={type}>{type}</option>
                                        ))}
                                    </select>
                                </div>
                            )}
                            
                            <div className="form-group">
                                <label className="form-label">Venue</label>
                                <select 
                                    className="form-input" 
                                    name="venue" 
                                    value={formData.venue} 
                                    onChange={handleInputChange}
                                >
                                    <option value="">Select Venue</option>
                                    {settings.venues.map(venue => (
                                        <option key={venue} value={venue}>{venue}</option>
                                    ))}
                                </select>
                            </div>
                        </div>
                        
                        {!isSyrup && (
                            <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem'}}>
                                <div className="form-group">
                                    <label className="form-label">ABV (%)</label>
                                    <input 
                                        type="number" 
                                        step="0.1" 
                                        className="form-input" 
                                        name="abv" 
                                        value={formData.abv} 
                                        onChange={handleInputChange} 
                                    />
                                </div>
                                
                                <div className="form-group">
                                    <label className="form-label">Cost ($)</label>
                                    <input 
                                        type="number" 
                                        step="0.01" 
                                        className="form-input" 
                                        name="cost" 
                                        value={formData.cost} 
                                        onChange={handleInputChange} 
                                    />
                                </div>
                            </div>
                        )}
                        
                        {isSyrup && (
                            <div className="form-group">
                                <label className="form-label">Cost ($)</label>
                                <input 
                                    type="number" 
                                    step="0.01" 
                                    className="form-input" 
                                    name="cost" 
                                    value={formData.cost} 
                                    onChange={handleInputChange} 
                                />
                            </div>
                        )}
                        
                        <div className="form-group">
                            <label className="form-label">{isSyrup ? 'Syrup' : 'Cocktail'} Image</label>
                            <div 
                                className={`image-upload ${isDragging ? 'dragover' : ''}`}
                                onDragOver={handleDragOver}
                                onDragLeave={handleDragLeave}
                                onDrop={handleDrop}
                            >
                                <input 
                                    type="file" 
                                    accept="image/*" 
                                    onChange={handleFileInput} 
                                    style={{display: 'none'}} 
                                    id="image-upload" 
                                />
                                <label htmlFor="image-upload" style={{cursor: 'pointer'}}>
                                    {imagePreview ? 'Change Image' : 'Click to upload or drag & drop'}
                                </label>
                                {imagePreview && <img src={imagePreview} alt="Preview" className="image-preview" />}
                            </div>
                        </div>
                        
                        <div className="form-group">
                            <label className="form-label">Ingredients</label>
                            {formData.ingredients.map((ingredient, index) => (
                                <div key={index} style={{display: 'flex', gap: '0.5rem', marginBottom: '0.5rem', alignItems: 'center'}}>
                                    <input 
                                        type="text" 
                                        className="form-input" 
                                        placeholder="Ingredient name" 
                                        value={ingredient.name} 
                                        onChange={(e) => handleIngredientChange(index, 'name', e.target.value)} 
                                        style={{flex: 2}} 
                                    />
                                    <input 
                                        type="number" 
                                        step="0.1" 
                                        className="form-input" 
                                        placeholder="Amount" 
                                        value={ingredient.amount} 
                                        onChange={(e) => handleIngredientChange(index, 'amount', e.target.value)} 
                                        style={{flex: 1}} 
                                    />
                                    <select 
                                        className="form-input" 
                                        value={ingredient.unit} 
                                        onChange={(e) => handleIngredientChange(index, 'unit', e.target.value)} 
                                        style={{flex: 1}} 
                                    >
                                        <option value="ml">ml</option>
                                        <option value="oz">oz</option>
                                        <option value="dash">dash</option>
                                        <option value="piece">piece</option>
                                        <option value="slice">slice</option>
                                        <option value="cup">cup</option>
                                        <option value="tsp">tsp</option>
                                        <option value="tbsp">tbsp</option>
                                    </select>
                                    {formData.ingredients.length > 1 && (
                                        <button 
                                            type="button" 
                                            className="icon-button delete" 
                                            onClick={() => removeIngredient(index)}
                                        >
                                            √ó
                                        </button>
                                    )}
                                </div>
                            ))}
                            <button type="button" className="button button-secondary" onClick={addIngredient}>
                                + Add Ingredient
                            </button>
                        </div>
                        
                        <div className="form-group">
                            <label className="form-label">Instructions</label>
                            <textarea 
                                className="form-textarea" 
                                name="instructions" 
                                value={formData.instructions} 
                                onChange={handleInputChange} 
                            />
                        </div>
                        
                        <div className="form-group">
                            <label className="form-label">Notes</label>
                            <textarea 
                                className="form-textarea" 
                                name="notes" 
                                value={formData.notes} 
                                onChange={handleInputChange} 
                            />
                        </div>
                        
                        <div className="buttons-row">
                            <button type="submit" className="button">
                                {editingRecipe ? `Update ${isSyrup ? 'Syrup' : 'Cocktail'}` : `Save ${isSyrup ? 'Syrup' : 'Cocktail'}`}
                            </button>
                            <button type="button" className="button button-secondary" onClick={onBack}>Cancel</button>
                        </div>
                    </form>
                </div>
            );
        }

        // Login Page Component
        function LoginPage({ onLogin, onGuestLogin }) {
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            
            const handleSubmit = (e) => {
                e.preventDefault();
                if (onLogin(username, password)) {
                    setError('');
                } else {
                    setError('Invalid credentials');
                }
            };
            
            return (
                <div className="container">
                    <div className="form" style={{maxWidth: '400px', marginTop: '4rem'}}>
                        <h1 className="page-title" style={{textAlign: 'center'}}>Cocktail Codex</h1>
                        <p style={{textAlign: 'center', color: '#666', marginBottom: '2rem'}}>
                            Login as admin to manage recipes, or continue as guest to view.
                        </p>
                        <form onSubmit={handleSubmit}>
                            <div className="form-group">
                                <label className="form-label">Username</label>
                                <input 
                                    type="text" 
                                    className="form-input" 
                                    value={username} 
                                    onChange={(e) => setUsername(e.target.value)} 
                                    required 
                                />
                            </div>
                            <div className="form-group">
                                <label className="form-label">Password</label>
                                <input 
                                    type="password" 
                                    className="form-input" 
                                    value={password} 
                                    onChange={(e) => setPassword(e.target.value)} 
                                    required 
                                />
                            </div>
                            {error && <div style={{color: '#ff6b6b', marginBottom: '1rem', textAlign: 'center'}}>{error}</div>}
                            <div className="buttons-row">
                                <button type="submit" className="button">Login as Admin</button>
                                <button type="button" className="button button-secondary" onClick={onGuestLogin}>
                                    Continue as Guest
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

        // Mobile Floating Action Button Component
        function MobileFAB({ isAdmin, currentPage, onNavigate }) {
            const [isOpen, setIsOpen] = useState(false);
            
            const getFABConfig = () => {
                switch(currentPage) {
                    case 'home':
                        return isAdmin ? [
                            { icon: '‚ûï', label: 'Add Recipe', action: () => onNavigate('create') },
                            { icon: 'üçØ', label: 'Syrups', action: () => onNavigate('syrups') },
                            { icon: '‚öôÔ∏è', label: 'Settings', action: () => onNavigate('settings') }
                        ] : [
                            { icon: 'üçØ', label: 'Syrups', action: () => onNavigate('syrups') }
                        ];
                    case 'syrups':
                        return isAdmin ? [
                            { icon: '‚ûï', label: 'Add Syrup', action: () => onNavigate('create-syrup') },
                            { icon: 'üìñ', label: 'Cocktails', action: () => onNavigate('home') },
                            { icon: '‚öôÔ∏è', label: 'Settings', action: () => onNavigate('settings') }
                        ] : [
                            { icon: 'üìñ', label: 'Cocktails', action: () => onNavigate('home') }
                        ];
                    default:
                        return [
                            { icon: 'üìñ', label: 'Cocktails', action: () => onNavigate('home') },
                            { icon: 'üçØ', label: 'Syrups', action: () => onNavigate('syrups') }
                        ];
                }
            };
            
            const fabConfig = getFABConfig();
            
            return (
                <div className="mobile-actions">
                    {isOpen && fabConfig.map((fab, index) => (
                        <button
                            key={index}
                            className="mobile-fab secondary"
                            onClick={() => {
                                fab.action();
                                setIsOpen(false);
                            }}
                            style={{
                                transform: `translateY(-${(index + 1) * 60}px)`,
                                transition: 'transform 0.3s ease'
                            }}
                        >
                            {fab.icon}
                        </button>
                    ))}
                    <button 
                        className="mobile-fab"
                        onClick={() => setIsOpen(!isOpen)}
                    >
                        {isOpen ? '‚úï' : '‚ö°'}
                    </button>
                </div>
            );
        }

        // Main App Component
        function App() {
            const { user, login, loginAsGuest, logout } = useAuth();
            const [currentPage, setCurrentPage] = useState('home');
            const [appData, setAppData] = useState({ recipes: [], syrups: [], settings: {} });
            const [loading, setLoading] = useState(true);
            const [menuOpen, setMenuOpen] = useState(false);
            const [selectedRecipe, setSelectedRecipe] = useState(null);
            const [selectedSyrup, setSelectedSyrup] = useState(null);
            const [showScaleModal, setShowScaleModal] = useState(false);
            const [editingRecipe, setEditingRecipe] = useState(null);
            const [editingSyrup, setEditingSyrup] = useState(null);
            const [isMobile, setIsMobile] = useState(window.innerWidth <= 768);
            
            // Detect mobile screen size
            useEffect(() => {
                const handleResize = () => {
                    setIsMobile(window.innerWidth <= 768);
                };
                
                window.addEventListener('resize', handleResize);
                return () => window.removeEventListener('resize', handleResize);
            }, []);
            
            // Load data from IndexedDB
            useEffect(() => {
                const loadData = async () => {
                    try {
                        const data = await DataManager.getAllData();
                        setAppData(data);
                    } catch (error) {
                        console.error('Error loading data:', error);
                        setAppData({
                            recipes: [],
                            syrups: [],
                            settings: {
                                id: 'app_settings',
                                spirit_types: ['Vodka', 'Gin', 'Rum', 'Tequila', 'Whiskey'],
                                glass_types: ['Martini', 'Highball', 'Old Fashioned'],
                                venues: ['Bar', 'Restaurant', 'Home'],
                                syrup_types: ['Simple Syrup', 'Honey Syrup', 'Grenadine', 'Orgeat', 'Demerara Syrup']
                            }
                        });
                    } finally {
                        setLoading(false);
                    }
                };
                
                loadData();
            }, []);
            
            const refreshData = async () => {
                const data = await DataManager.getAllData();
                setAppData(data);
            };
            
            const navigateTo = (page) => {
                setCurrentPage(page);
                setMenuOpen(false);
            };
            
            const handleSaveRecipe = async (recipeData) => {
                await DataManager.saveRecipe(recipeData);
                await refreshData();
                setCurrentPage('home');
                setEditingRecipe(null);
            };
            
            const handleSaveSyrup = async (syrupData) => {
                await DataManager.saveSyrup(syrupData);
                await refreshData();
                setCurrentPage('syrups');
                setEditingSyrup(null);
            };
            
            const handleUpdateSettings = async (newSettings) => {
                await DataManager.saveSettings(newSettings);
                await refreshData();
            };
            
            const handleDeleteRecipe = async (recipeId) => {
                if (confirm('Are you sure you want to delete this cocktail?')) {
                    await DataManager.deleteRecipe(recipeId);
                    await refreshData();
                    if (currentPage === 'view-recipe') {
                        setCurrentPage('home');
                    }
                }
            };
            
            const handleDeleteSyrup = async (syrupId) => {
                if (confirm('Are you sure you want to delete this syrup?')) {
                    await DataManager.deleteSyrup(syrupId);
                    await refreshData();
                    if (currentPage === 'view-syrup') {
                        setCurrentPage('syrups');
                    }
                }
            };
            
            const handleEditRecipe = (recipe) => {
                setEditingRecipe(recipe);
                setCurrentPage('create');
            };
            
            const handleEditSyrup = (syrup) => {
                setEditingSyrup(syrup);
                setCurrentPage('create-syrup');
            };
            
            if (loading) {
                return (
                    <div className="app">
                        <div style={{ 
                            display: 'flex', 
                            justifyContent: 'center', 
                            alignItems: 'center', 
                            height: '100vh',
                            flexDirection: 'column',
                            gap: '1rem'
                        }}>
                            <div style={{ fontSize: '2rem' }}>üç∏</div>
                            <div>Loading Cocktail Codex...</div>
                        </div>
                    </div>
                );
            }
            
            if (!user) {
                return <LoginPage onLogin={login} onGuestLogin={loginAsGuest} />;
            }
            
            return (
                <div className="app">
                    <header className="header">
                        <div className="header-left">
                            <button 
                                className={`menu-button ${menuOpen ? 'active' : ''}`} 
                                onClick={() => setMenuOpen(!menuOpen)}
                            >
                                <span className="menu-line"></span>
                                <span className="menu-line"></span>
                                <span className="menu-line"></span>
                            </button>
                        </div>
                        <div className="nav-user">
                            üë§ {user.username}
                            {user.isAdmin ? (
                                <span className="role-badge admin">ADMIN</span>
                            ) : (
                                <span className="role-badge user">VIEWER</span>
                            )}
                            <button className="logout-btn" onClick={logout}>Logout</button>
                        </div>
                    </header>
                    
                    <HamburgerMenu 
                        isOpen={menuOpen} 
                        onToggle={setMenuOpen} 
                        currentPage={currentPage} 
                        onNavigate={navigateTo} 
                        isAdmin={user.isAdmin} 
                    />
                    
                    <main>
                        {currentPage === 'home' && (
                            <HomePage 
                                recipes={appData.recipes}
                                onRecipeClick={(recipe) => {
                                    setSelectedRecipe(recipe);
                                    setCurrentPage('view-recipe');
                                }}
                                isAdmin={user.isAdmin}
                                onCreateRecipe={() => {
                                    setEditingRecipe(null);
                                    setCurrentPage('create');
                                }}
                                settings={appData.settings}
                            />
                        )}
                        
                        {currentPage === 'view-recipe' && selectedRecipe && (
                            <ViewRecipePage 
                                recipe={selectedRecipe}
                                onBack={() => setCurrentPage('home')}
                                onScale={() => setShowScaleModal(true)}
                                isAdmin={user.isAdmin}
                                onDeleteRecipe={handleDeleteRecipe}
                                onEditRecipe={handleEditRecipe}
                            />
                        )}
                        
                        {currentPage === 'syrups' && (
                            <SyrupsPage 
                                syrups={appData.syrups}
                                onSyrupClick={(syrup) => {
                                    setSelectedSyrup(syrup);
                                    setCurrentPage('view-syrup');
                                }}
                                isAdmin={user.isAdmin}
                                onCreateSyrup={() => {
                                    setEditingSyrup(null);
                                    setCurrentPage('create-syrup');
                                }}
                                settings={appData.settings}
                            />
                        )}
                        
                        {currentPage === 'view-syrup' && selectedSyrup && (
                            <ViewSyrupPage 
                                syrup={selectedSyrup}
                                onBack={() => setCurrentPage('syrups')}
                                isAdmin={user.isAdmin}
                                onDeleteSyrup={handleDeleteSyrup}
                                onEditSyrup={handleEditSyrup}
                            />
                        )}
                        
                        {currentPage === 'create' && (
                            <CreateRecipePage 
                                onBack={() => {
                                    setCurrentPage('home');
                                    setEditingRecipe(null);
                                }}
                                onSave={handleSaveRecipe}
                                isAdmin={user.isAdmin}
                                settings={appData.settings}
                                editingRecipe={editingRecipe}
                            />
                        )}
                        
                        {currentPage === 'create-syrup' && (
                            <CreateRecipePage 
                                onBack={() => {
                                    setCurrentPage('syrups');
                                    setEditingSyrup(null);
                                }}
                                onSave={handleSaveSyrup}
                                isAdmin={user.isAdmin}
                                settings={appData.settings}
                                editingRecipe={editingSyrup}
                                isSyrup={true}
                            />
                        )}
                        
                        {currentPage === 'settings' && (
                            <SettingsPage 
                                onBack={() => setCurrentPage('home')}
                                isAdmin={user.isAdmin}
                                data={appData}
                                onUpdateSettings={handleUpdateSettings}
                            />
                        )}
                        
                        {showScaleModal && selectedRecipe && (
                            <ScaleModal 
                                recipe={selectedRecipe}
                                onClose={() => setShowScaleModal(false)}
                            />
                        )}
                    </main>
                    
                    {/* Mobile Floating Action Button */}
                    {isMobile && (
                        <MobileFAB 
                            isAdmin={user.isAdmin}
                            currentPage={currentPage}
                            onNavigate={navigateTo}
                        />
                    )}
                </div>
            );
        }

        // Render the app
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
