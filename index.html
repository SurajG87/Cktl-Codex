<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cocktail Manual</title>
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üç∏</text></svg>">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üç∏</text></svg>">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Cocktail Manual">
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #0A0A0A;
            color: #FFFFFF;
            line-height: 1.6;
        }
        
        .app {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: #1A1A1A;
            border-bottom: 1px solid #333;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .menu-button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 0.5rem;
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        
        .menu-line {
            width: 20px;
            height: 2px;
            background: white;
        }
        
        .nav-user {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 0.9rem;
        }
        
        .logout-btn {
            background: #333;
            color: white;
            border: 1px solid #555;
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        /* Login */
        .login-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 1rem;
            background: linear-gradient(135deg, #0A0A0A 0%, #1A1A1A 100%);
        }
        
        .login-box {
            background: #1A1A1A;
            padding: 2rem;
            border-radius: 12px;
            border: 1px solid #333;
            width: 100%;
            max-width: 400px;
            text-align: center;
        }
        
        .login-logo {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        .login-title {
            color: #FFB366;
            margin-bottom: 2rem;
            font-size: 1.5rem;
        }
        
        .login-input {
            width: 100%;
            padding: 1rem;
            margin-bottom: 1rem;
            background: #252525;
            border: 1px solid #333;
            border-radius: 6px;
            color: white;
        }
        
        .login-button {
            width: 100%;
            padding: 1rem;
            background: #FFB366;
            color: #0A0A0A;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 1rem;
        }
        
        .guest-button {
            width: 100%;
            padding: 0.75rem;
            background: #333;
            color: white;
            border: 1px solid #555;
            border-radius: 6px;
            cursor: pointer;
        }
        
        /* Main Content */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
            flex: 1;
        }
        
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        
        .page-title {
            font-size: 2rem;
            color: #FFB366;
        }
        
        .button {
            background: #FFB366;
            color: #0A0A0A;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
        }
        
        /* Recipes Grid */
        .recipes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
        }
        
        .recipe-card {
            background: #1A1A1A;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            border: 1px solid #333;
        }
        
        .recipe-image {
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            background: #252525;
        }
        
        .recipe-info {
            padding: 1rem;
        }
        
        .recipe-name {
            font-weight: bold;
            margin-bottom: 0.25rem;
        }
        
        .recipe-spirit {
            font-size: 0.8rem;
            color: #888;
        }
        
        .loading {
            text-align: center;
            padding: 3rem;
            color: #888;
            font-size: 1.1rem;
        }
        
        .demo-notice {
            background: #FFB366;
            color: #0A0A0A;
            padding: 0.75rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            text-align: center;
            font-weight: bold;
        }
        
        .sync-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
            color: #888;
            margin-top: 0.5rem;
            padding: 0.5rem;
            border-radius: 4px;
            background: #1A1A1A;
        }
        
        .sync-button {
            background: #333;
            color: white;
            border: 1px solid #555;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            margin-left: auto;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // Authentication configuration
        const ADMIN_CREDENTIALS = {
            username: 'suraj',
            password: 'cocktail123'
        };

        // Simple data management with localStorage
        const loadFromStorage = (key, defaultValue) => {
            try {
                const item = localStorage.getItem(key);
                return item ? JSON.parse(item) : defaultValue;
            } catch {
                return defaultValue;
            }
        };
        
        const saveToStorage = (key, value) => {
            try {
                localStorage.setItem(key, JSON.stringify(value));
                return true;
            } catch (error) {
                console.error('Error saving to localStorage:', error);
                return false;
            }
        };

        // Default data
        const getDefaultRecipes = () => {
            return [
                {
                    id: '1',
                    name: 'Aviation',
                    spirit_type: 'Gin',
                    venue: 'Main Bar',
                    glass_type: 'Coupe',
                    abv: 28,
                    pour_cost: 4.25,
                    image_url: '',
                    ingredients: [
                        { name: 'Gin', amount: 45, unit: 'ml' },
                        { name: 'Maraschino Liqueur', amount: 15, unit: 'ml' },
                        { name: 'Cr√®me de Violette', amount: 15, unit: 'ml' },
                        { name: 'Lemon Juice', amount: 30, unit: 'ml' }
                    ],
                    instructions: 'Shake all ingredients with ice. Strain into chilled coupe glass. Garnish with a cherry.',
                    notes: 'Classic pre-prohibition cocktail with a beautiful purple hue.'
                },
                {
                    id: '2', 
                    name: 'Margarita',
                    spirit_type: 'Tequila',
                    venue: 'Pool Bar',
                    glass_type: 'Margarita',
                    abv: 25,
                    pour_cost: 3.75,
                    image_url: '',
                    ingredients: [
                        { name: 'Tequila', amount: 50, unit: 'ml' },
                        { name: 'Lime Juice', amount: 25, unit: 'ml' },
                        { name: 'Triple Sec', amount: 20, unit: 'ml' }
                    ],
                    instructions: 'Shake all ingredients with ice. Strain into salt-rimmed glass filled with ice.',
                    notes: 'Classic tequila cocktail perfect for summer.'
                },
                {
                    id: '3',
                    name: 'Old Fashioned',
                    spirit_type: 'Whiskey',
                    venue: 'Main Bar',
                    glass_type: 'Old Fashioned',
                    abv: 32,
                    pour_cost: 4.50,
                    image_url: '',
                    ingredients: [
                        { name: 'Bourbon Whiskey', amount: 60, unit: 'ml' },
                        { name: 'Sugar Cube', amount: 1, unit: 'piece' },
                        { name: 'Angostura Bitters', amount: 2, unit: 'dash' },
                        { name: 'Orange Twist', amount: 1, unit: 'piece' }
                    ],
                    instructions: 'Muddle sugar cube with bitters and a splash of water. Add whiskey and ice. Stir gently. Garnish with orange twist.',
                    notes: 'Classic whiskey cocktail, one of the oldest known cocktails.'
                }
            ];
        };

        const getDefaultSettings = () => {
            return {
                spirit_types: ['Gin', 'Vodka', 'Rum', 'Tequila', 'Whiskey', 'Brandy'],
                glass_types: ['Coupe', 'Martini', 'Highball', 'Old Fashioned', 'Collins', 'Margarita'],
                venues: ['Main Bar', 'Pool Bar', 'Restaurant', 'Private Event']
            };
        };

        // Data management
        const getRecipes = () => {
            return loadFromStorage('cocktailRecipes', getDefaultRecipes());
        };
        
        const saveRecipes = async (recipes, user) => {
            const localSuccess = saveToStorage('cocktailRecipes', recipes);
            return { localSuccess, cloudSuccess: false };
        };
        
        const getSettings = () => {
            return loadFromStorage('cocktailSettings', getDefaultSettings());
        };

        // Authentication Hook
        function useAuth() {
            const [user, setUser] = useState(null);
            
            useEffect(() => {
                const savedUser = localStorage.getItem('cocktailAppUser');
                if (savedUser) {
                    setUser(JSON.parse(savedUser));
                }
            }, []);
            
            const login = (username, password) => {
                if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
                    const userData = { username, isAdmin: true };
                    setUser(userData);
                    localStorage.setItem('cocktailAppUser', JSON.stringify(userData));
                    return true;
                }
                return false;
            };
            
            const loginAsGuest = () => {
                const guestUser = { username: 'Guest', isAdmin: false };
                setUser(guestUser);
                localStorage.setItem('cocktailAppUser', JSON.stringify(guestUser));
                return true;
            };
            
            const logout = () => {
                setUser(null);
                localStorage.removeItem('cocktailAppUser');
            };
            
            return { user, login, loginAsGuest, logout };
        }

        // Login Page Component
        function LoginPage({ onLogin, onGuestLogin }) {
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            
            const handleSubmit = (e) => {
                e.preventDefault();
                if (onLogin(username, password)) {
                    setError('');
                } else {
                    setError('Invalid credentials');
                }
            };
            
            return (
                <div className="login-container">
                    <div className="login-box">
                        <div className="login-logo">üç∏</div>
                        <h1 className="login-title">Cocktail Manual</h1>
                        
                        <form onSubmit={handleSubmit}>
                            <input
                                type="text"
                                className="login-input"
                                placeholder="Username"
                                value={username}
                                onChange={(e) => setUsername(e.target.value)}
                                required
                            />
                            <input
                                type="password"
                                className="login-input"
                                placeholder="Password"
                                value={password}
                                onChange={(e) => setPassword(e.target.value)}
                                required
                            />
                            {error && <div style={{color: '#f44336', marginBottom: '1rem'}}>{error}</div>}
                            <button type="submit" className="login-button">
                                Admin Login
                            </button>
                        </form>
                        
                        <div style={{margin: '1rem 0', color: '#666', textAlign: 'center'}}>or</div>
                        
                        <button className="guest-button" onClick={onGuestLogin}>
                            Continue as Guest
                        </button>
                        
                        <div style={{marginTop: '2rem', fontSize: '0.8rem', color: '#666'}}>
                            <strong>Admin Demo:</strong><br/>
                            Username: suraj<br/>
                            Password: cocktail123
                        </div>
                    </div>
                </div>
            );
        }

        // Recipe Card Component
        function RecipeCard({ recipe, onClick, isAdmin }) {
            const imageStyle = {
                backgroundImage: recipe.image_url ? `url(${recipe.image_url})` : 'none',
                backgroundSize: 'cover',
                backgroundPosition: 'center'
            };
            
            return (
                <div className="recipe-card" onClick={() => onClick(recipe)}>
                    <div className="recipe-image" style={imageStyle}>
                        {!recipe.image_url && 'üç∏'}
                    </div>
                    <div className="recipe-info">
                        <div className="recipe-name">{recipe.name}</div>
                        <div className="recipe-spirit">{recipe.spirit_type}</div>
                    </div>
                </div>
            );
        }

        // Home Page Component
        function HomePage({ onRecipeClick, isAdmin, onCreateRecipe, syncStatus, onSync, recipes }) {
            const [searchTerm, setSearchTerm] = useState('');
            
            const filteredRecipes = recipes.filter(recipe => 
                recipe.name.toLowerCase().includes(searchTerm.toLowerCase())
            );
            
            return (
                <div className="container">
                    <div className="demo-notice">
                        üç∏ Cocktail Manual - Local Demo Version
                    </div>
                    
                    <div className="page-header">
                        <h1 className="page-title">Cocktail Menu</h1>
                        {isAdmin && (
                            <button className="button" onClick={onCreateRecipe}>
                                + Add Recipe
                            </button>
                        )}
                    </div>
                    
                    <div style={{marginBottom: '1rem'}}>
                        <input 
                            type="text"
                            className="login-input"
                            placeholder="Search cocktails..."
                            value={searchTerm}
                            onChange={(e) => setSearchTerm(e.target.value)}
                            style={{marginBottom: '0'}}
                        />
                    </div>
                    
                    {filteredRecipes.length === 0 ? (
                        <div className="loading">
                            No cocktails found matching your criteria.
                        </div>
                    ) : (
                        <>
                            <div style={{marginBottom: '1rem', color: '#888', fontSize: '0.9rem'}}>
                                Showing {filteredRecipes.length} of {recipes.length} cocktails
                                {isAdmin && ' ‚Ä¢ Add new cocktails to expand the menu!'}
                            </div>
                            <div className="recipes-grid">
                                {filteredRecipes.map(recipe => (
                                    <RecipeCard 
                                        key={recipe.id}
                                        recipe={recipe}
                                        onClick={onRecipeClick}
                                        isAdmin={isAdmin}
                                    />
                                ))}
                            </div>
                        </>
                    )}
                </div>
            );
        }

        // View Recipe Component
        function ViewRecipePage({ recipe, onBack, isAdmin }) {
            const backgroundStyle = {
                backgroundImage: recipe.image_url ? `url(${recipe.image_url})` : 'none',
                backgroundSize: 'cover',
                backgroundPosition: 'center'
            };
            
            return (
                <div className="container">
                    <button className="button" onClick={onBack} style={{background: '#333', color: 'white', marginBottom: '1rem'}}>
                        ‚Üê Back to Cocktails
                    </button>
                    
                    <div style={{background: '#1A1A1A', borderRadius: '12px', overflow: 'hidden'}}>
                        {recipe.image_url && (
                            <div style={{height: '200px', ...backgroundStyle}}></div>
                        )}
                        
                        <div style={{padding: '2rem'}}>
                            <div style={{marginBottom: '2rem'}}>
                                <h1 style={{fontSize: '2.5rem', color: '#FFB366', marginBottom: '1rem'}}>{recipe.name}</h1>
                                <div style={{display: 'flex', flexWrap: 'wrap', gap: '1rem'}}>
                                    <div style={{background: '#252525', padding: '0.5rem 1rem', borderRadius: '20px', fontSize: '0.9rem'}}>
                                        {recipe.spirit_type}
                                    </div>
                                    <div style={{background: '#252525', padding: '0.5rem 1rem', borderRadius: '20px', fontSize: '0.9rem'}}>
                                        {recipe.glass_type} Glass
                                    </div>
                                    <div style={{background: '#252525', padding: '0.5rem 1rem', borderRadius: '20px', fontSize: '0.9rem'}}>
                                        {recipe.abv}% ABV
                                    </div>
                                    <div style={{background: '#252525', padding: '0.5rem 1rem', borderRadius: '20px', fontSize: '0.9rem'}}>
                                        ${recipe.pour_cost} Cost
                                    </div>
                                </div>
                            </div>
                            
                            <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '2rem'}}>
                                <div>
                                    <h3 style={{color: '#FFB366', marginBottom: '1rem'}}>Ingredients</h3>
                                    <div style={{listStyle: 'none'}}>
                                        {recipe.ingredients.map((ingredient, index) => (
                                            <div key={index} style={{display: 'flex', justifyContent: 'space-between', padding: '0.75rem 0', borderBottom: '1px solid #333'}}>
                                                <span>{ingredient.name}</span>
                                                <span>{ingredient.amount} {ingredient.unit}</span>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                
                                <div>
                                    <h3 style={{color: '#FFB366', marginBottom: '1rem'}}>Instructions</h3>
                                    <div style={{background: '#252525', padding: '1.5rem', borderRadius: '8px', whiteSpace: 'pre-line', lineHeight: '1.8'}}>
                                        {recipe.instructions}
                                    </div>
                                    
                                    {recipe.notes && (
                                        <>
                                            <h3 style={{color: '#FFB366', marginBottom: '1rem', marginTop: '1.5rem'}}>Notes</h3>
                                            <div style={{background: '#252525', padding: '1.5rem', borderRadius: '8px', whiteSpace: 'pre-line', lineHeight: '1.8'}}>
                                                {recipe.notes}
                                            </div>
                                        </>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Main App Component
        function App() {
            const { user, login, loginAsGuest, logout } = useAuth();
            const [currentPage, setCurrentPage] = useState('home');
            const [selectedRecipe, setSelectedRecipe] = useState(null);
            const [recipes, setRecipes] = useState(getRecipes());
            
            useEffect(() => {
                // Initialize with default data if empty
                const currentRecipes = getRecipes();
                if (currentRecipes.length === 0) {
                    saveToStorage('cocktailRecipes', getDefaultRecipes());
                    setRecipes(getDefaultRecipes());
                }
            }, []);
            
            const navigateTo = (page, item = null) => {
                setCurrentPage(page);
                if (page === 'view-recipe') setSelectedRecipe(item);
            };
            
            const handleSaveRecipe = async (recipeData, user) => {
                const updatedRecipes = [...recipes, recipeData];
                const result = await saveRecipes(updatedRecipes, user);
                
                if (result.localSuccess) {
                    setRecipes(updatedRecipes);
                    navigateTo('home');
                }
            };
            
            const renderPage = () => {
                if (!user) {
                    return <LoginPage onLogin={login} onGuestLogin={loginAsGuest} />;
                }
                
                switch(currentPage) {
                    case 'home':
                        return <HomePage 
                            onRecipeClick={(recipe) => navigateTo('view-recipe', recipe)}
                            isAdmin={user.isAdmin}
                            onCreateRecipe={() => navigateTo('create-recipe')}
                            recipes={recipes}
                        />;
                    case 'view-recipe':
                        return <ViewRecipePage 
                            recipe={selectedRecipe} 
                            onBack={() => navigateTo('home')}
                            isAdmin={user.isAdmin}
                        />;
                    default:
                        return <HomePage 
                            onRecipeClick={(recipe) => navigateTo('view-recipe', recipe)}
                            isAdmin={user.isAdmin}
                            onCreateRecipe={() => navigateTo('create-recipe')}
                            recipes={recipes}
                        />;
                }
            };
            
            return (
                <div className="app">
                    {user && (
                        <header className="header">
                            <div className="header-left">
                                <button className="menu-button">
                                    <span className="menu-line"></span>
                                    <span className="menu-line"></span>
                                    <span className="menu-line"></span>
                                </button>
                            </div>
                            
                            <div className="nav-user">
                                üë§ {user.username}
                                {user.isAdmin && <span style={{color: '#FFB366', fontSize: '0.7rem'}}> (Admin)</span>}
                                <button className="logout-btn" onClick={logout}>
                                    Logout
                                </button>
                            </div>
                        </header>
                    )}
                    
                    <main>
                        {renderPage()}
                    </main>
                </div>
            );
        }

        // Render the app
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
