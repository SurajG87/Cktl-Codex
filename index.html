<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cocktail Manual - User Access</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üç∏</text></svg>">
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; touch-action: manipulation; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #0A0A0A; color: white; line-height: 1.6; }
        
        .app { min-height: 100vh; background: #0A0A0A; }
        .container { max-width: 1200px; margin: 0 auto; padding: 1rem; }
        
        .header { background: #1A1A1A; padding: 1rem; border-bottom: 1px solid #333; position: sticky; top: 0; z-index: 100; 
            height: 70px; display: flex; align-items: center; justify-content: space-between; }
        .menu-button { background: none; border: none; color: white; cursor: pointer; padding: 0.5rem; display: flex; flex-direction: column; 
            gap: 4px; width: 30px; height: 30px; justify-content: center; align-items: center; }
        .menu-line { width: 20px; height: 2px; background: white; transition: all 0.3s ease; }
        .menu-button.active .menu-line:nth-child(1) { transform: rotate(45deg) translate(6px, 6px); }
        .menu-button.active .menu-line:nth-child(2) { opacity: 0; }
        .menu-button.active .menu-line:nth-child(3) { transform: rotate(-45deg) translate(6px, -6px); }
        .nav-user { color: #FFB366; font-size: 0.9rem; display: flex; align-items: center; gap: 0.5rem; }
        .logout-btn { background: transparent; border: 1px solid #FFB366; color: #FFB366; padding: 0.4rem 0.8rem; 
            border-radius: 4px; cursor: pointer; font-size: 0.8rem; white-space: nowrap; }
        .logout-btn:hover { background: #FFB366; color: #0A0A0A; }
        
        .side-menu-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); 
            z-index: 999; opacity: 0; visibility: hidden; transition: all 0.3s ease; }
        .side-menu-overlay.active { opacity: 1; visibility: visible; }
        .side-menu { position: fixed; top: 0; left: -300px; width: 280px; height: 100vh; background: #1A1A1A; 
            border-right: 1px solid #333; z-index: 1000; transition: left 0.3s ease; overflow-y: auto; padding: 2rem 1rem; }
        .side-menu.active { left: 0; }
        .side-menu-header { display: flex; align-items: center; gap: 1rem; margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 1px solid #333; }
        .side-menu-logo { width: 40px; height: 40px; background: linear-gradient(135deg, #FFB366, #FF8C42); border-radius: 8px; 
            display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }
        .side-menu-title { font-size: 1.2rem; font-weight: bold; color: #FFB366; }
        .side-menu-nav { display: flex; flex-direction: column; gap: 0.5rem; }
        .side-menu-button { background: #333; color: white; border: none; padding: 1rem; border-radius: 8px; cursor: pointer; 
            text-align: left; font-size: 1rem; transition: all 0.2s ease; display: flex; align-items: center; gap: 0.75rem; }
        .side-menu-button:hover { background: #444; transform: translateX(5px); }
        .side-menu-button.active { background: #FFB366; color: #0A0A0A; }
        .side-menu-button.disabled { opacity: 0.5; cursor: not-allowed; }
        .side-menu-button.disabled:hover { background: #333; transform: none; }
        
        .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem; }
        .page-title { font-size: 1.8rem; color: #FFB366; }
        
        .search-section { background: #1A1A1A; padding: 1.25rem; border-radius: 10px; margin-bottom: 1.5rem; border: 1px solid #333; }
        .search-box { width: 100%; padding: 0.75rem; background: #333; border: 1px solid #555; border-radius: 6px; color: white; 
            margin-bottom: 1rem; font-size: 1rem; }
        .filters { display: flex; gap: 0.75rem; flex-wrap: wrap; }
        .filter-select { padding: 0.75rem; background: #333; border: 1px solid #555; border-radius: 6px; color: white; 
            flex: 1; min-width: 140px; font-size: 0.9rem; }
        
        .recipes-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 0.75rem; margin-bottom: 1.5rem; }
        .recipe-card { background: #1A1A1A; border-radius: 10px; overflow: hidden; border: 1px solid #333; 
            transition: all 0.2s ease; cursor: pointer; position: relative; }
        .recipe-card:hover { transform: translateY(-2px); border-color: #FFB366; }
        .recipe-image { width: 100%; height: 160px; background: #333; display: flex; align-items: center; justify-content: center; 
            color: #666; background-size: cover; background-position: center; position: relative; }
        .recipe-info { padding: 0.75rem; }
        .recipe-name { font-weight: bold; margin-bottom: 0.25rem; font-size: 0.9rem; line-height: 1.2; }
        .recipe-spirit { color: #FFB366; font-size: 0.8rem; }
        
        .alphabet-section { margin-bottom: 2rem; }
        .letter-header { font-size: 1.5rem; color: #FFB366; margin-bottom: 0.75rem; padding-bottom: 0.5rem; border-bottom: 2px solid #FFB366; }
        
        .footer { text-align: center; padding: 1.5rem 1rem; margin-top: 2rem; border-top: 1px solid #333; color: #666; font-size: 0.9rem; }
        .footer a { color: #FFB366; text-decoration: none; }
        .footer a:hover { text-decoration: underline; }
        
        .form { background: #1A1A1A; padding: 1.5rem; border-radius: 10px; border: 1px solid #333; max-width: 100%; margin: 0 auto; }
        .form-group { margin-bottom: 1.25rem; }
        .form-label { display: block; margin-bottom: 0.5rem; color: #FFB366; font-size: 0.9rem; }
        .form-input, .form-textarea { width: 100%; padding: 0.75rem; background: #333; border: 1px solid #555; border-radius: 6px; 
            color: white; font-size: 16px; }
        .form-textarea { min-height: 100px; resize: vertical; font-family: inherit; }
        .button { background: #FFB366; color: #0A0A0A; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; 
            cursor: pointer; font-weight: bold; transition: background 0.2s; font-size: 1rem; }
        .button:hover { background: #FF8C42; }
        .button-secondary { background: #333; color: white; }
        .button-secondary:hover { background: #444; }
        .buttons-row { display: flex; gap: 0.75rem; margin-top: 1.5rem; flex-wrap: wrap; }
        .buttons-row .button { flex: 1; min-width: 120px; }
        
        .image-upload { border: 2px dashed #555; border-radius: 8px; padding: 1.5rem; text-align: center; cursor: pointer; transition: border-color 0.2s; }
        .image-upload:hover { border-color: #FFB366; }
        .image-preview { max-width: 100%; max-height: 250px; border-radius: 8px; margin-top: 1rem; }
        
        .loading { text-align: center; padding: 2rem; color: #666; }
        
        .recipe-view { background: #1A1A1A; border-radius: 10px; padding: 1.5rem; border: 1px solid #333; position: relative; overflow: hidden; }
        .recipe-background { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-size: cover; background-position: center; 
            opacity: 0.1; z-index: 0; filter: brightness(0.3) contrast(1.2); }
        .recipe-content { position: relative; z-index: 1; }
        .recipe-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem; }
        .recipe-title { font-size: 1.8rem; color: #FFB366; margin-bottom: 0.5rem; }
        .recipe-meta { display: flex; gap: 1rem; flex-wrap: wrap; margin-bottom: 1rem; }
        .meta-item { background: #333; padding: 0.5rem 1rem; border-radius: 6px; font-size: 0.9rem; }
        .recipe-image-large { width: 100%; max-width: 300px; height: 300px; background: #333; border-radius: 10px; margin-bottom: 1.5rem; 
            background-size: cover; background-position: center; position: relative; z-index: 1; }
        .recipe-details { display: grid; grid-template-columns: 1fr; gap: 1.5rem; position: relative; z-index: 1; }
        .ingredients-list { list-style: none; }
        .ingredient-item { padding: 0.75rem; border-bottom: 1px solid #333; display: flex; justify-content: space-between; }
        .ingredient-item:last-child { border-bottom: none; }
        .instructions { white-space: pre-line; line-height: 1.6; }
        .action-buttons { display: flex; gap: 0.75rem; margin-top: 1.5rem; flex-wrap: wrap; }
        .action-button { background: #333; color: white; border: none; padding: 0.75rem; border-radius: 6px; cursor: pointer; 
            display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; transition: background 0.2s; }
        .action-button:hover { background: #444; }
        .action-button.edit { background: #4CAF50; }
        .action-button.edit:hover { background: #45a049; }
        .action-button.delete { background: #f44336; }
        .action-button.delete:hover { background: #d32f2f; }
        
        .settings-section { background: #1A1A1A; padding: 1.5rem; border-radius: 10px; border: 1px solid #333; margin-bottom: 1.5rem; }
        .settings-title { font-size: 1.3rem; color: #FFB366; margin-bottom: 1rem; }
        .settings-list { list-style: none; min-height: 60px; }
        .settings-item { padding: 1rem; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
        .settings-item:last-child { border-bottom: none; }
        .settings-actions { display: flex; gap: 0.5rem; }
        .icon-button { background: #333; color: white; border: none; padding: 0.5rem; border-radius: 4px; cursor: pointer; 
            display: flex; align-items: center; justify-content: center; width: 32px; height: 32px; font-size: 1rem; }
        .icon-button:hover { background: #444; }
        .icon-button.delete { background: #f44336; }
        .icon-button.delete:hover { background: #d32f2f; }
        
        .sync-status { 
            position: fixed; 
            top: 80px; 
            right: 20px; 
            background: #1A1A1A; 
            padding: 0.5rem 1rem; 
            border-radius: 6px; 
            border: 1px solid #333;
            font-size: 0.8rem;
            z-index: 1000;
            transition: all 0.3s ease;
        }
        .sync-status.syncing { border-color: #FFB366; color: #FFB366; }
        .sync-status.error { border-color: #f44336; color: #f44336; }
        .sync-status.success { border-color: #4CAF50; color: #4CAF50; }

        /* Scale control styles */
        .scale-control {
            background: #333;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            border: 1px solid #555;
        }
        .scale-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .scale-title {
            color: #FFB366;
            font-size: 1.1rem;
        }
        .scale-reset {
            background: transparent;
            border: 1px solid #FFB366;
            color: #FFB366;
            padding: 0.4rem 0.8rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        .scale-reset:hover {
            background: #FFB366;
            color: #0A0A0A;
        }
        .scale-slider {
            width: 100%;
            margin: 1rem 0;
        }
        .scale-values {
            display: flex;
            justify-content: space-between;
            margin-top: 0.5rem;
            color: #888;
            font-size: 0.9rem;
        }
        .scale-value {
            text-align: center;
            flex: 1;
        }
        .scale-value.active {
            color: #FFB366;
            font-weight: bold;
        }

        /* Data Management Styles */
        .data-management {
            background: #1A1A1A;
            padding: 1.5rem;
            border-radius: 10px;
            border: 1px solid #333;
            margin-bottom: 1.5rem;
        }
        .data-section {
            margin-bottom: 2rem;
        }
        .data-section:last-child {
            margin-bottom: 0;
        }
        .data-title {
            color: #FFB366;
            font-size: 1.3rem;
            margin-bottom: 1rem;
        }
        .data-description {
            color: #888;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }
        .data-actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        .data-action-btn {
            background: #333;
            color: white;
            border: none;
            padding: 1rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            transition: background 0.2s;
        }
        .data-action-btn:hover {
            background: #444;
        }
        .data-action-btn.export {
            background: #4CAF50;
        }
        .data-action-btn.export:hover {
            background: #45a049;
        }
        .data-action-btn.import {
            background: #2196F3;
        }
        .data-action-btn.import:hover {
            background: #1976D2;
        }
        .file-input {
            display: none;
        }

        /* User Access Styles */
        .user-access-section {
            background: #1A1A1A;
            padding: 1.5rem;
            border-radius: 10px;
            border: 1px solid #333;
            margin-bottom: 1.5rem;
        }
        .access-code {
            font-family: monospace;
            background: #333;
            padding: 1rem;
            border-radius: 6px;
            margin: 1rem 0;
            font-size: 1.2rem;
            text-align: center;
            border: 2px solid #FFB366;
            word-break: break-all;
        }
        .qr-code {
            text-align: center;
            margin: 1rem 0;
        }
        .qr-placeholder {
            width: 200px;
            height: 200px;
            background: #333;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            border: 2px solid #555;
            color: #888;
        }
        .share-methods {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1.5rem;
        }
        .share-method {
            background: #333;
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #555;
        }
        .share-method h4 {
            color: #FFB366;
            margin-bottom: 1rem;
        }

        @media (max-width: 768px) {
            .header { padding: 0.75rem; height: 60px; }
            .container { padding: 0.75rem; }
            .page-title { font-size: 1.5rem; }
            .recipes-grid { grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 0.5rem; }
            .recipe-image { height: 140px; }
            .filters { flex-direction: column; }
            .filter-select { min-width: auto; }
            .side-menu { width: 85%; max-width: 280px; }
            .form { padding: 1rem; }
            .buttons-row { flex-direction: column; }
            .buttons-row .button { width: 100%; }
            .nav-user { font-size: 0.8rem; }
            .logout-btn { padding: 0.3rem 0.6rem; font-size: 0.7rem; }
            .recipe-header { flex-direction: column; }
            .action-buttons { width: 100%; }
            .action-buttons button { flex: 1; }
            .page-header { flex-direction: column; align-items: flex-start; }
            .sync-status { top: 70px; right: 10px; left: 10px; text-align: center; }
            .data-actions { flex-direction: column; }
            .data-action-btn { width: 100%; justify-content: center; }
            .share-methods { grid-template-columns: 1fr; }
        }
        @media (min-width: 768px) {
            .recipe-details { grid-template-columns: 1fr 1fr; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;
        
        // Configuration
        const ADMIN_CREDENTIALS = { username: 'suraj', password: 'cocktail123' };

        // Data Service - Simple localStorage with URL data sharing
        const dataService = {
            async loadData() {
                try {
                    console.log('üîÑ Loading data from localStorage...');
                    
                    // First, check if there's data in the URL (for user access)
                    const urlData = this.getDataFromURL();
                    if (urlData) {
                        console.log('üì• Loaded data from URL');
                        return urlData;
                    }
                    
                    const savedData = localStorage.getItem('cocktailData');
                    if (savedData) {
                        const data = JSON.parse(savedData);
                        console.log('üì• Loaded from localStorage:', data);
                        return data;
                    }
                    
                    // Return default data structure
                    const defaultData = {
                        recipes: [],
                        settings: {
                            spirit_types: ['Gin', 'Vodka', 'Rum', 'Tequila', 'Whiskey', 'Brandy'],
                            glass_types: ['Coupe', 'Martini', 'Highball', 'Old Fashioned', 'Collins', 'Margarita'],
                            venues: ['Main Bar', 'Pool Bar', 'Restaurant', 'Private Event']
                        }
                    };
                    
                    console.log('üì• Using default data');
                    return defaultData;
                } catch (error) {
                    console.error('‚ùå Error loading data:', error);
                    return {
                        recipes: [],
                        settings: {
                            spirit_types: ['Gin', 'Vodka', 'Rum', 'Tequila', 'Whiskey', 'Brandy'],
                            glass_types: ['Coupe', 'Martini', 'Highball', 'Old Fashioned', 'Collins', 'Margarita'],
                            venues: ['Main Bar', 'Pool Bar', 'Restaurant', 'Private Event']
                        }
                    };
                }
            },

            async saveData(data) {
                try {
                    console.log('üíæ Saving data to localStorage...');
                    localStorage.setItem('cocktailData', JSON.stringify(data));
                    console.log('‚úÖ Data saved to localStorage');
                    return { success: true };
                } catch (error) {
                    console.error('‚ùå Error saving data:', error);
                    return { success: false, error: error.message };
                }
            },

            exportData() {
                const data = localStorage.getItem('cocktailData');
                if (!data) {
                    alert('No data to export!');
                    return;
                }

                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'cocktail-data.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            },

            importData(file, onSuccess, onError) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        // Validate the data structure
                        if (!data.recipes || !data.settings) {
                            throw new Error('Invalid data format');
                        }
                        
                        localStorage.setItem('cocktailData', JSON.stringify(data));
                        console.log('‚úÖ Data imported successfully');
                        onSuccess();
                    } catch (error) {
                        console.error('‚ùå Error importing data:', error);
                        onError('Invalid file format. Please select a valid cocktail data file.');
                    }
                };
                reader.onerror = () => onError('Error reading file');
                reader.readAsText(file);
            },

            // Generate shareable URL with data embedded
            generateShareableURL() {
                const data = localStorage.getItem('cocktailData');
                if (!data) {
                    return null;
                }

                // Compress and encode data for URL
                try {
                    // For larger datasets, we might need to use compression
                    // For now, we'll use base64 encoding
                    const compressedData = btoa(unescape(encodeURIComponent(data)));
                    const currentUrl = window.location.origin + window.location.pathname;
                    return `${currentUrl}?data=${compressedData}`;
                } catch (error) {
                    console.error('Error generating share URL:', error);
                    return null;
                }
            },

            // Extract data from URL
            getDataFromURL() {
                const urlParams = new URLSearchParams(window.location.search);
                const encodedData = urlParams.get('data');
                
                if (encodedData) {
                    try {
                        const decodedData = decodeURIComponent(escape(atob(encodedData)));
                        return JSON.parse(decodedData);
                    } catch (error) {
                        console.error('Error decoding URL data:', error);
                        return null;
                    }
                }
                return null;
            },

            // Generate QR code data URL (simplified)
            generateQRCodeData() {
                const shareUrl = this.generateShareableURL();
                if (!shareUrl) return null;
                
                // In a real implementation, you would use a QR code library
                // For now, we'll return a data URL that can be used with external QR generators
                return `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(shareUrl)}`;
            }
        };

        // Data operations
        const getRecipes = async () => {
            const data = await dataService.loadData();
            return data.recipes || [];
        };

        const getSettings = async () => {
            const data = await dataService.loadData();
            return data.settings || {
                spirit_types: ['Gin', 'Vodka', 'Rum', 'Tequila', 'Whiskey', 'Brandy'],
                glass_types: ['Coupe', 'Martini', 'Highball', 'Old Fashioned', 'Collins', 'Margarita'],
                venues: ['Main Bar', 'Pool Bar', 'Restaurant', 'Private Event']
            };
        };

        const saveRecipe = async (recipe, isEdit = false) => {
            console.log('üíæ Saving recipe:', recipe.name);
            const data = await dataService.loadData();
            let updatedRecipes;
            
            if (isEdit) {
                updatedRecipes = data.recipes.map(r => r.id === recipe.id ? recipe : r);
            } else {
                const newRecipe = { 
                    ...recipe, 
                    id: Date.now().toString() + Math.random().toString(36).substr(2, 9)
                };
                updatedRecipes = [...data.recipes, newRecipe];
            }
            
            const updatedData = {
                ...data,
                recipes: updatedRecipes
            };
            
            const result = await dataService.saveData(updatedData);
            return { 
                ...result, 
                recipe: isEdit ? recipe : updatedRecipes[updatedRecipes.length - 1]
            };
        };

        const deleteRecipe = async (recipeId) => {
            console.log('üóëÔ∏è Deleting recipe:', recipeId);
            const data = await dataService.loadData();
            const updatedRecipes = data.recipes.filter(recipe => recipe.id !== recipeId);
            
            const updatedData = {
                ...data,
                recipes: updatedRecipes
            };
            
            const result = await dataService.saveData(updatedData);
            return result;
        };

        const saveSettings = async (newSettings) => {
            console.log('‚öôÔ∏è Saving settings...');
            const data = await dataService.loadData();
            
            const updatedData = {
                ...data,
                settings: newSettings
            };
            
            const result = await dataService.saveData(updatedData);
            return result;
        };

        // Utility functions
        const convertImageToBase64 = (file) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        };

        // Check if user is accessing via shared data URL
        const isUserAccess = () => {
            return dataService.getDataFromURL() !== null;
        };

        // Authentication Hook
        function useAuth() {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            
            useEffect(() => {
                const checkAuth = () => {
                    try {
                        // If accessing via shared URL, automatically set as user
                        if (isUserAccess()) {
                            const guestUser = { username: 'User', isAdmin: false };
                            setUser(guestUser);
                            localStorage.setItem('cocktailAppUser', JSON.stringify(guestUser));
                            setLoading(false);
                            return;
                        }

                        const savedUser = localStorage.getItem('cocktailAppUser');
                        if (savedUser) {
                            const userData = JSON.parse(savedUser);
                            setUser(userData);
                        }
                    } catch (error) {
                        console.error('Error loading user:', error);
                    } finally {
                        setLoading(false);
                    }
                };
                
                checkAuth();
            }, []);
            
            const login = (username, password) => {
                if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
                    const userData = { username, isAdmin: true };
                    setUser(userData);
                    localStorage.setItem('cocktailAppUser', JSON.stringify(userData));
                    return true;
                }
                return false;
            };
            
            const loginAsGuest = () => {
                const guestUser = { username: 'Guest', isAdmin: false };
                setUser(guestUser);
                localStorage.setItem('cocktailAppUser', JSON.stringify(guestUser));
                return true;
            };
            
            const logout = () => {
                setUser(null);
                localStorage.removeItem('cocktailAppUser');
                // If user was accessing via shared URL, redirect to clean URL
                if (isUserAccess()) {
                    window.location.href = window.location.origin + window.location.pathname;
                }
            };
            
            return { user, loading, login, loginAsGuest, logout };
        }

        // User Access Component - For Admin to share access
        function UserAccess({ onSyncStatus }) {
            const [shareUrl, setShareUrl] = useState(null);
            const [qrCodeUrl, setQrCodeUrl] = useState(null);
            
            useEffect(() => {
                const url = dataService.generateShareableURL();
                setShareUrl(url);
                
                if (url) {
                    const qrUrl = dataService.generateQRCodeData();
                    setQrCodeUrl(qrUrl);
                }
            }, []);
            
            const copyToClipboard = () => {
                if (!shareUrl) {
                    onSyncStatus('error', 'No data to share! Please add some recipes first.');
                    return;
                }
                
                navigator.clipboard.writeText(shareUrl).then(() => {
                    onSyncStatus('success', 'Share URL copied to clipboard!');
                }).catch(() => {
                    // Fallback for older browsers
                    const textArea = document.createElement('textarea');
                    textArea.value = shareUrl;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    onSyncStatus('success', 'Share URL copied to clipboard!');
                });
            };
            
            const downloadDataFile = () => {
                dataService.exportData();
                onSyncStatus('success', 'Data file downloaded!');
            };
            
            return (
                <div className="user-access-section">
                    <h2 className="page-title">Share with Users</h2>
                    
                    {!shareUrl ? (
                        <div className="data-section">
                            <p style={{color: '#ff6b6b', textAlign: 'center'}}>
                                No data to share! Please add some recipes first.
                            </p>
                        </div>
                    ) : (
                        <>
                            <div className="share-methods">
                                <div className="share-method">
                                    <h4>üì± Share via URL</h4>
                                    <p style={{fontSize: '0.9rem', marginBottom: '1rem', color: '#888'}}>
                                        Copy this URL and share it with users. When they open it, they'll see all your recipes.
                                    </p>
                                    <div className="access-code">
                                        {shareUrl}
                                    </div>
                                    <button className="data-action-btn export" onClick={copyToClipboard} style={{width: '100%'}}>
                                        üìã Copy Share URL
                                    </button>
                                </div>
                                
                                <div className="share-method">
                                    <h4>üìÑ Share via File</h4>
                                    <p style={{fontSize: '0.9rem', marginBottom: '1rem', color: '#888'}}>
                                        Download a data file that users can import on their devices.
                                    </p>
                                    <button className="data-action-btn import" onClick={downloadDataFile} style={{width: '100%'}}>
                                        üì• Download Data File
                                    </button>
                                </div>
                            </div>
                            
                            <div className="data-section">
                                <h3 className="data-title">QR Code for Mobile Access</h3>
                                <p className="data-description">
                                    Users can scan this QR code with their phone cameras to quickly access the cocktail menu.
                                </p>
                                
                                <div className="qr-code">
                                    {qrCodeUrl ? (
                                        <img src={qrCodeUrl} alt="QR Code" style={{width: '200px', height: '200px', borderRadius: '8px'}} />
                                    ) : (
                                        <div className="qr-placeholder">
                                            QR Code<br/>(Scan with phone camera)
                                        </div>
                                    )}
                                </div>
                            </div>
                            
                            <div className="data-section">
                                <h3 className="data-title">How to Share</h3>
                                <p className="data-description">
                                    <strong>Option 1 - URL Sharing (Recommended):</strong><br/>
                                    1. Copy the share URL above<br/>
                                    2. Send it to your team via WhatsApp, Email, etc.<br/>
                                    3. Users open the URL to instantly see all recipes<br/>
                                    <br/>
                                    <strong>Option 2 - File Sharing:</strong><br/>
                                    1. Download the data file<br/>
                                    2. Share the file with your team<br/>
                                    3. Users import the file in the app<br/>
                                    <br/>
                                    <strong>User Permissions:</strong><br/>
                                    ‚úÖ View all cocktail recipes<br/>
                                    ‚úÖ Search and filter cocktails<br/>
                                    ‚úÖ Use scale feature to adjust quantities<br/>
                                    ‚ùå Cannot modify any data
                                </p>
                            </div>
                        </>
                    )}
                </div>
            );
        }

        // Data Management Component
        function DataManagement({ onSyncStatus }) {
            const { refreshData } = useData();
            const fileInputRef = useRef(null);
            
            const handleExport = () => {
                dataService.exportData();
                onSyncStatus('success', 'Data exported successfully');
            };
            
            const handleImportClick = () => {
                fileInputRef.current?.click();
            };
            
            const handleImport = (event) => {
                const file = event.target.files[0];
                if (!file) return;
                
                if (file.type !== 'application/json') {
                    onSyncStatus('error', 'Please select a JSON file');
                    return;
                }
                
                dataService.importData(
                    file,
                    () => {
                        onSyncStatus('success', 'Data imported successfully');
                        refreshData();
                        if (fileInputRef.current) {
                            fileInputRef.current.value = '';
                        }
                    },
                    (error) => {
                        onSyncStatus('error', error);
                    }
                );
            };
            
            return (
                <div className="data-management">
                    <h2 className="page-title">Data Management</h2>
                    
                    <div className="data-section">
                        <h3 className="data-title">Export Data</h3>
                        <p className="data-description">
                            Download all cocktail recipes and settings as a JSON file for backup.
                        </p>
                        <div className="data-actions">
                            <button className="data-action-btn export" onClick={handleExport}>
                                üì• Export Data
                            </button>
                        </div>
                    </div>
                    
                    <div className="data-section">
                        <h3 className="data-title">Import Data</h3>
                        <p className="data-description">
                            Upload a previously exported JSON file to restore your cocktail data.
                        </p>
                        <div className="data-actions">
                            <button className="data-action-btn import" onClick={handleImportClick}>
                                üì§ Import Data
                            </button>
                            <input
                                ref={fileInputRef}
                                type="file"
                                accept=".json"
                                onChange={handleImport}
                                className="file-input"
                            />
                        </div>
                    </div>
                </div>
            );
        }

        // Sync Status Component
        function SyncStatus({ status, message }) {
            if (!status) return null;
            
            return (
                <div className={`sync-status ${status}`}>
                    {status === 'success' && '‚úÖ ' + (message || 'Success')}
                    {status === 'error' && '‚ùå ' + (message || 'Error')}
                </div>
            );
        }

        // Loading Component
        function LoadingSpinner() {
            return (
                <div className="loading">
                    <div>Loading...</div>
                </div>
            );
        }

        // Data Context for global state management
        const DataContext = React.createContext();

        function DataProvider({ children }) {
            const [recipes, setRecipes] = useState([]);
            const [settings, setSettings] = useState(null);
            const [loading, setLoading] = useState(true);

            const loadAllData = useCallback(async () => {
                try {
                    setLoading(true);
                    const data = await dataService.loadData();
                    
                    const recipesData = Array.isArray(data.recipes) ? data.recipes : [];
                    const settingsData = data.settings || {
                        spirit_types: ['Gin', 'Vodka', 'Rum', 'Tequila', 'Whiskey', 'Brandy'],
                        glass_types: ['Coupe', 'Martini', 'Highball', 'Old Fashioned', 'Collins', 'Margarita'],
                        venues: ['Main Bar', 'Pool Bar', 'Restaurant', 'Private Event']
                    };
                    
                    setRecipes(recipesData);
                    setSettings(settingsData);
                } catch (error) {
                    console.error('‚ùå Error loading data:', error);
                    setRecipes([]);
                    setSettings({
                        spirit_types: ['Gin', 'Vodka', 'Rum', 'Tequila', 'Whiskey', 'Brandy'],
                        glass_types: ['Coupe', 'Martini', 'Highball', 'Old Fashioned', 'Collins', 'Margarita'],
                        venues: ['Main Bar', 'Pool Bar', 'Restaurant', 'Private Event']
                    });
                } finally {
                    setLoading(false);
                }
            }, []);

            const refreshData = useCallback(async () => {
                await loadAllData();
            }, [loadAllData]);

            useEffect(() => {
                loadAllData();
            }, [loadAllData]);

            const value = {
                recipes,
                settings,
                loading,
                refreshData,
                setRecipes,
                setSettings
            };

            return (
                <DataContext.Provider value={value}>
                    {children}
                </DataContext.Provider>
            );
        }

        function useData() {
            const context = React.useContext(DataContext);
            if (!context) {
                throw new Error('useData must be used within a DataProvider');
            }
            return context;
        }

        // Scale Control Component
        function ScaleControl({ ingredients, onScaleChange }) {
            const [scale, setScale] = useState(1);
            
            const handleScaleChange = (newScale) => {
                setScale(newScale);
                onScaleChange(newScale);
            };
            
            const resetScale = () => {
                handleScaleChange(1);
            };
            
            return (
                <div className="scale-control">
                    <div className="scale-header">
                        <div className="scale-title">Adjust Recipe Scale</div>
                        <button className="scale-reset" onClick={resetScale}>
                            Reset to 1x
                        </button>
                    </div>
                    
                    <input
                        type="range"
                        min="0.25"
                        max="4"
                        step="0.25"
                        value={scale}
                        onChange={(e) => handleScaleChange(parseFloat(e.target.value))}
                        className="scale-slider"
                    />
                    
                    <div className="scale-values">
                        <div className={`scale-value ${scale === 0.25 ? 'active' : ''}`}>0.25x</div>
                        <div className={`scale-value ${scale === 0.5 ? 'active' : ''}`}>0.5x</div>
                        <div className={`scale-value ${scale === 1 ? 'active' : ''}`}>1x</div>
                        <div className={`scale-value ${scale === 2 ? 'active' : ''}`}>2x</div>
                        <div className={`scale-value ${scale === 4 ? 'active' : ''}`}>4x</div>
                    </div>
                </div>
            );
        }

        // Hamburger Menu Component - Simplified for users
        function HamburgerMenu({ isOpen, onToggle, currentPage, onNavigate, isAdmin }) {
            const menuRef = useRef(null);
            
            useEffect(() => {
                const handleClickOutside = (event) => {
                    if (menuRef.current && !menuRef.current.contains(event.target) && 
                        !event.target.closest('.menu-button')) {
                        onToggle(false);
                    }
                };
                
                if (isOpen) {
                    document.addEventListener('mousedown', handleClickOutside);
                    document.addEventListener('touchstart', handleClickOutside);
                }
                
                return () => {
                    document.removeEventListener('mousedown', handleClickOutside);
                    document.removeEventListener('touchstart', handleClickOutside);
                };
            }, [isOpen, onToggle]);
            
            const handleNavigation = (page) => {
                onNavigate(page);
                onToggle(false);
            };
            
            return (
                <>
                    <div className={`side-menu-overlay ${isOpen ? 'active' : ''}`} />
                    <div ref={menuRef} className={`side-menu ${isOpen ? 'active' : ''}`}>
                        <div className="side-menu-header">
                            <div className="side-menu-logo">üç∏</div>
                            <div className="side-menu-title">Cocktail Manual</div>
                        </div>
                        
                        <nav className="side-menu-nav">
                            <button 
                                className={`side-menu-button ${currentPage === 'home' ? 'active' : ''}`}
                                onClick={() => handleNavigation('home')}
                            >
                                üìñ Cocktail Menu
                            </button>
                            
                            {isAdmin && (
                                <>
                                    <button 
                                        className={`side-menu-button ${currentPage === 'create-recipe' ? 'active' : ''}`}
                                        onClick={() => handleNavigation('create-recipe')}
                                    >
                                        ‚ûï Add Recipe
                                    </button>
                                    
                                    <button 
                                        className={`side-menu-button ${currentPage === 'settings' ? 'active' : ''}`}
                                        onClick={() => handleNavigation('settings')}
                                    >
                                        ‚öôÔ∏è Settings
                                    </button>
                                    
                                    <button 
                                        className={`side-menu-button ${currentPage === 'data-management' ? 'active' : ''}`}
                                        onClick={() => handleNavigation('data-management')}
                                    >
                                        üíæ Data Management
                                    </button>
                                    
                                    <button 
                                        className={`side-menu-button ${currentPage === 'user-access' ? 'active' : ''}`}
                                        onClick={() => handleNavigation('user-access')}
                                    >
                                        üë• Share with Users
                                    </button>
                                </>
                            )}
                        </nav>
                    </div>
                </>
            );
        }

        // Recipe Card Component
        function RecipeCard({ recipe, onClick }) {
            const imageStyle = {
                backgroundImage: recipe.image_url ? `url(${recipe.image_url})` : 'none',
                backgroundSize: 'cover',
                backgroundPosition: 'center'
            };
            
            return (
                <div className="recipe-card" onClick={() => onClick(recipe)}>
                    <div className="recipe-image" style={imageStyle}>
                        {!recipe.image_url && 'üç∏'}
                    </div>
                    <div className="recipe-info">
                        <div className="recipe-name">{recipe.name}</div>
                        <div className="recipe-spirit">{recipe.spirit_type}</div>
                    </div>
                </div>
            );
        }

        // View Recipe Component
        function ViewRecipePage({ recipe, onBack, isAdmin, onDeleteRecipe, onEditRecipe }) {
            const backgroundStyle = {
                backgroundImage: recipe.image_url ? `url(${recipe.image_url})` : 'none',
                backgroundSize: 'cover',
                backgroundPosition: 'center'
            };
            
            const [scaledIngredients, setScaledIngredients] = useState(recipe.ingredients);
            
            const handleScaleChange = (scale) => {
                const scaled = recipe.ingredients.map(ingredient => ({
                    ...ingredient,
                    scaledAmount: ingredient.amount * scale
                }));
                setScaledIngredients(scaled);
            };
            
            return (
                <div className="container">
                    <button className="button button-secondary" onClick={onBack}>
                        ‚Üê Back to Cocktails
                    </button>
                    
                    <div className="recipe-view">
                        {recipe.image_url && (
                            <div className="recipe-background" style={backgroundStyle}></div>
                        )}
                        
                        <div className="recipe-content">
                            <div className="recipe-header">
                                <div>
                                    <h1 className="recipe-title">{recipe.name}</h1>
                                    <div className="recipe-meta">
                                        <div className="meta-item">{recipe.spirit_type}</div>
                                        <div className="meta-item">{recipe.glass_type} Glass</div>
                                        <div className="meta-item">{recipe.abv}% ABV</div>
                                        <div className="meta-item">${recipe.pour_cost} Cost</div>
                                        <div className="meta-item">{recipe.venue}</div>
                                    </div>
                                </div>
                            </div>
                            
                            {/* Scale Control - Available to all users */}
                            <ScaleControl 
                                ingredients={recipe.ingredients} 
                                onScaleChange={handleScaleChange}
                            />
                            
                            <div className="recipe-details">
                                <div>
                                    <h3 style={{color: '#FFB366', marginBottom: '1rem'}}>Ingredients</h3>
                                    <ul className="ingredients-list">
                                        {scaledIngredients.map((ingredient, index) => (
                                            <li key={index} className="ingredient-item">
                                                <span>{ingredient.name}</span>
                                                <span>
                                                    {ingredient.scaledAmount || ingredient.amount} {ingredient.unit}
                                                    {ingredient.scaledAmount && ingredient.scaledAmount !== ingredient.amount && (
                                                        <span style={{color: '#FFB366', fontSize: '0.8rem', marginLeft: '0.5rem'}}>
                                                            ({ingredient.amount} {ingredient.unit})
                                                        </span>
                                                    )}
                                                </span>
                                            </li>
                                        ))}
                                    </ul>
                                </div>
                                
                                <div>
                                    <h3 style={{color: '#FFB366', marginBottom: '1rem'}}>Instructions</h3>
                                    <div className="instructions">{recipe.instructions}</div>
                                    
                                    {recipe.notes && (
                                        <>
                                            <h3 style={{color: '#FFB366', marginBottom: '1rem', marginTop: '1.5rem'}}>Notes</h3>
                                            <div className="instructions">{recipe.notes}</div>
                                        </>
                                    )}
                                    
                                    {/* Action buttons - Only for admin */}
                                    {isAdmin && (
                                        <div className="action-buttons">
                                            <button 
                                                className="action-button edit"
                                                onClick={() => onEditRecipe(recipe)}
                                            >
                                                ‚úèÔ∏è Edit
                                            </button>
                                            <button 
                                                className="action-button delete"
                                                onClick={() => onDeleteRecipe(recipe.id)}
                                            >
                                                üóëÔ∏è Delete
                                            </button>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Home Page Component - Works for both admin and users
        function HomePage({ onRecipeClick, isAdmin, onCreateRecipe, onSyncStatus }) {
            const { recipes, settings, loading } = useData();
            const [searchTerm, setSearchTerm] = useState('');
            const [filterSpirit, setFilterSpirit] = useState('All');
            const [filterVenue, setFilterVenue] = useState('All');
            
            // Filter recipes based on search and filters
            const filteredRecipes = recipes.filter(recipe => {
                const matchesSearch = recipe.name.toLowerCase().includes(searchTerm.toLowerCase());
                const matchesSpirit = filterSpirit === 'All' || recipe.spirit_type === filterSpirit;
                const matchesVenue = filterVenue === 'All' || recipe.venue === filterVenue;
                
                return matchesSearch && matchesSpirit && matchesVenue;
            });
            
            // Group recipes by first letter
            const groupedRecipes = filteredRecipes.reduce((groups, recipe) => {
                const firstLetter = recipe.name.charAt(0).toUpperCase();
                if (!groups[firstLetter]) groups[firstLetter] = [];
                groups[firstLetter].push(recipe);
                return groups;
            }, {});
            
            // Sort the groups alphabetically
            const sortedLetters = Object.keys(groupedRecipes).sort();
            
            if (loading) {
                return <LoadingSpinner />;
            }

            return (
                <div className="container">
                    <div className="page-header">
                        <h1 className="page-title">Cocktail Menu</h1>
                        {isAdmin && !isUserAccess() && (
                            <button className="button" onClick={onCreateRecipe}>
                                + Add Recipe
                            </button>
                        )}
                        {isUserAccess() && (
                            <span style={{color: '#FFB366', fontSize: '0.9rem'}}>üì± Shared View</span>
                        )}
                    </div>
                    
                    {isUserAccess() && (
                        <div style={{
                            background: '#1A1A1A',
                            padding: '1rem',
                            borderRadius: '8px',
                            marginBottom: '1rem',
                            border: '1px solid #333',
                            textAlign: 'center'
                        }}>
                            <p style={{color: '#FFB366', margin: 0}}>
                                üìã <strong>Read-Only Mode</strong> - Viewing shared cocktail recipes
                            </p>
                        </div>
                    )}
                    
                    <div className="search-section">
                        <input 
                            type="text"
                            className="search-box"
                            placeholder="Search cocktails..."
                            value={searchTerm}
                            onChange={(e) => setSearchTerm(e.target.value)}
                        />
                        
                        <div className="filters">
                            <select 
                                className="filter-select"
                                value={filterSpirit}
                                onChange={(e) => setFilterSpirit(e.target.value)}
                            >
                                <option value="All">All Spirits</option>
                                {settings?.spirit_types?.map(spirit => (
                                    <option key={spirit} value={spirit}>{spirit}</option>
                                ))}
                            </select>
                            
                            <select 
                                className="filter-select"
                                value={filterVenue}
                                onChange={(e) => setFilterVenue(e.target.value)}
                            >
                                <option value="All">All Venues</option>
                                {settings?.venues?.map(venue => (
                                    <option key={venue} value={venue}>{venue}</option>
                                ))}
                            </select>
                        </div>
                    </div>
                    
                    {filteredRecipes.length === 0 ? (
                        <div className="loading">
                            {recipes.length === 0 ? (
                                <div>
                                    <p>No cocktails available.</p>
                                    {isAdmin && !isUserAccess() && (
                                        <p style={{marginTop: '1rem'}}>
                                            <button className="button" onClick={onCreateRecipe}>
                                                + Add Your First Recipe
                                            </button>
                                        </p>
                                    )}
                                </div>
                            ) : (
                                'No cocktails found matching your criteria.'
                            )}
                        </div>
                    ) : (
                        <>
                            <div style={{marginBottom: '1rem', color: '#888', fontSize: '0.9rem'}}>
                                Showing {filteredRecipes.length} of {recipes.length} cocktails
                                {!isAdmin && ' (Read-Only)'}
                            </div>
                            {sortedLetters.map(letter => (
                                <div key={letter} className="alphabet-section">
                                    <h2 className="letter-header">{letter}</h2>
                                    <div className="recipes-grid">
                                        {groupedRecipes[letter].map(recipe => (
                                            <RecipeCard 
                                                key={recipe.id}
                                                recipe={recipe}
                                                onClick={onRecipeClick}
                                            />
                                        ))}
                                    </div>
                                </div>
                            ))}
                        </>
                    )}
                </div>
            );
        }

        // Create/Edit Recipe Component - Admin only
        function CreateEditRecipePage({ recipe, onBack, isEdit = false, onSyncStatus }) {
            const { refreshData } = useData();
            const [formData, setFormData] = useState(
                recipe || {
                    name: '',
                    spirit_type: '',
                    venue: '',
                    glass_type: '',
                    abv: '',
                    pour_cost: '',
                    image_url: '',
                    ingredients: [{ name: '', amount: '', unit: 'ml' }],
                    instructions: '',
                    notes: ''
                }
            );
            
            const [imagePreview, setImagePreview] = useState(recipe?.image_url || '');
            const [settings, setSettings] = useState(null);
            const [loading, setLoading] = useState(false);
            
            useEffect(() => {
                const loadSettings = async () => {
                    const settingsData = await getSettings();
                    setSettings(settingsData);
                };
                loadSettings();
            }, []);
            
            const handleInputChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({ ...prev, [name]: value }));
            };
            
            const handleIngredientChange = (index, field, value) => {
                const updatedIngredients = [...formData.ingredients];
                updatedIngredients[index][field] = value;
                setFormData(prev => ({ ...prev, ingredients: updatedIngredients }));
            };
            
            const addIngredient = () => {
                setFormData(prev => ({
                    ...prev,
                    ingredients: [...prev.ingredients, { name: '', amount: '', unit: 'ml' }]
                }));
            };
            
            const removeIngredient = (index) => {
                if (formData.ingredients.length > 1) {
                    const updatedIngredients = [...formData.ingredients];
                    updatedIngredients.splice(index, 1);
                    setFormData(prev => ({ ...prev, ingredients: updatedIngredients }));
                }
            };
            
            const handleImageUpload = async (e) => {
                const file = e.target.files[0];
                if (file) {
                    try {
                        const base64 = await convertImageToBase64(file);
                        setFormData(prev => ({ ...prev, image_url: base64 }));
                        setImagePreview(base64);
                    } catch (error) {
                        console.error('Error uploading image:', error);
                        alert('Error uploading image. Please try again.');
                    }
                }
            };
            
            const handleSubmit = async (e) => {
                e.preventDefault();
                
                if (!formData.name) {
                    alert('Please at least enter a cocktail name');
                    return;
                }
                
                setLoading(true);
                onSyncStatus('syncing', 'Saving recipe...');
                
                try {
                    const recipeData = {
                        ...formData,
                        abv: parseFloat(formData.abv) || 0,
                        pour_cost: parseFloat(formData.pour_cost) || 0
                    };
                    
                    const result = await saveRecipe(recipeData, isEdit);
                    
                    await refreshData();
                    
                    if (result.success) {
                        onSyncStatus('success', 'Recipe saved successfully');
                        setTimeout(() => onBack(), 1000);
                    } else {
                        onSyncStatus('error', 'Failed to save recipe');
                        alert('Error saving recipe. Please try again.');
                    }
                } catch (error) {
                    console.error('Error saving recipe:', error);
                    onSyncStatus('error', 'Failed to save recipe');
                    alert('Error saving recipe. Please try again.');
                } finally {
                    setLoading(false);
                }
            };
            
            if (!settings) return <LoadingSpinner />;
            
            return (
                <div className="container">
                    <button className="button button-secondary" onClick={onBack}>
                        ‚Üê Back to Cocktails
                    </button>
                    
                    <h1 className="page-title">{isEdit ? 'Edit Cocktail' : 'Add New Cocktail'}</h1>
                    
                    <form className="form" onSubmit={handleSubmit}>
                        {/* Form content remains the same as before */}
                        <div className="form-group">
                            <label className="form-label">Cocktail Name *</label>
                            <input
                                type="text"
                                className="form-input"
                                name="name"
                                value={formData.name}
                                onChange={handleInputChange}
                                required
                            />
                        </div>
                        
                        <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem'}}>
                            <div className="form-group">
                                <label className="form-label">Spirit Type</label>
                                <select
                                    className="form-input"
                                    name="spirit_type"
                                    value={formData.spirit_type}
                                    onChange={handleInputChange}
                                >
                                    <option value="">Select Spirit</option>
                                    {settings.spirit_types.map(spirit => (
                                        <option key={spirit} value={spirit}>{spirit}</option>
                                    ))}
                                </select>
                            </div>
                            
                            <div className="form-group">
                                <label className="form-label">Venue</label>
                                <select
                                    className="form-input"
                                    name="venue"
                                    value={formData.venue}
                                    onChange={handleInputChange}
                                >
                                    <option value="">Select Venue</option>
                                    {settings.venues.map(venue => (
                                        <option key={venue} value={venue}>{venue}</option>
                                    ))}
                                </select>
                            </div>
                        </div>
                        
                        <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem'}}>
                            <div className="form-group">
                                <label className="form-label">Glass Type</label>
                                <select
                                    className="form-input"
                                    name="glass_type"
                                    value={formData.glass_type}
                                    onChange={handleInputChange}
                                >
                                    <option value="">Select Glass</option>
                                    {settings.glass_types.map(glass => (
                                        <option key={glass} value={glass}>{glass}</option>
                                    ))}
                                </select>
                            </div>
                            
                            <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem'}}>
                                <div className="form-group">
                                    <label className="form-label">ABV (%)</label>
                                    <input
                                        type="number"
                                        step="0.1"
                                        className="form-input"
                                        name="abv"
                                        value={formData.abv}
                                        onChange={handleInputChange}
                                    />
                                </div>
                                
                                <div className="form-group">
                                    <label className="form-label">Pour Cost ($)</label>
                                    <input
                                        type="number"
                                        step="0.01"
                                        className="form-input"
                                        name="pour_cost"
                                        value={formData.pour_cost}
                                        onChange={handleInputChange}
                                    />
                                </div>
                            </div>
                        </div>
                        
                        <div className="form-group">
                            <label className="form-label">Cocktail Image</label>
                            <div className="image-upload">
                                <input
                                    type="file"
                                    accept="image/*"
                                    onChange={handleImageUpload}
                                    style={{display: 'none'}}
                                    id="image-upload"
                                />
                                <label htmlFor="image-upload" style={{cursor: 'pointer'}}>
                                    {imagePreview ? 'Change Image' : 'Upload Image'}
                                </label>
                                {imagePreview && (
                                    <img src={imagePreview} alt="Preview" className="image-preview" />
                                )}
                            </div>
                        </div>
                        
                        <div className="form-group">
                            <label className="form-label">Ingredients</label>
                            {formData.ingredients.map((ingredient, index) => (
                                <div key={index} style={{display: 'flex', gap: '0.5rem', marginBottom: '0.5rem', alignItems: 'center'}}>
                                    <input
                                        type="text"
                                        className="form-input"
                                        placeholder="Ingredient name"
                                        value={ingredient.name}
                                        onChange={(e) => handleIngredientChange(index, 'name', e.target.value)}
                                        style={{flex: 2}}
                                    />
                                    <input
                                        type="number"
                                        step="0.1"
                                        className="form-input"
                                        placeholder="Amount"
                                        value={ingredient.amount}
                                        onChange={(e) => handleIngredientChange(index, 'amount', e.target.value)}
                                        style={{flex: 1}}
                                    />
                                    <select
                                        className="form-input"
                                        value={ingredient.unit}
                                        onChange={(e) => handleIngredientChange(index, 'unit', e.target.value)}
                                        style={{flex: 1}}
                                    >
                                        <option value="ml">ml</option>
                                        <option value="oz">oz</option>
                                        <option value="dash">dash</option>
                                        <option value="piece">piece</option>
                                        <option value="slice">slice</option>
                                        <option value="sprig">sprig</option>
                                    </select>
                                    {formData.ingredients.length > 1 && (
                                        <button
                                            type="button"
                                            className="icon-button delete"
                                            onClick={() => removeIngredient(index)}
                                        >
                                            √ó
                                        </button>
                                    )}
                                </div>
                            ))}
                            <button type="button" className="button button-secondary" onClick={addIngredient}>
                                + Add Ingredient
                            </button>
                        </div>
                        
                        <div className="form-group">
                            <label className="form-label">Instructions</label>
                            <textarea
                                className="form-textarea"
                                name="instructions"
                                value={formData.instructions}
                                onChange={handleInputChange}
                            />
                        </div>
                        
                        <div className="form-group">
                            <label className="form-label">Notes</label>
                            <textarea
                                className="form-textarea"
                                name="notes"
                                value={formData.notes}
                                onChange={handleInputChange}
                            />
                        </div>
                        
                        <div className="buttons-row">
                            <button type="submit" className="button" disabled={loading}>
                                {loading ? 'Saving...' : (isEdit ? 'Update Cocktail' : 'Save Cocktail')}
                            </button>
                            <button type="button" className="button button-secondary" onClick={onBack}>
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>
            );
        }

        // Settings Page Component - Admin only
        function SettingsPage({ onBack, isAdmin, onSyncStatus }) {
            const { settings, refreshData } = useData();
            const [newItems, setNewItems] = useState({
                spirit_types: '',
                glass_types: '',
                venues: ''
            });
            const [loading, setLoading] = useState(false);
            
            const handleKeyPress = (e, type) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    handleAddItem(type);
                }
            };
            
            const handleAddItem = async (type) => {
                const value = newItems[type].trim();
                if (!value) {
                    alert('Please enter a value');
                    return;
                }
                
                if (settings[type].includes(value)) {
                    alert('This item already exists');
                    return;
                }
                
                const updatedSettings = {
                    ...settings,
                    [type]: [...settings[type], value]
                };
                
                setLoading(true);
                onSyncStatus('syncing', 'Saving settings...');
                try {
                    const result = await saveSettings(updatedSettings);
                    setNewItems(prev => ({
                        ...prev,
                        [type]: ''
                    }));
                    
                    await refreshData();
                    
                    if (result.success) {
                        onSyncStatus('success', 'Settings saved successfully');
                    } else {
                        onSyncStatus('error', 'Failed to save settings');
                    }
                } catch (error) {
                    console.error('Error saving settings:', error);
                    onSyncStatus('error', 'Failed to save settings');
                    alert('Error saving settings. Please try again.');
                } finally {
                    setLoading(false);
                }
            };
            
            const handleRemoveItem = async (type, index) => {
                const updatedSettings = {
                    ...settings,
                    [type]: settings[type].filter((_, i) => i !== index)
                };
                
                setLoading(true);
                onSyncStatus('syncing', 'Saving settings...');
                try {
                    const result = await saveSettings(updatedSettings);
                    
                    await refreshData();
                    
                    if (result.success) {
                        onSyncStatus('success', 'Settings saved successfully');
                    } else {
                        onSyncStatus('error', 'Failed to save settings');
                    }
                } catch (error) {
                    console.error('Error saving settings:', error);
                    onSyncStatus('error', 'Failed to save settings');
                    alert('Error saving settings. Please try again.');
                } finally {
                    setLoading(false);
                }
            };
            
            const handleInputChange = (type, value) => {
                setNewItems(prev => ({
                    ...prev,
                    [type]: value
                }));
            };
            
            if (!settings) return <LoadingSpinner />;
            
            return (
                <div className="container">
                    <button className="button button-secondary" onClick={onBack}>
                        ‚Üê Back to Cocktails
                    </button>
                    
                    <h1 className="page-title">Settings</h1>
                    
                    {!isAdmin ? (
                        <div className="settings-section">
                            <p>Admin access required to modify settings.</p>
                        </div>
                    ) : (
                        <>
                            <div className="settings-section">
                                <h3 className="settings-title">Spirit Types</h3>
                                <div style={{display: 'flex', gap: '0.5rem', marginBottom: '1rem'}}>
                                    <input
                                        type="text"
                                        className="form-input"
                                        placeholder="Add new spirit type"
                                        value={newItems.spirit_types}
                                        onChange={(e) => handleInputChange('spirit_types', e.target.value)}
                                        onKeyPress={(e) => handleKeyPress(e, 'spirit_types')}
                                        style={{flex: 1}}
                                    />
                                    <button 
                                        className="button" 
                                        onClick={() => handleAddItem('spirit_types')}
                                        disabled={loading}
                                    >
                                        Add
                                    </button>
                                </div>
                                <ul className="settings-list">
                                    {settings.spirit_types.map((item, index) => (
                                        <li key={index} className="settings-item">
                                            <span>{item}</span>
                                            <div className="settings-actions">
                                                <button 
                                                    className="icon-button delete"
                                                    onClick={() => handleRemoveItem('spirit_types', index)}
                                                    disabled={loading}
                                                >
                                                    √ó
                                                </button>
                                            </div>
                                        </li>
                                    ))}
                                </ul>
                            </div>
                            
                            <div className="settings-section">
                                <h3 className="settings-title">Glass Types</h3>
                                <div style={{display: 'flex', gap: '0.5rem', marginBottom: '1rem'}}>
                                    <input
                                        type="text"
                                        className="form-input"
                                        placeholder="Add new glass type"
                                        value={newItems.glass_types}
                                        onChange={(e) => handleInputChange('glass_types', e.target.value)}
                                        onKeyPress={(e) => handleKeyPress(e, 'glass_types')}
                                        style={{flex: 1}}
                                    />
                                    <button 
                                        className="button" 
                                        onClick={() => handleAddItem('glass_types')}
                                        disabled={loading}
                                    >
                                        Add
                                    </button>
                                </div>
                                <ul className="settings-list">
                                    {settings.glass_types.map((item, index) => (
                                        <li key={index} className="settings-item">
                                            <span>{item}</span>
                                            <div className="settings-actions">
                                                <button 
                                                    className="icon-button delete"
                                                    onClick={() => handleRemoveItem('glass_types', index)}
                                                    disabled={loading}
                                                >
                                                    √ó
                                                </button>
                                            </div>
                                        </li>
                                    ))}
                                </ul>
                            </div>
                            
                            <div className="settings-section">
                                <h3 className="settings-title">Venues</h3>
                                <div style={{display: 'flex', gap: '0.5rem', marginBottom: '1rem'}}>
                                    <input
                                        type="text"
                                        className="form-input"
                                        placeholder="Add new venue"
                                        value={newItems.venues}
                                        onChange={(e) => handleInputChange('venues', e.target.value)}
                                        onKeyPress={(e) => handleKeyPress(e, 'venues')}
                                        style={{flex: 1}}
                                    />
                                    <button 
                                        className="button" 
                                        onClick={() => handleAddItem('venues')}
                                        disabled={loading}
                                    >
                                        Add
                                    </button>
                                </div>
                                <ul className="settings-list">
                                    {settings.venues.map((item, index) => (
                                        <li key={index} className="settings-item">
                                            <span>{item}</span>
                                            <div className="settings-actions">
                                                <button 
                                                    className="icon-button delete"
                                                    onClick={() => handleRemoveItem('venues', index)}
                                                    disabled={loading}
                                                >
                                                    √ó
                                                </button>
                                            </div>
                                        </li>
                                    ))}
                                </ul>
                            </div>
                        </>
                    )}
                </div>
            );
        }

        // Login Page Component
        function LoginPage({ onLogin, onGuestLogin }) {
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            
            // If accessing via shared URL, automatically redirect to user access
            useEffect(() => {
                if (isUserAccess()) {
                    onGuestLogin();
                }
            }, [onGuestLogin]);
            
            const handleSubmit = (e) => {
                e.preventDefault();
                if (onLogin(username, password)) {
                    setError('');
                } else {
                    setError('Invalid credentials');
                }
            };
            
            return (
                <div className="container">
                    <div className="form" style={{maxWidth: '400px', marginTop: '4rem'}}>
                        <h1 className="page-title" style={{textAlign: 'center'}}>Cocktail Manual</h1>
                        
                        <form onSubmit={handleSubmit}>
                            <div className="form-group">
                                <label className="form-label">Username</label>
                                <input 
                                    type="text"
                                    className="form-input"
                                    value={username}
                                    onChange={(e) => setUsername(e.target.value)}
                                    required
                                />
                            </div>
                            
                            <div className="form-group">
                                <label className="form-label">Password</label>
                                <input 
                                    type="password"
                                    className="form-input"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    required
                                />
                            </div>
                            
                            {error && (
                                <div style={{color: '#ff6b6b', marginBottom: '1rem', textAlign: 'center'}}>
                                    {error}
                                </div>
                            )}
                            
                            <div className="buttons-row">
                                <button type="submit" className="button">
                                    Admin Login
                                </button>
                                <button 
                                    type="button" 
                                    className="button button-secondary"
                                    onClick={onGuestLogin}
                                >
                                    Continue as Guest
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

        // Main App Component
        function App() {
            const { user, loading: authLoading, login, loginAsGuest, logout } = useAuth();
            const [currentPage, setCurrentPage] = useState('home');
            const [selectedRecipe, setSelectedRecipe] = useState(null);
            const [menuOpen, setMenuOpen] = useState(false);
            const [editingItem, setEditingItem] = useState(null);
            const [isEditing, setIsEditing] = useState(false);
            const [syncStatus, setSyncStatus] = useState({ status: null, message: '' });
            
            // Clear sync status after 3 seconds
            useEffect(() => {
                if (syncStatus.status) {
                    const timer = setTimeout(() => {
                        setSyncStatus({ status: null, message: '' });
                    }, 3000);
                    return () => clearTimeout(timer);
                }
            }, [syncStatus]);
            
            const navigateTo = (page, item = null) => {
                // Users can only access home and view-recipe pages
                if (!user?.isAdmin && (page === 'create-recipe' || page === 'settings' || page === 'data-management' || page === 'user-access')) {
                    return;
                }
                setCurrentPage(page);
                if (page === 'view-recipe') setSelectedRecipe(item);
                setMenuOpen(false);
            };
            
            const handleDeleteRecipe = async (recipeId) => {
                if (!user || !user.isAdmin) return;
                
                if (confirm('Are you sure you want to delete this cocktail?')) {
                    setSyncStatus({ status: 'syncing', message: 'Deleting recipe...' });
                    try {
                        const result = await deleteRecipe(recipeId);
                        
                        if (result.success) {
                            setSyncStatus({ status: 'success', message: 'Recipe deleted successfully' });
                        } else {
                            setSyncStatus({ status: 'error', message: 'Failed to delete recipe' });
                        }
                        
                        if (currentPage === 'view-recipe' && selectedRecipe?.id === recipeId) {
                            navigateTo('home');
                        }
                    } catch (error) {
                        console.error('Error deleting recipe:', error);
                        setSyncStatus({ status: 'error', message: 'Failed to delete recipe' });
                        alert('Error deleting recipe. Please try again.');
                    }
                }
            };
            
            const handleEditRecipe = (recipe) => {
                setEditingItem(recipe);
                setIsEditing(true);
                setCurrentPage('create-recipe');
            };
            
            const handleSyncStatus = (status, message = '') => {
                setSyncStatus({ status, message });
            };
            
            const renderPage = () => {
                if (authLoading) {
                    return <LoadingSpinner />;
                }
                
                if (!user) {
                    return <LoginPage onLogin={login} onGuestLogin={loginAsGuest} />;
                }
                
                switch(currentPage) {
                    case 'home':
                        return <HomePage 
                            onRecipeClick={(recipe) => navigateTo('view-recipe', recipe)}
                            isAdmin={user.isAdmin}
                            onCreateRecipe={() => {
                                setIsEditing(false);
                                setEditingItem(null);
                                navigateTo('create-recipe');
                            }}
                            onSyncStatus={handleSyncStatus}
                        />;
                    case 'view-recipe':
                        return <ViewRecipePage 
                            recipe={selectedRecipe} 
                            onBack={() => navigateTo('home')}
                            isAdmin={user.isAdmin}
                            onDeleteRecipe={handleDeleteRecipe}
                            onEditRecipe={handleEditRecipe}
                        />;
                    case 'create-recipe':
                        return <CreateEditRecipePage 
                            recipe={editingItem}
                            onBack={() => navigateTo('home')} 
                            isEdit={isEditing}
                            onSyncStatus={handleSyncStatus}
                        />;
                    case 'settings':
                        return <SettingsPage 
                            onBack={() => navigateTo('home')} 
                            isAdmin={user.isAdmin}
                            onSyncStatus={handleSyncStatus}
                        />;
                    case 'data-management':
                        return <DataManagement onSyncStatus={handleSyncStatus} />;
                    case 'user-access':
                        return <UserAccess onSyncStatus={handleSyncStatus} />;
                    default:
                        return <HomePage 
                            onRecipeClick={(recipe) => navigateTo('view-recipe', recipe)}
                            isAdmin={user.isAdmin}
                            onCreateRecipe={() => navigateTo('create-recipe')}
                            onSyncStatus={handleSyncStatus}
                        />;
                }
            };
            
            if (authLoading) {
                return <LoadingSpinner />;
            }
            
            if (!user) {
                return <LoginPage onLogin={login} onGuestLogin={loginAsGuest} />;
            }
            
            return (
                <DataProvider>
                    <div className="app">
                        <header className="header">
                            <div className="header-left">
                                <button 
                                    className={`menu-button ${menuOpen ? 'active' : ''}`}
                                    onClick={() => setMenuOpen(!menuOpen)}
                                    aria-label="Toggle menu"
                                >
                                    <span className="menu-line"></span>
                                    <span className="menu-line"></span>
                                    <span className="menu-line"></span>
                                </button>
                            </div>
                            
                            <div className="nav-user">
                                üë§ {user.username}
                                {user.isAdmin && <span style={{color: '#FFB366', fontSize: '0.7rem'}}> (Admin)</span>}
                                {!user.isAdmin && <span style={{color: '#666', fontSize: '0.7rem'}}> (User)</span>}
                                <button className="logout-btn" onClick={logout}>
                                    Logout
                                </button>
                            </div>
                        </header>
                        
                        <SyncStatus 
                            status={syncStatus.status} 
                            message={syncStatus.message} 
                        />
                        
                        <HamburgerMenu 
                            isOpen={menuOpen}
                            onToggle={setMenuOpen}
                            currentPage={currentPage}
                            onNavigate={navigateTo}
                            isAdmin={user.isAdmin}
                        />
                        
                        <main>
                            {renderPage()}
                        </main>

                        <footer className="footer">
                            <p>
                                Cocktail Manual ¬© {new Date().getFullYear()} | Created by{' '}
                                <a href="https://www.instagram.com/suraj.gg87/" target="_blank" rel="noopener noreferrer">
                                    @suraj.gg87
                                </a>
                            </p>
                        </footer>
                    </div>
                </DataProvider>
            );
        }

        // Render the app
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
