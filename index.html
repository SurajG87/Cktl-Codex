<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cocktail Manual</title>
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üç∏</text></svg>">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üç∏</text></svg>">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Cocktail Manual">
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        /* Reset and base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #0A0A0A;
            color: #FFFFFF;
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        .app {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: #1A1A1A;
            border-bottom: 1px solid #333;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .menu-button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 0.5rem;
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        
        .menu-line {
            width: 20px;
            height: 2px;
            background: white;
            transition: all 0.3s ease;
        }
        
        .menu-button.active .menu-line:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }
        
        .menu-button.active .menu-line:nth-child(2) {
            opacity: 0;
        }
        
        .menu-button.active .menu-line:nth-child(3) {
            transform: rotate(-45deg) translate(7px, -6px);
        }
        
        .nav-user {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 0.9rem;
        }
        
        .logout-btn {
            background: #333;
            color: white;
            border: 1px solid #555;
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .logout-btn:hover {
            background: #444;
        }
        
        /* Side Menu */
        .side-menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 998;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .side-menu-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .side-menu {
            position: fixed;
            top: 0;
            left: -280px;
            width: 280px;
            height: 100%;
            background: #1A1A1A;
            z-index: 999;
            transition: left 0.3s ease;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #333;
        }
        
        .side-menu.active {
            left: 0;
        }
        
        .side-menu-header {
            padding: 2rem 1rem 1rem;
            border-bottom: 1px solid #333;
            text-align: center;
        }
        
        .side-menu-logo {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        .side-menu-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #FFB366;
        }
        
        .side-menu-nav {
            flex: 1;
            padding: 1rem 0;
        }
        
        .side-menu-button {
            width: 100%;
            padding: 1rem;
            background: none;
            border: none;
            color: white;
            text-align: left;
            cursor: pointer;
            border-bottom: 1px solid #333;
            transition: background 0.3s ease;
        }
        
        .side-menu-button:hover {
            background: #252525;
        }
        
        .side-menu-button.active {
            background: #252525;
            color: #FFB366;
            border-left: 3px solid #FFB366;
        }
        
        .side-menu-button.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Main Content */
        main {
            flex: 1;
            padding-bottom: 2rem;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }
        
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        
        .page-title {
            font-size: 2rem;
            color: #FFB366;
            margin: 0;
        }
        
        /* Buttons */
        .button {
            background: #FFB366;
            color: #0A0A0A;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .button:hover {
            background: #FFA366;
            transform: translateY(-1px);
        }
        
        .button-secondary {
            background: #333;
            color: white;
        }
        
        .button-secondary:hover {
            background: #444;
        }
        
        /* Recipe Grid */
        .recipes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .recipe-card {
            background: #1A1A1A;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid #333;
        }
        
        .recipe-card:hover {
            transform: translateY(-2px);
            border-color: #FFB366;
        }
        
        .recipe-image {
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            background: #252525;
        }
        
        .recipe-info {
            padding: 1rem;
        }
        
        .recipe-name {
            font-weight: bold;
            margin-bottom: 0.25rem;
        }
        
        .recipe-spirit {
            font-size: 0.8rem;
            color: #888;
        }
        
        /* Search and Filters */
        .search-section {
            margin-bottom: 2rem;
        }
        
        .search-box {
            width: 100%;
            padding: 0.75rem;
            background: #1A1A1A;
            border: 1px solid #333;
            border-radius: 6px;
            color: white;
            margin-bottom: 1rem;
        }
        
        .filters {
            display: flex;
            gap: 1rem;
        }
        
        .filter-select {
            flex: 1;
            padding: 0.75rem;
            background: #1A1A1A;
            border: 1px solid #333;
            border-radius: 6px;
            color: white;
        }
        
        /* Alphabet Sections */
        .alphabet-section {
            margin-bottom: 2rem;
        }
        
        .letter-header {
            color: #FFB366;
            font-size: 1.5rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #333;
        }
        
        /* Recipe View */
        .recipe-view {
            position: relative;
            background: #1A1A1A;
            border-radius: 12px;
            overflow: hidden;
            margin-top: 1rem;
        }
        
        .recipe-background {
            height: 200px;
            position: relative;
        }
        
        .recipe-background::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 100px;
            background: linear-gradient(transparent, #1A1A1A);
        }
        
        .recipe-content {
            position: relative;
            padding: 2rem;
            margin-top: -50px;
        }
        
        .recipe-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 2rem;
        }
        
        .recipe-title {
            font-size: 2.5rem;
            color: #FFB366;
            margin-bottom: 1rem;
        }
        
        .recipe-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .meta-item {
            background: #252525;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        .recipe-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }
        
        .ingredients-list {
            list-style: none;
        }
        
        .ingredient-item {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid #333;
        }
        
        .instructions {
            background: #252525;
            padding: 1.5rem;
            border-radius: 8px;
            white-space: pre-line;
            line-height: 1.8;
        }
        
        .action-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }
        
        .action-button {
            flex: 1;
            padding: 1rem;
            background: #252525;
            border: 1px solid #333;
            border-radius: 6px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .action-button:hover {
            border-color: #FFB366;
            color: #FFB366;
        }
        
        /* Forms */
        .form {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: #FFB366;
            font-weight: bold;
        }
        
        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 0.75rem;
            background: #1A1A1A;
            border: 1px solid #333;
            border-radius: 6px;
            color: white;
            font-size: 1rem;
        }
        
        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: #FFB366;
        }
        
        .buttons-row {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }
        
        .icon-button {
            background: #333;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .icon-button.delete {
            background: #f44336;
        }
        
        .image-upload {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .image-preview {
            max-width: 200px;
            max-height: 200px;
            border-radius: 8px;
        }
        
        /* Login Page */
        .login-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 1rem;
            background: linear-gradient(135deg, #0A0A0A 0%, #1A1A1A 100%);
        }
        
        .login-box {
            background: #1A1A1A;
            padding: 2rem;
            border-radius: 12px;
            border: 1px solid #333;
            width: 100%;
            max-width: 400px;
            text-align: center;
        }
        
        .login-logo {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        .login-title {
            color: #FFB366;
            margin-bottom: 2rem;
            font-size: 1.5rem;
        }
        
        .login-input {
            width: 100%;
            padding: 1rem;
            margin-bottom: 1rem;
            background: #252525;
            border: 1px solid #333;
            border-radius: 6px;
            color: white;
        }
        
        .login-button {
            width: 100%;
            padding: 1rem;
            background: #FFB366;
            color: #0A0A0A;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 1rem;
            transition: background 0.3s ease;
        }
        
        .login-button:hover {
            background: #FFA366;
        }
        
        .guest-button {
            width: 100%;
            padding: 0.75rem;
            background: #333;
            color: white;
            border: 1px solid #555;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        .guest-button:hover {
            background: #444;
        }
        
        /* Footer */
        .footer {
            text-align: center;
            padding: 2rem 1rem;
            background: #1A1A1A;
            border-top: 1px solid #333;
            color: #888;
            font-size: 0.9rem;
        }
        
        .footer a {
            color: #FFB366;
            text-decoration: none;
        }
        
        .footer a:hover {
            text-decoration: underline;
        }
        
        /* Loading and Empty States */
        .loading {
            text-align: center;
            padding: 3rem;
            color: #888;
            font-size: 1.1rem;
        }
        
        /* Sync Status */
        .sync-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
            color: #888;
            margin-top: 0.5rem;
            padding: 0.5rem;
            border-radius: 4px;
            background: #1A1A1A;
        }
        
        .sync-status.syncing {
            color: #FFB366;
            background: #2A2A2A;
        }
        
        .sync-status.success {
            color: #4CAF50;
            background: #1A2A1A;
        }
        
        .sync-status.error {
            color: #f44336;
            background: #2A1A1A;
        }
        
        .sync-button {
            background: #333;
            color: white;
            border: 1px solid #555;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            margin-left: auto;
        }
        
        .sync-button:hover {
            background: #444;
        }
        
        .demo-notice {
            background: #FFB366;
            color: #0A0A0A;
            padding: 0.75rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            text-align: center;
            font-weight: bold;
        }

        /* Scale Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
        }
        
        .modal-content {
            background: #1A1A1A;
            border-radius: 12px;
            padding: 2rem;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid #333;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .modal-title {
            color: #FFB366;
            font-size: 1.5rem;
        }
        
        .close-button {
            background: none;
            border: none;
            color: #888;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.25rem;
        }
        
        .close-button:hover {
            color: white;
        }
        
        .scale-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .scale-option {
            background: #252525;
            border: 1px solid #333;
            border-radius: 6px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .scale-option:hover {
            border-color: #FFB366;
            color: #FFB366;
        }
        
        .scale-option.active {
            border-color: #FFB366;
            background: #2A2A2A;
            color: #FFB366;
        }
        
        .scale-factor {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 0.25rem;
        }
        
        .scale-label {
            font-size: 0.8rem;
            color: #888;
        }
        
        .scaled-ingredients {
            background: #252525;
            border-radius: 8px;
            padding: 1.5rem;
        }
        
        .scaled-ingredient {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid #333;
        }
        
        .scaled-ingredient:last-child {
            border-bottom: none;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .recipe-details {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .page-header {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }
            
            .filters {
                flex-direction: column;
            }
            
            .recipes-grid {
                grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            }
            
            .recipe-content {
                padding: 1rem;
            }
            
            .recipe-title {
                font-size: 2rem;
            }
            
            .recipe-meta {
                gap: 0.5rem;
            }
            
            .meta-item {
                font-size: 0.8rem;
                padding: 0.4rem 0.8rem;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 0.5rem;
            }
            
            .recipes-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                gap: 0.5rem;
            }
            
            .recipe-image {
                height: 100px;
            }
            
            .recipe-info {
                padding: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // Authentication configuration
        const ADMIN_CREDENTIALS = {
            username: 'suraj',
            password: 'cocktail123'
        };

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCZ7l7Vpl3r6l2N8W4dZLXq6YQ7bKj6X8w",
            authDomain: "cocktail-manual-demo.firebaseapp.com",
            projectId: "cocktail-manual-demo",
            storageBucket: "cocktail-manual-demo.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abcdef123456"
        };

        // Initialize Firebase
        let db = null;
        let firebaseApp = null;
        try {
            firebaseApp = firebase.initializeApp(firebaseConfig);
            db = firebase.firestore(firebaseApp);
            console.log('Firebase initialized successfully');
        } catch (error) {
            console.log('Firebase initialization failed, using localStorage fallback:', error);
        }
        
        // Enhanced data management with version control
        const loadFromStorage = (key, defaultValue) => {
            try {
                const item = localStorage.getItem(key);
                return item ? JSON.parse(item) : defaultValue;
            } catch {
                return defaultValue;
            }
        };
        
        const saveToStorage = (key, value) => {
            try {
                localStorage.setItem(key, JSON.stringify(value));
                return true;
            } catch (error) {
                console.error('Error saving to localStorage:', error);
                return false;
            }
        };
        
        // Enhanced cloud storage with conflict resolution
        const saveToCloud = async (data) => {
            if (!db) {
                console.log('Firebase not available, using localStorage only');
                return { success: false, error: 'Firebase not available' };
            }
            
            try {
                console.log('Saving to Firebase...', data);
                
                // Add version and timestamp for conflict resolution
                const cloudData = {
                    ...data,
                    version: (data.version || 0) + 1,
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedBy: data.updatedBy || 'system',
                    deviceId: getDeviceId()
                };
                
                await db.collection('appData').doc('cocktailData').set(cloudData, { merge: true });
                
                console.log('Successfully saved to Firebase');
                return { success: true };
            } catch (error) {
                console.error('Error saving to Firebase:', error);
                return { 
                    success: false, 
                    error: error.message 
                };
            }
        };
        
        const loadFromCloud = async () => {
            if (!db) {
                console.log('Firebase not available, using localStorage only');
                return null;
            }
            
            try {
                console.log('Loading from Firebase...');
                const doc = await db.collection('appData').doc('cocktailData').get();
                
                if (doc.exists) {
                    const data = doc.data();
                    console.log('Successfully loaded from Firebase:', data);
                    return data;
                } else {
                    console.log('No data found in Firebase');
                    return null;
                }
            } catch (error) {
                console.error('Error loading from Firebase:', error);
                return null;
            }
        };

        // Enhanced real-time sync with conflict resolution
        const setupRealtimeSync = (callback) => {
            if (!db) {
                console.log('Firebase not available for real-time sync');
                return () => {};
            }
            
            try {
                console.log('Setting up enhanced real-time sync...');
                const unsubscribe = db.collection('appData').doc('cocktailData')
                    .onSnapshot((doc) => {
                        if (doc.exists) {
                            const cloudData = doc.data();
                            console.log('Real-time update received:', cloudData);
                            
                            // Check if this update is from another device
                            const currentDeviceId = getDeviceId();
                            if (cloudData.deviceId !== currentDeviceId) {
                                console.log('Update from another device, applying changes...');
                                callback(cloudData);
                            }
                        }
                    }, (error) => {
                        console.error('Real-time sync error:', error);
                    });
                
                return unsubscribe;
            } catch (error) {
                console.error('Error setting up real-time sync:', error);
                return () => {};
            }
        };

        // Device ID for conflict resolution
        const getDeviceId = () => {
            let deviceId = localStorage.getItem('cocktailAppDeviceId');
            if (!deviceId) {
                deviceId = 'device_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('cocktailAppDeviceId', deviceId);
            }
            return deviceId;
        };

        // Enhanced data management with version control
        const getRecipes = () => {
            return loadFromStorage('cocktailRecipes', []);
        };
        
        const saveRecipes = async (recipes, user) => {
            // Always save to localStorage first for immediate response
            const localSuccess = saveToStorage('cocktailRecipes', recipes);
            
            // Save to cloud if user is admin
            if (user && user.isAdmin) {
                const currentData = {
                    recipes: recipes,
                    syrups: getSyrups(),
                    settings: getSettings(),
                    version: loadFromStorage('cocktailDataVersion', 0),
                    updatedBy: user.username,
                    deviceId: getDeviceId()
                };
                
                const cloudResult = await saveToCloud(currentData);
                if (cloudResult.success) {
                    saveToStorage('cocktailDataVersion', currentData.version);
                }
                return { 
                    localSuccess, 
                    cloudSuccess: cloudResult.success,
                    cloudError: cloudResult.error
                };
            }
            
            return { localSuccess, cloudSuccess: false };
        };
        
        const getSyrups = () => {
            return loadFromStorage('cocktailSyrups', []);
        };
        
        const saveSyrups = async (syrups, user) => {
            const localSuccess = saveToStorage('cocktailSyrups', syrups);
            
            if (user && user.isAdmin) {
                const currentData = {
                    recipes: getRecipes(),
                    syrups: syrups,
                    settings: getSettings(),
                    version: loadFromStorage('cocktailDataVersion', 0),
                    updatedBy: user.username,
                    deviceId: getDeviceId()
                };
                
                const cloudResult = await saveToCloud(currentData);
                if (cloudResult.success) {
                    saveToStorage('cocktailDataVersion', currentData.version);
                }
                return { 
                    localSuccess, 
                    cloudSuccess: cloudResult.success,
                    cloudError: cloudResult.error
                };
            }
            
            return { localSuccess, cloudSuccess: false };
        };
        
        const getSettings = () => {
            return loadFromStorage('cocktailSettings', {
                spirit_types: ['Gin', 'Vodka', 'Rum', 'Tequila', 'Whiskey', 'Brandy'],
                glass_types: ['Coupe', 'Martini', 'Highball', 'Old Fashioned', 'Collins', 'Margarita'],
                venues: ['Main Bar', 'Pool Bar', 'Restaurant', 'Private Event']
            });
        };
        
        const saveSettings = async (settings, user) => {
            const localSuccess = saveToStorage('cocktailSettings', settings);
            
            if (user && user.isAdmin) {
                const currentData = {
                    recipes: getRecipes(),
                    syrups: getSyrups(),
                    settings: settings,
                    version: loadFromStorage('cocktailDataVersion', 0),
                    updatedBy: user.username,
                    deviceId: getDeviceId()
                };
                
                const cloudResult = await saveToCloud(currentData);
                if (cloudResult.success) {
                    saveToStorage('cocktailDataVersion', currentData.version);
                }
                return { 
                    localSuccess, 
                    cloudSuccess: cloudResult.success,
                    cloudError: cloudResult.error
                };
            }
            
            return { localSuccess, cloudSuccess: false };
        };

        // Enhanced sync function with conflict resolution
        const syncFromCloud = async () => {
            try {
                console.log('Starting enhanced cloud sync...');
                const cloudData = await loadFromCloud();
                
                if (cloudData) {
                    const localVersion = loadFromStorage('cocktailDataVersion', 0);
                    const cloudVersion = cloudData.version || 0;
                    
                    // Simple conflict resolution: cloud data wins
                    if (cloudVersion >= localVersion) {
                        console.log('Cloud data is newer, updating local storage...');
                        
                        // Update local storage with cloud data
                        saveToStorage('cocktailRecipes', cloudData.recipes || []);
                        saveToStorage('cocktailSyrups', cloudData.syrups || []);
                        saveToStorage('cocktailSettings', cloudData.settings || getSettings());
                        saveToStorage('cocktailDataVersion', cloudVersion);
                        
                        console.log('Cloud sync completed successfully');
                        return { 
                            success: true, 
                            data: cloudData,
                            message: `Synced ${cloudData.recipes?.length || 0} recipes from cloud`
                        };
                    } else {
                        console.log('Local data is newer, keeping local version');
                        return { 
                            success: true, 
                            message: 'Local data is up to date'
                        };
                    }
                } else {
                    console.log('No cloud data available yet');
                    return { 
                        success: false, 
                        error: 'No cloud data found. An admin needs to save data first.',
                        message: 'No cloud data available yet'
                    };
                }
            } catch (error) {
                console.error('Error syncing from cloud:', error);
                return { 
                    success: false, 
                    error: error.message,
                    message: 'Sync failed - using local data'
                };
            }
        };

        // Initialize with sample data if empty
        const initializeSampleData = () => {
            const currentRecipes = getRecipes();
            if (currentRecipes.length === 0) {
                const sampleRecipes = [
                    {
                        id: '1',
                        name: 'Aviation',
                        spirit_type: 'Gin',
                        venue: 'Main Bar',
                        glass_type: 'Coupe',
                        abv: 28,
                        pour_cost: 4.25,
                        image_url: '',
                        ingredients: [
                            { name: 'Gin', amount: 45, unit: 'ml' },
                            { name: 'Maraschino Liqueur', amount: 15, unit: 'ml' },
                            { name: 'Cr√®me de Violette', amount: 15, unit: 'ml' },
                            { name: 'Lemon Juice', amount: 30, unit: 'ml' }
                        ],
                        instructions: 'Shake all ingredients with ice. Strain into chilled coupe glass. Garnish with a cherry.',
                        notes: 'Classic pre-prohibition cocktail with a beautiful purple hue.'
                    },
                    {
                        id: '2', 
                        name: 'Margarita',
                        spirit_type: 'Tequila',
                        venue: 'Pool Bar',
                        glass_type: 'Margarita',
                        abv: 25,
                        pour_cost: 3.75,
                        image_url: '',
                        ingredients: [
                            { name: 'Tequila', amount: 50, unit: 'ml' },
                            { name: 'Lime Juice', amount: 25, unit: 'ml' },
                            { name: 'Triple Sec', amount: 20, unit: 'ml' }
                        ],
                        instructions: 'Shake all ingredients with ice. Strain into salt-rimmed glass filled with ice.',
                        notes: 'Classic tequila cocktail perfect for summer.'
                    }
                ];
                saveToStorage('cocktailRecipes', sampleRecipes);
                console.log('Initialized with sample data');
            }
        };

        // Initialize sample data
        initializeSampleData();

        // Initialize data
        let mockRecipes = getRecipes();
        let mockSyrups = getSyrups();
        let mockSettings = getSettings();

        // Utility function to convert image to base64
        const convertImageToBase64 = (file) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        };

        // Authentication Hook
        function useAuth() {
            const [user, setUser] = useState(null);
            
            useEffect(() => {
                const savedUser = localStorage.getItem('cocktailAppUser');
                if (savedUser) {
                    setUser(JSON.parse(savedUser));
                }
            }, []);
            
            const login = (username, password) => {
                if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
                    const userData = { username, isAdmin: true };
                    setUser(userData);
                    localStorage.setItem('cocktailAppUser', JSON.stringify(userData));
                    return true;
                }
                return false;
            };
            
            const loginAsGuest = () => {
                const guestUser = { username: 'Guest', isAdmin: false };
                setUser(guestUser);
                localStorage.setItem('cocktailAppUser', JSON.stringify(guestUser));
                return true;
            };
            
            const logout = () => {
                setUser(null);
                localStorage.removeItem('cocktailAppUser');
            };
            
            return { user, login, loginAsGuest, logout };
        }

        // Login Page Component
        function LoginPage({ onLogin, onGuestLogin }) {
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            
            const handleSubmit = (e) => {
                e.preventDefault();
                if (onLogin(username, password)) {
                    setError('');
                } else {
                    setError('Invalid credentials');
                }
            };
            
            return (
                <div className="login-container">
                    <div className="login-box">
                        <div className="login-logo">üç∏</div>
                        <h1 className="login-title">Cocktail Manual</h1>
                        
                        <form onSubmit={handleSubmit}>
                            <input
                                type="text"
                                className="login-input"
                                placeholder="Username"
                                value={username}
                                onChange={(e) => setUsername(e.target.value)}
                                required
                            />
                            <input
                                type="password"
                                className="login-input"
                                placeholder="Password"
                                value={password}
                                onChange={(e) => setPassword(e.target.value)}
                                required
                            />
                            {error && <div style={{color: '#f44336', marginBottom: '1rem'}}>{error}</div>}
                            <button type="submit" className="login-button">
                                Admin Login
                            </button>
                        </form>
                        
                        <div style={{margin: '1rem 0', color: '#666', textAlign: 'center'}}>or</div>
                        
                        <button className="guest-button" onClick={onGuestLogin}>
                            Continue as Guest
                        </button>
                        
                        <div style={{marginTop: '2rem', fontSize: '0.8rem', color: '#666'}}>
                            <strong>Admin Demo:</strong><br/>
                            Username: suraj<br/>
                            Password: cocktail123
                        </div>
                    </div>
                </div>
            );
        }

        // Scale Modal Component
        function ScaleModal({ recipe, onClose }) {
            const [scaleFactor, setScaleFactor] = useState(1);
            
            const scaleOptions = [
                { factor: 0.5, label: 'Half Batch' },
                { factor: 1, label: 'Single' },
                { factor: 2, label: 'Double' },
                { factor: 4, label: 'Large Batch' },
                { factor: 8, label: 'Party Batch' }
            ];
            
            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                        <div className="modal-header">
                            <h2 className="modal-title">Scale Recipe: {recipe.name}</h2>
                            <button className="close-button" onClick={onClose}>√ó</button>
                        </div>
                        
                        <div className="scale-options">
                            {scaleOptions.map(option => (
                                <div
                                    key={option.factor}
                                    className={`scale-option ${scaleFactor === option.factor ? 'active' : ''}`}
                                    onClick={() => setScaleFactor(option.factor)}
                                >
                                    <div className="scale-factor">{option.factor}x</div>
                                    <div className="scale-label">{option.label}</div>
                                </div>
                            ))}
                        </div>
                        
                        <div className="scaled-ingredients">
                            <h3 style={{color: '#FFB366', marginBottom: '1rem'}}>Scaled Ingredients</h3>
                            {recipe.ingredients.map((ingredient, index) => (
                                <div key={index} className="scaled-ingredient">
                                    <span>{ingredient.name}</span>
                                    <span>{(ingredient.amount * scaleFactor).toFixed(1)} {ingredient.unit}</span>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        // Hamburger Menu Component
        function HamburgerMenu({ isOpen, onToggle, currentPage, onNavigate, isAdmin }) {
            const menuRef = useRef(null);
            
            useEffect(() => {
                const handleClickOutside = (event) => {
                    if (menuRef.current && !menuRef.current.contains(event.target) && 
                        !event.target.closest('.menu-button')) {
                        onToggle(false);
                    }
                };
                
                if (isOpen) {
                    document.addEventListener('mousedown', handleClickOutside);
                    document.addEventListener('touchstart', handleClickOutside);
                }
                
                return () => {
                    document.removeEventListener('mousedown', handleClickOutside);
                    document.removeEventListener('touchstart', handleClickOutside);
                };
            }, [isOpen, onToggle]);
            
            const handleNavigation = (page) => {
                onNavigate(page);
                onToggle(false);
            };
            
            return (
                <>
                    <div className={`side-menu-overlay ${isOpen ? 'active' : ''}`} />
                    <div ref={menuRef} className={`side-menu ${isOpen ? 'active' : ''}`}>
                        <div className="side-menu-header">
                            <div className="side-menu-logo">üç∏</div>
                            <div className="side-menu-title">Cocktail Manual</div>
                        </div>
                        
                        <nav className="side-menu-nav">
                            <button 
                                className={`side-menu-button ${currentPage === 'home' ? 'active' : ''}`}
                                onClick={() => handleNavigation('home')}
                            >
                                üìñ Cocktail Menu
                            </button>
                            
                            <button 
                                className={`side-menu-button ${currentPage === 'create-recipe' ? 'active' : ''} ${
                                    !isAdmin ? 'disabled' : ''
                                }`}
                                onClick={() => isAdmin && handleNavigation('create-recipe')}
                                title={!isAdmin ? 'Admin access required' : ''}
                            >
                                ‚ûï Add Recipe
                            </button>
                            
                            <button 
                                className={`side-menu-button ${currentPage === 'syrups' ? 'active' : ''}`}
                                onClick={() => handleNavigation('syrups')}
                            >
                                üß™ Syrups & Infusions
                            </button>
                            
                            <button 
                                className={`side-menu-button ${currentPage === 'settings' ? 'active' : ''} ${
                                    !isAdmin ? 'disabled' : ''
                                }`}
                                onClick={() => isAdmin && handleNavigation('settings')}
                                title={!isAdmin ? 'Admin access required' : ''}
                            >
                                ‚öôÔ∏è Settings
                            </button>
                        </nav>
                    </div>
                </>
            );
        }

        // Recipe Card Component
        function RecipeCard({ recipe, onClick, isAdmin }) {
            const imageStyle = {
                backgroundImage: recipe.image_url ? `url(${recipe.image_url})` : 'none',
                backgroundSize: 'cover',
                backgroundPosition: 'center'
            };
            
            return (
                <div className="recipe-card" onClick={() => onClick(recipe)}>
                    <div className="recipe-image" style={imageStyle}>
                        {!recipe.image_url && 'üç∏'}
                    </div>
                    <div className="recipe-info">
                        <div className="recipe-name">{recipe.name}</div>
                        <div className="recipe-spirit">{recipe.spirit_type}</div>
                    </div>
                </div>
            );
        }

        // View Recipe Component
        function ViewRecipePage({ recipe, onBack, onScale, isAdmin, onDeleteRecipe, onEditRecipe }) {
            const backgroundStyle = {
                backgroundImage: recipe.image_url ? `url(${recipe.image_url})` : 'none',
                backgroundSize: 'cover',
                backgroundPosition: 'center'
            };
            
            return (
                <div className="container">
                    <button className="button button-secondary" onClick={onBack}>
                        ‚Üê Back to Cocktails
                    </button>
                    
                    <div className="recipe-view">
                        {recipe.image_url && (
                            <div className="recipe-background" style={backgroundStyle}></div>
                        )}
                        
                        <div className="recipe-content">
                            <div className="recipe-header">
                                <div>
                                    <h1 className="recipe-title">{recipe.name}</h1>
                                    <div className="recipe-meta">
                                        <div className="meta-item">{recipe.spirit_type}</div>
                                        <div className="meta-item">{recipe.glass_type} Glass</div>
                                        <div className="meta-item">{recipe.abv}% ABV</div>
                                        <div className="meta-item">${recipe.pour_cost} Cost</div>
                                        <div className="meta-item">{recipe.venue}</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div className="recipe-details">
                                <div>
                                    <h3 style={{color: '#FFB366', marginBottom: '1rem'}}>Ingredients</h3>
                                    <ul className="ingredients-list">
                                        {recipe.ingredients.map((ingredient, index) => (
                                            <li key={index} className="ingredient-item">
                                                <span>{ingredient.name}</span>
                                                <span>{ingredient.amount} {ingredient.unit}</span>
                                            </li>
                                        ))}
                                    </ul>
                                </div>
                                
                                <div>
                                    <h3 style={{color: '#FFB366', marginBottom: '1rem'}}>Instructions</h3>
                                    <div className="instructions">{recipe.instructions}</div>
                                    
                                    {recipe.notes && (
                                        <>
                                            <h3 style={{color: '#FFB366', marginBottom: '1rem', marginTop: '1.5rem'}}>Notes</h3>
                                            <div className="instructions">{recipe.notes}</div>
                                        </>
                                    )}
                                    
                                    <div className="action-buttons">
                                        <button className="action-button scale" onClick={onScale}>
                                            ‚öñÔ∏è Scale Recipe
                                        </button>
                                        {isAdmin && (
                                            <>
                                                <button 
                                                    className="action-button edit"
                                                    onClick={() => {
                                                        if (onEditRecipe) {
                                                            onEditRecipe(recipe);
                                                        }
                                                    }}
                                                >
                                                    ‚úèÔ∏è Edit
                                                </button>
                                                <button 
                                                    className="action-button delete"
                                                    onClick={() => onDeleteRecipe(recipe.id)}
                                                >
                                                    üóëÔ∏è Delete
                                                </button>
                                            </>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Home Page Component
        function HomePage({ onRecipeClick, onDeleteRecipe, isAdmin, onCreateRecipe, syncStatus, onSync, recipes }) {
            const [searchTerm, setSearchTerm] = useState('');
            const [filterSpirit, setFilterSpirit] = useState('All');
            const [filterVenue, setFilterVenue] = useState('All');
            
            const filteredRecipes = recipes.filter(recipe => {
                const matchesSearch = recipe.name.toLowerCase().includes(searchTerm.toLowerCase());
                const matchesSpirit = filterSpirit === 'All' || recipe.spirit_type === filterSpirit;
                const matchesVenue = filterVenue === 'All' || recipe.venue === filterVenue;
                
                return matchesSearch && matchesSpirit && matchesVenue;
            });
            
            const groupedRecipes = filteredRecipes.reduce((groups, recipe) => {
                const firstLetter = recipe.name.charAt(0).toUpperCase();
                if (!groups[firstLetter]) {
                    groups[firstLetter] = [];
                }
                groups[firstLetter].push(recipe);
                return groups;
            }, {});
            
            const sortedLetters = Object.keys(groupedRecipes).sort();
            
            return (
                <div className="container">
                    <div className="demo-notice">
                        üî• Real-time Cross-Device Sync Active! Admin changes appear instantly across all devices.
                    </div>
                    
                    <div className="page-header">
                        <h1 className="page-title">Cocktail Menu</h1>
                        {isAdmin && (
                            <button className="button" onClick={onCreateRecipe}>
                                + Add Recipe
                            </button>
                        )}
                    </div>
                    
                    {syncStatus && (
                        <div className={`sync-status ${syncStatus.status}`}>
                            {syncStatus.status === 'syncing' && 'üîÑ Syncing...'}
                            {syncStatus.status === 'success' && '‚úÖ Synced with cloud'}
                            {syncStatus.status === 'error' && '‚ùå Sync failed'}
                            {syncStatus.message && ` - ${syncStatus.message}`}
                            <button className="sync-button" onClick={onSync}>
                                üîÑ Sync Now
                            </button>
                        </div>
                    )}
                    
                    <div className="search-section">
                        <input 
                            type="text"
                            className="search-box"
                            placeholder="Search cocktails..."
                            value={searchTerm}
                            onChange={(e) => setSearchTerm(e.target.value)}
                        />
                        
                        <div className="filters">
                            <select 
                                className="filter-select"
                                value={filterSpirit}
                                onChange={(e) => setFilterSpirit(e.target.value)}
                            >
                                <option value="All">All Spirits</option>
                                {mockSettings.spirit_types.map(spirit => (
                                    <option key={spirit} value={spirit}>{spirit}</option>
                                ))}
                            </select>
                            
                            <select 
                                className="filter-select"
                                value={filterVenue}
                                onChange={(e) => setFilterVenue(e.target.value)}
                            >
                                <option value="All">All Venues</option>
                                {mockSettings.venues.map(venue => (
                                    <option key={venue} value={venue}>{venue}</option>
                                ))}
                            </select>
                        </div>
                    </div>
                    
                    {filteredRecipes.length === 0 ? (
                        <div className="loading">
                            {recipes.length === 0 ? (
                                <>
                                    No cocktails available.
                                    <div style={{marginTop: '1rem'}}>
                                        <button className="button" onClick={onSync}>
                                            Sync Data from Cloud
                                        </button>
                                    </div>
                                </>
                            ) : (
                                'No cocktails found matching your criteria.'
                            )}
                        </div>
                    ) : (
                        <>
                            <div style={{marginBottom: '1rem', color: '#888', fontSize: '0.9rem'}}>
                                Showing {filteredRecipes.length} of {recipes.length} cocktails
                                {isAdmin && ' ‚Ä¢ Add/Edit cocktails to see real-time sync across devices!'}
                            </div>
                            {sortedLetters.map(letter => (
                                <div key={letter} className="alphabet-section">
                                    <h2 className="letter-header">{letter}</h2>
                                    <div className="recipes-grid">
                                        {groupedRecipes[letter].map(recipe => (
                                            <RecipeCard 
                                                key={recipe.id}
                                                recipe={recipe}
                                                onClick={onRecipeClick}
                                                isAdmin={isAdmin}
                                            />
                                        ))}
                                    </div>
                                </div>
                            ))}
                        </>
                    )}
                </div>
            );
        }

        // Create/Edit Recipe Component
        function CreateEditRecipePage({ recipe, onBack, onSave, isEdit = false, user }) {
            const [formData, setFormData] = useState(
                recipe || {
                    name: '',
                    spirit_type: '',
                    venue: '',
                    glass_type: '',
                    abv: '',
                    pour_cost: '',
                    image_url: '',
                    ingredients: [{ name: '', amount: '', unit: 'ml' }],
                    instructions: '',
                    notes: ''
                }
            );
            
            const [imagePreview, setImagePreview] = useState(recipe?.image_url || '');
            
            const handleInputChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({
                    ...prev,
                    [name]: value
                }));
            };
            
            const handleIngredientChange = (index, field, value) => {
                const updatedIngredients = [...formData.ingredients];
                updatedIngredients[index][field] = value;
                setFormData(prev => ({
                    ...prev,
                    ingredients: updatedIngredients
                }));
            };
            
            const addIngredient = () => {
                setFormData(prev => ({
                    ...prev,
                    ingredients: [...prev.ingredients, { name: '', amount: '', unit: 'ml' }]
                }));
            };
            
            const removeIngredient = (index) => {
                if (formData.ingredients.length > 1) {
                    const updatedIngredients = [...formData.ingredients];
                    updatedIngredients.splice(index, 1);
                    setFormData(prev => ({
                        ...prev,
                        ingredients: updatedIngredients
                    }));
                }
            };
            
            const handleImageUpload = async (e) => {
                const file = e.target.files[0];
                if (file) {
                    try {
                        const base64 = await convertImageToBase64(file);
                        setFormData(prev => ({
                            ...prev,
                            image_url: base64
                        }));
                        setImagePreview(base64);
                    } catch (error) {
                        console.error('Error uploading image:', error);
                        alert('Error uploading image. Please try again.');
                    }
                }
            };
            
            const handleSubmit = (e) => {
                e.preventDefault();
                
                if (!formData.name) {
                    alert('Please at least enter a cocktail name');
                    return;
                }
                
                const recipeData = {
                    ...formData,
                    id: isEdit ? formData.id : Date.now().toString(),
                    abv: parseFloat(formData.abv) || 0,
                    pour_cost: parseFloat(formData.pour_cost) || 0
                };
                
                onSave(recipeData, user);
            };
            
            return (
                <div className="container">
                    <button className="button button-secondary" onClick={onBack}>
                        ‚Üê Back to Cocktails
                    </button>
                    
                    <h1 className="page-title">{isEdit ? 'Edit Cocktail' : 'Add New Cocktail'}</h1>
                    
                    <form className="form" onSubmit={handleSubmit}>
                        <div className="form-group">
                            <label className="form-label">Cocktail Name *</label>
                            <input
                                type="text"
                                className="form-input"
                                name="name"
                                value={formData.name}
                                onChange={handleInputChange}
                                required
                            />
                        </div>
                        
                        <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem'}}>
                            <div className="form-group">
                                <label className="form-label">Spirit Type</label>
                                <select
                                    className="form-input"
                                    name="spirit_type"
                                    value={formData.spirit_type}
                                    onChange={handleInputChange}
                                >
                                    <option value="">Select Spirit</option>
                                    {mockSettings.spirit_types.map(spirit => (
                                        <option key={spirit} value={spirit}>{spirit}</option>
                                    ))}
                                </select>
                            </div>
                            
                            <div className="form-group">
                                <label className="form-label">Venue</label>
                                <select
                                    className="form-input"
                                    name="venue"
                                    value={formData.venue}
                                    onChange={handleInputChange}
                                >
                                    <option value="">Select Venue</option>
                                    {mockSettings.venues.map(venue => (
                                        <option key={venue} value={venue}>{venue}</option>
                                    ))}
                                </select>
                            </div>
                        </div>
                        
                        <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem'}}>
                            <div className="form-group">
                                <label className="form-label">Glass Type</label>
                                <select
                                    className="form-input"
                                    name="glass_type"
                                    value={formData.glass_type}
                                    onChange={handleInputChange}
                                >
                                    <option value="">Select Glass</option>
                                    {mockSettings.glass_types.map(glass => (
                                        <option key={glass} value={glass}>{glass}</option>
                                    ))}
                                </select>
                            </div>
                            
                            <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem'}}>
                                <div className="form-group">
                                    <label className="form-label">ABV (%)</label>
                                    <input
                                        type="number"
                                        step="0.1"
                                        className="form-input"
                                        name="abv"
                                        value={formData.abv}
                                        onChange={handleInputChange}
                                    />
                                </div>
                                
                                <div className="form-group">
                                    <label className="form-label">Pour Cost ($)</label>
                                    <input
                                        type="number"
                                        step="0.01"
                                        className="form-input"
                                        name="pour_cost"
                                        value={formData.pour_cost}
                                        onChange={handleInputChange}
                                    />
                                </div>
                            </div>
                        </div>
                        
                        <div className="form-group">
                            <label className="form-label">Cocktail Image</label>
                            <div className="image-upload">
                                <input
                                    type="file"
                                    accept="image/*"
                                    onChange={handleImageUpload}
                                    style={{display: 'none'}}
                                    id="image-upload"
                                />
                                <label htmlFor="image-upload" style={{cursor: 'pointer'}}>
                                    {imagePreview ? 'Change Image' : 'Upload Image'}
                                </label>
                                {imagePreview && (
                                    <img src={imagePreview} alt="Preview" className="image-preview" />
                                )}
                            </div>
                        </div>
                        
                        <div className="form-group">
                            <label className="form-label">Ingredients</label>
                            {formData.ingredients.map((ingredient, index) => (
                                <div key={index} style={{display: 'flex', gap: '0.5rem', marginBottom: '0.5rem', alignItems: 'center'}}>
                                    <input
                                        type="text"
                                        className="form-input"
                                        placeholder="Ingredient name"
                                        value={ingredient.name}
                                        onChange={(e) => handleIngredientChange(index, 'name', e.target.value)}
                                        style={{flex: 2}}
                                    />
                                    <input
                                        type="number"
                                        step="0.1"
                                        className="form-input"
                                        placeholder="Amount"
                                        value={ingredient.amount}
                                        onChange={(e) => handleIngredientChange(index, 'amount', e.target.value)}
                                        style={{flex: 1}}
                                    />
                                    <select
                                        className="form-input"
                                        value={ingredient.unit}
                                        onChange={(e) => handleIngredientChange(index, 'unit', e.target.value)}
                                        style={{flex: 1}}
                                    >
                                        <option value="ml">ml</option>
                                        <option value="oz">oz</option>
                                        <option value="dash">dash</option>
                                        <option value="piece">piece</option>
                                        <option value="slice">slice</option>
                                        <option value="sprig">sprig</option>
                                    </select>
                                    {formData.ingredients.length > 1 && (
                                        <button
                                            type="button"
                                            className="icon-button delete"
                                            onClick={() => removeIngredient(index)}
                                        >
                                            √ó
                                        </button>
                                    )}
                                </div>
                            ))}
                            <button type="button" className="button button-secondary" onClick={addIngredient}>
                                + Add Ingredient
                            </button>
                        </div>
                        
                        <div className="form-group">
                            <label className="form-label">Instructions</label>
                            <textarea
                                className="form-textarea"
                                name="instructions"
                                value={formData.instructions}
                                onChange={handleInputChange}
                            />
                        </div>
                        
                        <div className="form-group">
                            <label className="form-label">Notes</label>
                            <textarea
                                className="form-textarea"
                                name="notes"
                                value={formData.notes}
                                onChange={handleInputChange}
                            />
                        </div>
                        
                        <div className="buttons-row">
                            <button type="submit" className="button">
                                {isEdit ? 'Update Cocktail' : 'Save Cocktail'}
                            </button>
                            <button type="button" className="button button-secondary" onClick={onBack}>
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>
            );
        }

        // Main App Component
        function App() {
            const { user, login, loginAsGuest, logout } = useAuth();
            const [currentPage, setCurrentPage] = useState('home');
            const [selectedRecipe, setSelectedRecipe] = useState(null);
            const [selectedSyrup, setSelectedSyrup] = useState(null);
            const [showScaleModal, setShowScaleModal] = useState(false);
            const [menuOpen, setMenuOpen] = useState(false);
            const [editingItem, setEditingItem] = useState(null);
            const [isEditing, setIsEditing] = useState(false);
            const [syncStatus, setSyncStatus] = useState(null);
            const [recipes, setRecipes] = useState(getRecipes());
            
            // Enhanced sync system with real-time updates
            useEffect(() => {
                const initializeData = async () => {
                    setSyncStatus({ status: 'syncing', message: 'Connecting to cloud...' });
                    const result = await syncFromCloud();
                    
                    if (result.success) {
                        setRecipes(getRecipes());
                        setSyncStatus({ 
                            status: 'success', 
                            message: result.message || 'Connected to cloud successfully'
                        });
                    } else {
                        setSyncStatus({ 
                            status: 'error', 
                            message: result.message || 'Using local data only'
                        });
                    }
                    
                    setTimeout(() => setSyncStatus(null), 3000);
                };
                
                initializeData();
                
                // Enhanced real-time sync with conflict resolution
                const unsubscribe = setupRealtimeSync((cloudData) => {
                    console.log('Real-time update received!', cloudData);
                    if (cloudData) {
                        // Update local storage with new data
                        saveToStorage('cocktailRecipes', cloudData.recipes || []);
                        saveToStorage('cocktailSyrups', cloudData.syrups || []);
                        saveToStorage('cocktailSettings', cloudData.settings || getSettings());
                        saveToStorage('cocktailDataVersion', cloudData.version || 0);
                        
                        // Update state to trigger re-render
                        setRecipes(cloudData.recipes || []);
                        
                        // Show sync notification
                        setSyncStatus({ 
                            status: 'success', 
                            message: 'Real-time update received from admin!' 
                        });
                        setTimeout(() => setSyncStatus(null), 2000);
                    }
                });
                
                return () => {
                    if (unsubscribe) unsubscribe();
                };
            }, []);
            
            const handleSync = async () => {
                setSyncStatus({ status: 'syncing', message: 'Syncing with cloud...' });
                const result = await syncFromCloud();
                
                if (result.success) {
                    setRecipes(getRecipes());
                    setSyncStatus({ 
                        status: 'success', 
                        message: result.message || 'Data synced successfully'
                    });
                } else {
                    setSyncStatus({ 
                        status: 'error', 
                        message: result.message || 'Sync failed'
                    });
                }
                
                setTimeout(() => setSyncStatus(null), 3000);
            };
            
            const navigateTo = (page, item = null) => {
                if ((page === 'create-recipe' || page === 'settings') && (!user || !user.isAdmin)) {
                    return;
                }
                setCurrentPage(page);
                if (page === 'view-recipe') setSelectedRecipe(item);
                if (page === 'view-syrup') setSelectedSyrup(item);
                setMenuOpen(false);
            };
            
            const handleDeleteRecipe = async (recipeId) => {
                if (!user || !user.isAdmin) return;
                
                if (confirm('Are you sure you want to delete this cocktail?')) {
                    const updatedRecipes = recipes.filter(recipe => recipe.id !== recipeId);
                    setSyncStatus({ status: 'syncing', message: 'Deleting recipe...' });
                    
                    const result = await saveRecipes(updatedRecipes, user);
                    if (result.localSuccess) {
                        setRecipes(updatedRecipes);
                        let message = 'Recipe deleted successfully';
                        if (result.cloudSuccess) {
                            message += ' and synced to cloud';
                        }
                        
                        setSyncStatus({ status: 'success', message });
                        setTimeout(() => setSyncStatus(null), 2000);
                    } else {
                        setSyncStatus({ status: 'error', message: 'Failed to delete recipe' });
                        setTimeout(() => setSyncStatus(null), 3000);
                    }
                }
            };
            
            const handleSaveRecipe = async (recipeData, user) => {
                let updatedRecipes;
                
                if (isEditing && editingItem) {
                    const index = recipes.findIndex(r => r.id === editingItem.id);
                    if (index !== -1) {
                        updatedRecipes = [...recipes];
                        updatedRecipes[index] = recipeData;
                    }
                } else {
                    updatedRecipes = [...recipes, recipeData];
                }
                
                setSyncStatus({ status: 'syncing', message: 'Saving recipe...' });
                const result = await saveRecipes(updatedRecipes, user);
                
                if (result.localSuccess) {
                    setRecipes(updatedRecipes);
                    let message = isEditing ? 'Recipe updated successfully' : 'Recipe saved successfully';
                    if (result.cloudSuccess) {
                        message += ' and synced to cloud';
                    } else if (user.isAdmin) {
                        message += ' but failed to sync to cloud';
                    }
                    
                    setSyncStatus({ status: 'success', message });
                    setIsEditing(false);
                    setEditingItem(null);
                    
                    setTimeout(() => {
                        setSyncStatus(null);
                        navigateTo('home');
                    }, 1500);
                } else {
                    setSyncStatus({ status: 'error', message: 'Failed to save recipe' });
                    setTimeout(() => setSyncStatus(null), 3000);
                }
            };
            
            const handleEditRecipe = (recipe) => {
                setEditingItem(recipe);
                setIsEditing(true);
                setCurrentPage('create-recipe');
            };
            
            const renderPage = () => {
                if (!user) {
                    return <LoginPage onLogin={login} onGuestLogin={loginAsGuest} />;
                }
                
                switch(currentPage) {
                    case 'home':
                        return <HomePage 
                            onRecipeClick={(recipe) => navigateTo('view-recipe', recipe)}
                            onDeleteRecipe={handleDeleteRecipe}
                            isAdmin={user.isAdmin}
                            onCreateRecipe={() => {
                                setIsEditing(false);
                                setEditingItem(null);
                                navigateTo('create-recipe');
                            }}
                            syncStatus={syncStatus}
                            onSync={handleSync}
                            recipes={recipes}
                        />;
                    case 'view-recipe':
                        return <ViewRecipePage 
                            recipe={selectedRecipe} 
                            onBack={() => navigateTo('home')}
                            onScale={() => setShowScaleModal(true)}
                            isAdmin={user.isAdmin}
                            onDeleteRecipe={handleDeleteRecipe}
                            onEditRecipe={handleEditRecipe}
                        />;
                    case 'create-recipe':
                        return <CreateEditRecipePage 
                            recipe={editingItem}
                            onBack={() => navigateTo('home')} 
                            onSave={handleSaveRecipe}
                            isEdit={isEditing}
                            user={user}
                        />;
                    default:
                        return <HomePage 
                            onRecipeClick={(recipe) => navigateTo('view-recipe', recipe)}
                            onDeleteRecipe={handleDeleteRecipe}
                            isAdmin={user.isAdmin}
                            onCreateRecipe={() => navigateTo('create-recipe')}
                            syncStatus={syncStatus}
                            onSync={handleSync}
                            recipes={recipes}
                        />;
                }
            };
            
            if (!user) {
                return <LoginPage onLogin={login} onGuestLogin={loginAsGuest} />;
            }
            
            return (
                <div className="app">
                    <header className="header">
                        <div className="header-left">
                            <button 
                                className={`menu-button ${menuOpen ? 'active' : ''}`}
                                onClick={() => setMenuOpen(!menuOpen)}
                                aria-label="Toggle menu"
                            >
                                <span className="menu-line"></span>
                                <span className="menu-line"></span>
                                <span className="menu-line"></span>
                            </button>
                        </div>
                        
                        <div className="nav-user">
                            üë§ {user.username}
                            {user.isAdmin && <span style={{color: '#FFB366', fontSize: '0.7rem'}}> (Admin)</span>}
                            {!user.isAdmin && <span style={{color: '#666', fontSize: '0.7rem'}}> (Guest)</span>}
                            <button className="logout-btn" onClick={logout}>
                                Logout
                            </button>
                        </div>
                    </header>
                    
                    <HamburgerMenu 
                        isOpen={menuOpen}
                        onToggle={setMenuOpen}
                        currentPage={currentPage}
                        onNavigate={navigateTo}
                        isAdmin={user.isAdmin}
                    />
                    
                    <main>
                        {renderPage()}
                    </main>

                    <footer className="footer">
                        <p>
                            Cocktail Manual ¬© {new Date().getFullYear()} | Created by{' '}
                            <a href="https://www.instagram.com/suraj.gg87/" target="_blank" rel="noopener noreferrer">
                                @suraj.gg87
                            </a>
                        </p>
                    </footer>

                    {showScaleModal && selectedRecipe && (
                        <ScaleModal 
                            recipe={selectedRecipe}
                            onClose={() => setShowScaleModal(false)}
                        />
                    )}
                </div>
            );
        }

        // Render the app
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
